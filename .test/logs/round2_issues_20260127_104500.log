# 第2轮测试 - 发现问题清单

## 发现时间
2026-01-27 10:45:00

## 第1轮遗留问题（需验证是否修复）

| 序号 | 问题 | 验证方法 | 状态 |
|-----|-----|---------|-----|
| 1 | 中文逗号未转换 | 检查 raw_species 字段 | 待验证 |
| 2 | results_raw 排序错误 | 检查排序逻辑 | 待验证 |
| 3 | /api/metadata/config 返回 None | 检查 API 响应 | 待验证 |

## 第2轮主动发现问题

### 问题4：raw_species 字段未验证（P1-严重）
- **来源**：代码阅读 `backend.py:235`
- **问题**：`create_raw_project` 函数中，`raw_species` 变量直接从 data 获取，未调用 `_validate_comma_separated`
- **问题代码**：
  ```python
  species = data.get('raw_species', '')  # 未验证！
  ```
- **对比**：`raw_tissue` 正确调用了验证函数
  ```python
  raw_tissue = self._validate_comma_separated(raw_tissue_input, '组织来源 (raw_tissue)')
  ```
- **修复建议**：
  ```python
  species = self._validate_comma_separated(data.get('raw_species', ''), '物种 (raw_species)')
  ```

### 问题5：raw_type 字段未验证（P2-中等）
- **来源**：代码阅读 `backend.py:234`
- **问题**：`raw_type` 变量也未调用 `_validate_comma_separated`
- **问题代码**：
  ```python
  raw_type = data.get('raw_type', '')  # 未验证！
  ```
- **修复建议**：
  ```python
  raw_type = self._validate_comma_separated(data.get('raw_type', ''), '数据类型 (raw_type)')
  ```

### 问题6：create_result_project 同样问题（P1-严重）
- **来源**：代码阅读 `backend.py:355-375`
- **问题**：`create_result_project` 函数中，多个字段未验证
- **未验证字段**：
  - `results_type` (line 356)
  - `results_raw` (line 357)
- **对比**：`keywords` 正确调用了验证函数 (line 373)
- **修复建议**：对 results_type 和 results_raw 调用 `_validate_comma_separated`

## 测试用例更新

| TC-ID | 测试内容 | 问题编号 | 类型 |
|-------|---------|---------|-----|
| TC-CRP-002 | raw_species 中文逗号转换 | 1, 4 | 基础功能 |
| TC-CRP-003 | raw_type 逗号转换 | 5 | 基础功能 |
| TC-CRS-002 | results_raw 排序 | 2 | 基础功能 |
| TC-CRS-003 | results_type 逗号转换 | 6 | 基础功能 |
| TC-CFG-002 | /api/metadata/config 响应 | 3 | API验证 |
| TC-REF-004 | results_raw 追加去重 | 2 | 边界条件 |

## 总结
- 第1轮遗留问题：3个
- 第2轮新发现问题：3个
- 总待验证问题：6个

#========================================
# 代码修订记录
#========================================
时间: 2026-01-23 14:30:22
操作: 修改
文件: app/backend.py
行号: 20-35
变更类型: 功能修复

【修改前】
from datetime import datetime

class BioDataManager:

【修改后】
from datetime import datetime


def _format_datetime(value, fmt='%Y-%m-%d %H:%M:%S') -> str:
    """安全格式化时间字段"""
    if not value or value == 0:
        return ''
    if isinstance(value, str):
        return value[:19] if len(value) >= 19 else value
    if hasattr(value, 'strftime'):
        return value.strftime(fmt)
    return ''


class BioDataManager:

原因: 修复created_at类型问题，确保返回字符串格式
关联问题: ISSUE_001 (created_at.substring is not a function)
#========================================

#========================================
# 代码修订记录
#========================================
时间: 2026-01-23 14:35:18
操作: 修改
文件: app/backend.py
行号: 249
变更类型: 功能修复

【修改前】
                'created_at': row[15],

【修改后】
                'created_at': _format_datetime(row[15]),

原因: 应用_format_datetime函数到get_all_raw_projects
关联问题: ISSUE_001
#========================================

#========================================
# 代码修订记录
#========================================
时间: 2026-01-23 14:35:18
操作: 修改
文件: app/backend.py
行号: 307
变更类型: 功能修复

【修改前】
                'created_at': row[15],

【修改后】
                'created_at': _format_datetime(row[15]),

原因: 应用_format_datetime函数到get_raw_project_by_id
关联问题: ISSUE_001
#========================================

#========================================
# 代码修订记录
#========================================
时间: 2026-01-23 14:40:05
操作: 修改
文件: app/backend.py
行号: 443
变更类型: 功能修复

【修改前】
                'created_at': row[9],

【修改后】
                'created_at': _format_datetime(row[9]),

原因: 应用_format_datetime函数到get_all_result_projects
关联问题: ISSUE_001
#========================================

#========================================
# 代码修订记录
#========================================
时间: 2026-01-23 14:40:05
操作: 修改
文件: app/backend.py
行号: 490
变更类型: 功能修复

【修改前】
                'created_at': row[9],

【修改后】
                'created_at': _format_datetime(row[9]),

原因: 应用_format_datetime函数到get_result_project_by_id
关联问题: ISSUE_001
#========================================

#========================================
# 代码修订记录
#========================================
时间: 2026-01-23 15:05:30
操作: 修改
文件: app/templates/results.html
行号: 333-340
变更类型: 修复修复

【修改前】
                html += `
                    <td>${p.created_at ? p.created_at.substring(0, 10) : '-'}</td>

【修改后】
                // 修复created_at处理，确保处理字符串和日期对象
                const createdAtValue = p.created_at;
                let createdAtDisplay = '-';
                if (createdAtValue) {
                    if (typeof createdAtValue === 'string' && createdAtValue.length >= 10) {
                        createdAtDisplay = createdAtValue.substring(0, 10);
                    } else if (typeof createdAtValue === 'object' && createdAtValue.date) {
                        createdAtDisplay = createdAtValue.date.substring(0, 10);
                    }
                }
                html += `<td>${createdAtDisplay}</td>`;

原因: 前端增加类型检查，避免调用不存在的substring方法
关联问题: ISSUE_001
#========================================

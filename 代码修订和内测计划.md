# 文件管理模块代码修订和内测计划

## 一、项目概述

**目标**: 完整实现文件管理-管理页面的设计功能，包括：
- 筛选条件模块（项目类型、项目编号筛选）
- 已导入项目列表（表格展示、排序功能）
- 项目详情模态框（文件列表展示、排序功能）
- 文件操作功能（删除、下载）

**不修改**: 文件管理-导入页面（扫描、导入功能保持现状）

---

## 二、任务分解

### Phase 1: 后端 API 开发

| 序号 | 任务 | 文件 | 优先级 | 预计工时 | 状态 |
|------|------|------|--------|----------|------|
| 1.1 | 新增获取已导入项目列表 API | server.py | 高 | 2h | 待开发 |
| 1.2 | 新增获取项目文件列表 API | server.py | 高 | 1h | 待开发 |
| 1.3 | 新增删除文件 API | server.py | 高 | 2h | 待开发 |
| 1.4 | 新增下载文件 API | server.py | 高 | 2h | 待开发 |
| 1.5 | 更新 backend.py 文件操作方法 | backend.py | 高 | 3h | 待开发 |

**Phase 1 预计总工时**: 10h

### Phase 2: 前端页面更新

| 序号 | 任务 | 文件 | 优先级 | 预计工时 | 状态 |
|------|------|------|--------|----------|------|
| 2.1 | 更新筛选条件模块 HTML | files.html | 高 | 1h | 待开发 |
| 2.2 | 实现筛选条件模块 JS | files.html | 高 | 2h | 待开发 |
| 2.3 | 更新已导入项目列表表格 HTML | files.html | 高 | 1h | 待开发 |
| 2.4 | 实现已导入项目列表 JS | files.html | 高 | 2h | 待开发 |
| 2.5 | 实现已导入项目列表排序功能 | files.html | 高 | 2h | 待开发 |
| 2.6 | 新增项目详情模态框 HTML | files.html | 高 | 2h | 待开发 |
| 2.7 | 实现项目详情模态框 JS | files.html | 高 | 3h | 待开发 |
| 2.8 | 实现文件列表排序功能 | files.html | 高 | 1h | 待开发 |
| 2.9 | 实现删除确认模态框 | files.html | 高 | 1h | 待开发 |
| 2.10 | 实现删除功能 JS | files.html | 高 | 2h | 待开发 |
| 2.11 | 实现下载功能 JS | files.html | 高 | 2h | 待开发 |

**Phase 2 预计总工时**: 19h

### Phase 3: 内测验证
**全部内测均在本地编写测试脚本，直接运行的传入docker容器内进行测试，以HTTP访问形式进行的内测通过访问localhost:20425（容器暴露地址）进行，通过读取错误报告以及docker log寻找问题并解决**

| 序号 | 测试项 | 测试类型 | 优先级 | 状态 |
|------|--------|----------|--------|------|
| 3.1 | 筛选条件功能测试 | 功能测试 | 高 | 待测试 |
| 3.2 | 已导入项目列表展示测试 | 功能测试 | 高 | 待测试 |
| 3.3 | 已导入项目列表排序测试 | 功能测试 | 高 | 待测试 |
| 3.4 | 项目详情查看测试 | 功能测试 | 高 | 待测试 |
| 3.5 | 文件列表排序测试 | 功能测试 | 高 | 待测试 |
| 3.6 | 文件删除功能测试 | 功能测试 | 高 | 待测试 |
| 3.7 | 文件下载功能测试 | 功能测试 | 高 | 待测试 |
| 3.8 | API 接口测试 | API 测试 | 高 | 待测试 |

**Phase 3 预计总工时**: 8h

---

## 三、详细实施计划

### Phase 1: 后端 API 开发

#### 1.1 获取已导入项目列表 API

**API**: `GET /api/files/imported-projects`

**参数**:
- `file_project_type`: 项目类型筛选 (raw/result/空)
- `file_project_ids`: 逗号分隔的项目编号

**请求示例**:
```
GET /api/files/imported-projects?file_project_type=raw&file_project_ids=RAW_XXX,RAW_YYY
```

**响应格式**:
```json
{
    "success": true,
    "data": [
        {
            "project_id": "RAW_XXX",
            "project_type": "raw",
            "title": "项目名称",
            "created_at": "2026-01-01 10:00:00",
            "file_count": 10
        }
    ],
    "total": 1
}
```

**实现逻辑**:
```python
@bp.route('/api/files/imported-projects', methods=['GET'])
def get_imported_projects():
    """
    获取已导入项目列表
    
    1. 解析参数: file_project_type, file_project_ids
    2. 查询 file_record 获取符合条件的项目
    3. 关联查询 raw_project/result_project 获取项目信息
    4. 返回项目信息列表
    """
```

**SQL 查询逻辑**:
```sql
-- 查询符合条件的项目
SELECT DISTINCT file_project_id, file_project_type
FROM file_record
WHERE 1=1
  AND (:file_project_type IS NULL OR file_project_type = :file_project_type)
  AND (:file_project_ids IS NULL OR file_project_id IN (:file_project_ids))
```

#### 1.2 获取项目文件列表 API

**API**: `GET /api/files`

**参数**:
- `project_id`: 项目编号（必填）

**请求示例**:
```
GET /api/files?project_id=RAW_XXX
```

**响应格式**:
```json
{
    "success": true,
    "project_id": "RAW_XXX",
    "project_type": "raw",
    "files": [
        {
            "id": 1,
            "file_name": "sample1.fastq.gz",
            "file_size": 1612345678,
            "file_type": "fastq.gz",
            "imported_at": "2026-01-01 10:30:00"
        }
    ],
    "total": 1
}
```

#### 1.3 删除文件 API

**API**: `DELETE /api/files`

**请求体**:
```json
{
    "file_ids": [1, 2, 3]
}
```

**实现逻辑**:
```python
@bp.route('/api/files', methods=['DELETE'])
def delete_files():
    """
    删除文件
    
    1. 获取 file_ids
    2. 查询文件信息（file_path, file_name）
    3. 移动文件到 /bio/recycle/{file_path}/
    4. 删除 file_record 表中的记录
    5. 返回结果
    """
```

**文件移动逻辑**:
```python
src_path = Path('/bio') / file_path / file_name
dst_path = Path('/bio/recycle') / file_path / file_name
dst_path.parent.mkdir(parents=True, exist_ok=True)
shutil.move(str(src_path), str(dst_path))
```

#### 1.4 下载文件 API

**API**: `POST /api/files/download`

**请求体**:
```json
{
    "file_ids": [1, 2, 3]
}
```

**响应**:
- Content-Type: application/zip
- Content-Disposition: attachment; filename="download.zip"
- Body: ZIP 文件流

**实现逻辑**:
```python
@bp.route('/api/files/download', methods=['POST'])
def download_files():
    """
    下载文件
    
    1. 获取 file_ids
    2. 查询文件信息（file_path, file_name）
    3. 读取文件内容
    4. 打包为 ZIP 文件
    5. 返回文件流
    """
    import zipfile
    import io
    
    memory_file = io.BytesIO()
    with zipfile.ZipFile(memory_file, 'w', zipfile.ZIP_DEFLATED) as zf:
        for f in files:
            file_path = Path('/bio') / f['file_path'] / f['file_name']
            if file_path.exists():
                zf.write(str(file_path), f['file_name'])
    
    memory_file.seek(0)
    return send_file(memory_file, ...)
```

---

### Phase 2: 前端页面更新

#### 2.1 筛选条件模块 HTML

```html
<!-- 筛选条件 -->
<div class="card mb-3">
    <div class="card-body">
        <div class="row g-2 align-items-center">
            <div class="col-auto">
                <select class="form-select form-select-sm" id="filter-project-type">
                    <option value="">项目类型 (全部)</option>
                    <option value="raw">原始数据</option>
                    <option value="result">结果数据</option>
                </select>
            </div>
            <div class="col-auto">
                <input type="text" class="form-control form-control-sm" 
                       id="filter-project-id" placeholder="项目编号（逗号分隔）">
            </div>
            <div class="col-auto">
                <button type="button" class="btn btn-outline-primary btn-sm" onclick="applyFilter()">
                    <i class="bi bi-search"></i> 查询
                </button>
            </div>
        </div>
    </div>
</div>
```

#### 2.2 已导入项目列表表格 HTML

```html
<!-- 已导入项目表格 -->
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <span><i class="bi bi-list me-2"></i>已导入项目</span>
        <span class="badge bg-secondary" id="project-count">0 个</span>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th style="width: 50px;">#</th>
                        <th data-sortable="true" data-sort-column="project_id" style="cursor: pointer;">
                            项目编号 <i class="bi bi-dash sort-icon"></i>
                        </th>
                        <th data-sortable="true" data-sort-column="title" style="cursor: pointer;">
                            项目名称 <i class="bi bi-dash sort-icon"></i>
                        </th>
                        <th data-sortable="true" data-sort-column="project_type" style="cursor: pointer;">
                            项目类型 <i class="bi bi-dash sort-icon"></i>
                        </th>
                        <th data-sortable="true" data-sort-column="created_at" style="cursor: pointer;">
                            创建时间 <i class="bi bi-dash sort-icon"></i>
                        </th>
                        <th data-sortable="true" data-sort-column="file_count" style="cursor: pointer;">
                            文件数量 <i class="bi bi-dash sort-icon"></i>
                        </th>
                        <th style="width: 80px;">操作</th>
                    </tr>
                </thead>
                <tbody id="project-list">
                    <!-- 动态渲染 -->
                </tbody>
            </table>
        </div>
    </div>
</div>
```

#### 2.3 项目详情模态框 HTML

```html
<!-- 项目详情模态框 -->
<div class="modal fade" id="detail-modal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-folder2-open me-2"></i>项目详情 - <span id="detail-project-id"></span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <!-- 项目基本信息 -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <strong>项目名称:</strong> <span id="detail-title"></span>
                    </div>
                    <div class="col-md-6">
                        <strong>创建时间:</strong> <span id="detail-created-at"></span>
                    </div>
                    <div class="col-md-6">
                        <strong>项目类型:</strong> <span id="detail-type"></span>
                    </div>
                    <div class="col-md-6">
                        <strong>文件数量:</strong> <span id="detail-file-count"></span>
                    </div>
                </div>
                <hr>
                <!-- 文件列表 -->
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light">
                            <tr>
                                <th style="width: 40px;">
                                    <input type="checkbox" id="select-all-files">
                                </th>
                                <th data-sortable="true" data-sort-column="file_name" style="cursor: pointer;">
                                    文件名 <i class="bi bi-dash sort-icon"></i>
                                </th>
                                <th data-sortable="true" data-sort-column="file_size" style="cursor: pointer;">
                                    文件大小 <i class="bi bi-dash sort-icon"></i>
                                </th>
                                <th data-sortable="true" data-sort-column="file_type" style="cursor: pointer;">
                                    文件类型 <i class="bi bi-dash sort-icon"></i>
                                </th>
                                <th data-sortable="true" data-sort-column="imported_at" style="cursor: pointer;">
                                    导入时间 <i class="bi bi-dash sort-icon"></i>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="file-list">
                            <!-- 动态渲染 -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" id="btn-delete" disabled>
                    <i class="bi bi-trash me-1"></i>删除
                </button>
                <button type="button" class="btn btn-primary" id="btn-download" disabled>
                    <i class="bi bi-download me-1"></i>下载
                </button>
            </div>
        </div>
    </div>
</div>
```

#### 2.4 删除确认模态框 HTML

```html
<!-- 删除确认模态框 -->
<div class="modal fade" id="delete-confirm-modal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">
                    <i class="bi bi-exclamation-triangle me-2"></i>确认删除
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p class="mb-3">确定要删除选中的文件吗？此操作不可恢复。</p>
                <p class="mb-2 fw-bold">请输入 <span class="text-danger">"我已知晓，确认删除"</span> 以确认操作:</p>
                <input type="text" class="form-control" id="delete-confirm-input" 
                       placeholder="我已知晓，确认删除">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-danger" onclick="confirmDelete()">
                    <i class="bi bi-trash me-1"></i>确认删除
                </button>
            </div>
        </div>
    </div>
</div>
```

#### 2.5 JavaScript 实现

```javascript
// 全局变量
let projectList = [];
let projectSortState = { column: 'project_id', direction: 'asc' };
let detailFileList = [];
let detailSortState = { column: 'imported_at', direction: 'desc' };

// ========== 筛选功能 ==========

function applyFilter() {
    const projectType = $('#filter-project-type').val();
    const projectIdInput = $('#filter-project-id').val();
    const projectIds = parseProjectIds(projectIdInput);
    
    apiGet('/api/files/imported-projects', {
        file_project_type: projectType || undefined,
        file_project_ids: projectIds.length > 0 ? projectIds.join(',') : undefined
    }).then(function(res) {
        if (res.success && res.data) {
            projectList = res.data;
            renderProjectList();
        }
    });
}

function parseProjectIds(input) {
    if (!input || !input.trim()) return [];
    return input.split(/[,，]/).map(id => id.trim()).filter(id => id);
}

// ========== 列表渲染 ==========

function renderProjectList() {
    const tbody = $('#project-list');
    $('#project-count').text(projectList.length + ' 个');
    
    // 排序
    const sortedList = sortProjects([...projectList]);
    
    if (sortedList.length === 0) {
        tbody.html(`
            <tr>
                <td colspan="7" class="text-center py-4 text-muted">
                    <i class="bi bi-inbox fs-4 d-block mb-2"></i>
                    暂无符合条件的项目
                </td>
            </tr>
        `);
        return;
    }
    
    let html = '';
    sortedList.forEach(function(p, index) {
        const typeLabel = p.project_type === 'raw' ? '原始数据' : '结果数据';
        html += `
            <tr>
                <td>${index + 1}</td>
                <td><code>${p.project_id}</code></td>
                <td>${p.title || '-'}</td>
                <td><span class="badge bg-info">${typeLabel}</span></td>
                <td>${p.created_at || '-'}</td>
                <td>${p.file_count || 0}</td>
                <td>
                    <button class="btn btn-outline-primary btn-sm" 
                            onclick="showProjectDetail('${p.project_id}', '${p.project_type}')">
                        <i class="bi bi-eye"></i> 查看
                    </button>
                </td>
            </tr>
        `;
    });
    tbody.html(html);
}

// ========== 排序功能 ==========

function sortProjects(projects) {
    return projects.sort((a, b) => {
        let valueA = a[projectSortState.column];
        let valueB = b[projectSortState.column];
        
        if (valueA === null || valueA === undefined) valueA = '';
        if (valueB === null || valueB === undefined) valueB = '';
        
        if (projectSortState.column === 'file_count') {
            return projectSortState.direction === 'asc' 
                ? (valueA || 0) - (valueB || 0)
                : (valueB || 0) - (valueA || 0);
        }
        
        if (projectSortState.column === 'created_at') {
            const dateA = new Date(valueA);
            const dateB = new Date(valueB);
            return projectSortState.direction === 'asc' 
                ? dateA.getTime() - dateB.getTime()
                : dateB.getTime() - dateA.getTime();
        }
        
        const strA = String(valueA).toLowerCase();
        const strB = String(valueB).toLowerCase();
        
        if (strA < strB) return projectSortState.direction === 'asc' ? -1 : 1;
        if (strA > strB) return projectSortState.direction === 'asc' ? 1 : -1;
        return 0;
    });
}

// ========== 项目详情 ==========

function showProjectDetail(projectId, projectType) {
    apiGet('/api/files', { project_id: projectId }).then(function(res) {
        if (res.success) {
            renderDetailModal(projectId, projectType, res.files || []);
        }
    });
}

function renderDetailModal(projectId, projectType, files) {
    const typeLabel = projectType === 'raw' ? '原始数据' : '结果数据';
    
    $('#detail-project-id').text(projectId);
    $('#detail-type').text(typeLabel);
    $('#detail-file-count').text(files.length);
    
    // 获取项目信息
    const project = projectList.find(p => p.project_id === projectId);
    if (project) {
        $('#detail-title').text(project.title || '-');
        $('#detail-created-at').text(project.created_at || '-');
    }
    
    // 渲染文件列表
    renderFileList(files);
    
    // 显示模态框
    $('#detail-modal').data('project-id', projectId);
    $('#detail-modal').data('project-type', projectType);
    $('#detail-modal').modal('show');
}

function renderFileList(files) {
    const tbody = $('#file-list');
    
    // 排序
    const sortedFiles = sortFiles([...files]);
    
    if (sortedFiles.length === 0) {
        tbody.html(`
            <tr>
                <td colspan="5" class="text-center py-4 text-muted">
                    该项目暂无文件
                </td>
            </tr>
        `);
        $('#btn-delete, #btn-download').prop('disabled', true);
        return;
    }
    
    let html = '';
    sortedFiles.forEach(function(f) {
        html += `
            <tr>
                <td><input type="checkbox" class="file-checkbox" value="${f.id}"></td>
                <td>${f.file_name}</td>
                <td>${formatFileSize(f.file_size)}</td>
                <td>${f.file_type}</td>
                <td>${f.imported_at}</td>
            </tr>
        `;
    });
    tbody.html(html);
    $('#btn-delete, #btn-download').prop('disabled', false);
}

function formatFileSize(bytes) {
    if (bytes === 0) return '0 B';
    const units = ['B', 'KB', 'MB', 'GB'];
    const k = 1024;
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + units[i];
}

// ========== 文件操作 ==========

function deleteSelectedFiles() {
    const selectedIds = [];
    $('.file-checkbox:checked').each(function() {
        selectedIds.push(parseInt($(this).val()));
    });
    
    if (selectedIds.length === 0) {
        showToast('请选择要删除的文件', 'warning');
        return;
    }
    
    $('#delete-confirm-modal').modal('show');
}

function confirmDelete() {
    const confirmText = $('#delete-confirm-input').val();
    if (confirmText !== '我已知晓，确认删除') {
        showToast('请输入正确的确认文字', 'error');
        return;
    }
    
    const selectedIds = [];
    $('.file-checkbox:checked').each(function() {
        selectedIds.push(parseInt($(this).val()));
    });
    
    apiDelete('/api/files', { file_ids: selectedIds }).then(function(res) {
        if (res.success) {
            showToast('删除成功', 'success');
            $('#delete-confirm-modal').modal('hide');
            $('#delete-confirm-input').val('');
            
            // 刷新文件列表
            const projectId = $('#detail-modal').data('project-id');
            showProjectDetail(projectId);
        } else {
            showToast(res.message || '删除失败', 'error');
        }
    });
}

function downloadSelectedFiles() {
    const selectedIds = [];
    $('.file-checkbox:checked').each(function() {
        selectedIds.push(parseInt($(this).val()));
    });
    
    if (selectedIds.length === 0) {
        showToast('请选择要下载的文件', 'warning');
        return;
    }
    
    // 创建表单提交
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = '/api/files/download';
    form.style.display = 'none';
    
    const input = document.createElement('input');
    input.type = 'hidden';
    input.name = 'file_ids';
    input.value = JSON.stringify(selectedIds);
    form.appendChild(input);
    
    document.body.appendChild(form);
    form.submit();
    document.body.removeChild(form);
    
    showToast('开始下载...', 'info');
}

// ========== 事件绑定 ==========

$(document).ready(function() {
    // 初始加载
    applyFilter();
    
    // 绑定排序事件
    $('#project-list thead th[data-sortable="true"]').click(function() {
        const column = $(this).data('sort-column');
        toggleProjectSort(column);
    });
    
    // 全选
    $('#select-all-files').change(function() {
        $('.file-checkbox').prop('checked', this.checked);
    });
    
    // 删除按钮
    $('#btn-delete').click(deleteSelectedFiles);
    
    // 下载按钮
    $('#btn-download').click(downloadSelectedFiles);
});
```

---

## 四、内测计划

### 4.1 测试环境

| 环境 | 说明 |
|------|------|
| 开发环境 | 本地 Docker Compose |
| 测试端口 | 20425 |
| 测试数据 | RAW_3wmeLnbg 项目（包含 sample.fastq） |

### 4.2 测试用例

#### 功能测试 - 筛选条件模块

| 用例编号 | 测试场景 | 预期结果 | 优先级 |
|---------|---------|---------|--------|
| FT-001 | 不选择项目类型，输入项目编号 | 显示匹配的项目 | 高 |
| FT-002 | 选择原始数据类型，不输入项目编号 | 显示所有原始数据项目 | 高 |
| FT-003 | 选择结果数据类型，输入多个项目编号 | 显示匹配的结果数据项目 | 高 |
| FT-004 | 输入中文逗号分隔的项目编号 | 正确解析并筛选 | 中 |
| FT-005 | 输入英文逗号分隔的项目编号 | 正确解析并筛选 | 中 |

#### 功能测试 - 列表排序功能

| 用例编号 | 测试场景 | 预期结果 | 优先级 |
|---------|---------|---------|--------|
| FT-006 | 点击项目编号列标题 | 按项目编号升序/降序排列 | 高 |
| FT-007 | 点击文件数量列标题 | 按文件数量升序/降序排列 | 高 |
| FT-008 | 切换不同列排序 | 新列排序，原排序清除 | 高 |
| FT-009 | 第三次点击同一列 | 恢复默认排序 | 中 |

#### 功能测试 - 项目详情模态框

| 用例编号 | 测试场景 | 预期结果 | 优先级 |
|---------|---------|---------|--------|
| FT-010 | 点击查看按钮 | 弹出模态框显示文件列表 | 高 |
| FT-011 | 空项目点击查看 | 显示"暂无文件" | 高 |
| FT-012 | 点击文件名列排序 | 按文件名升序/降序排列 | 高 |
| FT-013 | 点击文件大小列排序 | 按大小升序/降序排列 | 高 |

#### 功能测试 - 文件操作

| 用例编号 | 测试场景 | 预期结果 | 优先级 |
|---------|---------|---------|--------|
| FT-014 | 选择单个文件，点击删除 | 弹出确认框，确认后删除 | 高 |
| FT-015 | 选择多个文件，点击删除 | 弹出确认框，确认后删除 | 高 |
| FT-016 | 删除后刷新 | 文件从列表移除 | 高 |
| FT-017 | 选择单个文件，点击下载 | 下载单个文件 | 高 |
| FT-018 | 选择多个文件，点击下载 | 下载 ZIP 包 | 高 |
| FT-019 | 验证回收站目录 | 文件移动到 /bio/recycle/ | 高 |

#### API 测试

| 用例编号 | API | 测试场景 | 预期结果 |
|---------|-----|---------|---------|
| AT-001 | GET /api/files/imported-projects | 无参数 | 返回所有项目 |
| AT-002 | GET /api/files/imported-projects | 筛选参数 | 返回筛选结果 |
| AT-003 | GET /api/files?project_id=XXX | 有效项目ID | 返回文件列表 |
| AT-004 | DELETE /api/files | 有效 file_ids | 删除成功，文件移至回收站 |
| AT-005 | POST /api/files/download | 有效 file_ids | 返回 ZIP 文件流 |

### 4.3 测试数据准备

```python
# 测试数据 - 已有项目
test_project = {
    "raw_id": "RAW_3wmeLnbg",
    "raw_title": "啊手动阀",
    "raw_type": "mRNAseq",
    "raw_species": "Homo sapiens",
    "created_at": "2026-01-17 10:00:00",
    "raw_file_count": 1
}

# 测试数据 - 文件记录
test_file_records = [
    {
        "id": 1,
        "file_name": "sample.fastq",
        "file_path": "mRseq/Hs/Li",
        "file_size": 12345678,
        "file_type": "fastq",
        "file_project_type": "raw",
        "file_project_id": "RAW_3wmeLnbg",
        "imported_at": "2026-01-17 10:30:00"
    }
]
```

---

## 五、时间安排

| 阶段 | 任务 | 预计工时 | 开始时间 | 结束时间 |
|------|------|---------|---------|---------|
| Phase 1 | 后端 API 开发 | 10h | Day 1 | Day 2 |
| Phase 2 | 前端页面更新 | 19h | Day 2 | Day 4 |
| Phase 3 | 内测验证 | 8h | Day 4 | Day 5 |

**预计总工期**: 5 个工作日

---

## 六、风险评估

| 风险 | 影响 | 应对措施 |
|------|------|---------|
| API 响应性能 | 中 | 添加缓存，分页加载 |
| 大文件下载超时 | 中 | 增加超时时间，异步处理 |
| 排序状态管理复杂 | 低 | 统一管理函数，避免状态混乱 |
| 回收站目录权限 | 中 | 预先创建目录，设置权限 |

---

## 七、验收标准

1. ✅ 筛选条件能正确筛选项目
2. ✅ 列表支持按所有可排序列排序
3. ✅ 项目详情模态框正确显示文件列表
4. ✅ 文件列表支持排序
5. ✅ 删除功能正常，文件移至回收站
6. ✅ 下载功能正常，支持 ZIP 打包
7. ✅ 所有 API 接口测试通过
8. ✅ 页面无 JavaScript 错误

---

**计划制定日期**: 2026-01-21  
**预计完成日期**: 2026-01-27

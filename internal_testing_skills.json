{
  "skill_0_调度中心": {
    "description": "内测调度中心 - 根据当前状态决定调用哪个 skill",
    "state_machine": {
      "start": {
        "action": "检查是否已有测试计划",
        "transitions": [
          {
            "if": "无计划",
            "then": "skill_2a_计划撰写"
          },
          {
            "if": "有计划无索引",
            "then": "skill_2b_索引创建"
          },
          {
            "if": "有计划有索引",
            "then": "判断下一步操作"
          }
        ]
      },
      "判断下一步操作": {
        "action": "根据用户意图或测试轮次决定",
        "intents": {
          "发现问题": {
            "keywords": [
              "测试",
              "检查",
              "验证",
              "渲染",
              "字段"
            ],
            "next": "skill_1_问题发现"
          },
          "分析问题": {
            "keywords": [
              "原因",
              "根因",
              "分析",
              "为什么"
            ],
            "next": "skill_3_问题分析"
          },
          "修复验证": {
            "keywords": [
              "修复",
              "验证",
              "回归",
              "确认"
            ],
            "next": "skill_4_修复验证"
          },
          "查询计划": {
            "keywords": [
              "用例",
              "计划",
              "查询",
              "第几轮"
            ],
            "next": "skill_2c_计划查询"
          },
          "循环管理": {
            "keywords": [
              "进度",
              "统计",
              "追踪",
              "轮次"
            ],
            "next": "skill_5_循环管理"
          },
          "制定计划": {
            "keywords": [
              "计划",
              "用例",
              "范围"
            ],
            "next": "skill_2a_计划撰写"
          },
          "创建索引": {
            "keywords": [
              "索引",
              "建立索引"
            ],
            "next": "skill_2b_索引创建"
          }
        }
      }
    },
    "routing_logic": {
      "user_input_analysis": {
        "method": "提取关键词 + 意图分类",
        "examples": [
          {
            "input": "检查原始数据详情页字段渲染是否正确",
            "intent": "发现问题",
            "next": "skill_1"
          },
          {
            "input": "为什么 tags 字段没有渲染",
            "intent": "分析问题",
            "next": "skill_3"
          },
          {
            "input": "修复后需要回归测试哪些用例",
            "intent": "修复验证",
            "next": "skill_4"
          },
          {
            "input": "第2轮有哪些测试用例",
            "intent": "查询计划",
            "next": "skill_2c"
          },
          {
            "input": "现在内测进度怎么样了",
            "intent": "循环管理",
            "next": "skill_5"
          }
        ]
      },
      "round_based_routing": {
        "round_1": {
          "focus": "冒烟测试 - 核心功能",
          "suggested_skills": [
            "skill_1",
            "skill_3"
          ]
        },
        "round_2": {
          "focus": "功能测试 - 完整流程",
          "suggested_skills": [
            "skill_1",
            "skill_3",
            "skill_4"
          ]
        },
        "round_3": {
          "focus": "边界测试 - 异常情况",
          "suggested_skills": [
            "skill_1",
            "skill_4"
          ]
        },
        "round_N": {
          "focus": "回归测试 - 修复验证",
          "suggested_skills": [
            "skill_4",
            "skill_5",
            "skill_2c"
          ]
        }
      }
    },
    "context_persistence": {
      "storage": "internal_testing_context.json",
      "fields": [
        "current_round",
        "total_rounds",
        "plan_exists",
        "index_exists",
        "problem_count",
        "fixed_count",
        "open_problems"
      ],
      "update_after": [
        "skill_4",
        "skill_5"
      ]
    },
    "output": {
      "next_skill": "应该调用的下一个 skill 名称",
      "params": "传递给下一个 skill 的参数",
      "reason": "为什么选择这个 skill"
    }
  },
  "skill_1_问题发现": {
    "description": "内测问题发现 - 四层验证模型",
    "core_principle": "代码 != 逻辑 != 执行 != 结果",
    "four_layer_model": {
      "layer1_数据验证": {
        "method": "直接查数据源，不经过应用层",
        "check_points": [
          "字符集",
          "配置值",
          "缓存",
          "权限"
        ],
        "tools": {
          "mysql": "docker exec mysql mysql --default-character-set=utf8mb4",
          "api": "curl -H 'Cache-Control: no-cache'",
          "file": "cat/head 查看原始文件"
        },
        "common_issues": {
          "charset": "中文乱码 → 检查字符集",
          "cache": "数据不更新 → 检查缓存",
          "permission": "查不到 → 检查权限"
        }
      },
      "layer2_逻辑验证": {
        "method": "读代码，理解数据流向",
        "check_points": [
          "条件判断",
          "跳过逻辑",
          "数据转换",
          "类型处理"
        ],
        "patterns": {
          "skip": "return\\s+",
          "condition": "if\\s*\\(.*field_type",
          "transform": "map\\s*\\(|\\.replace\\s*\\("
        },
        "common_issues": {
          "missing_return": "条件满足但提前 return",
          "unhandled_type": "缺少某种 field_type 处理",
          "wrong_condition": "if 条件写反"
        }
      },
      "layer3_执行验证": {
        "method": "换工具获取真实结果",
        "tool_chain": [
          "curl",
          "Postman",
          "Playwright",
          "DevTools"
        ],
        "playwright": {
          "template": "const {chromium}=require('playwright');(async()=>{const b=await chromium.launch();const p=await b.newPage();await p.goto(URL);const h=await p.$eval(SEL,e=>e.innerHTML);console.log(h);await b.close();})();",
          "click": "await p.click('CSS_SELECTOR');await p.waitForTimeout(1000);"
        },
        "common_issues": {
          "service_down": "服务未启动 → docker ps",
          "route_wrong": "路由错误 → 检查 Flask/Express",
          "selector_wrong": "选择器不对 → DevTools 确认",
          "timing": "元素未加载 → waitForTimeout"
        }
      },
      "layer4_结果验证": {
        "method": "量化对比预期与实际",
        "metrics": [
          "字段数量",
          "字段值",
          "field_type映射",
          "布局",
          "样式"
        ],
        "comparison": {
          "field_count": "预期14个字段，实际多少",
          "field_value": "逐个对比字段值",
          "field_type": "link→<a>，tags→<span.badge>",
          "layout": "placeholder=1→col-md-12，=2→col-md-6"
        }
      }
    },
    "discovery_flow": [
      "定义预期",
      "获取实际",
      "量化对比",
      "定位原因"
    ]
  },
  "skill_3_问题分析": {
    "description": "内测问题分析 - 根因定位与影响评估",
    "analysis_flow": {
      "step1_问题分类": {
        "categories": {
          "P0_致命": "系统崩溃/数据丢失/核心功能失效",
          "P1_严重": "主要功能异常/数据错误",
          "P2_一般": "非核心功能问题/UI异常",
          "P3_轻微": "建议优化/体验问题"
        }
      },
      "step2_根因定位": {
        "data_layer": "数据源问题 → 数据库/配置错误",
        "logic_layer": "代码逻辑问题 → 条件/转换/跳过",
        "execution_layer": "环境问题 → 服务/路由/权限",
        "result_layer": "渲染问题 → 模板/CSS/布局",
        "method": "逐层排查 + 代码审查"
      },
      "step3_影响范围评估": {
        "factors": [
          "涉及页面数",
          "涉及功能数",
          "用户影响程度",
          "数据影响程度"
        ],
        "impact_levels": {
          "high": "影响核心功能，需要立即修复",
          "medium": "影响非核心功能，下次迭代修复",
          "low": "体验问题，可以容忍"
        }
      },
      "step4_修复建议": {
        "immediate": [
          "P0/P1问题",
          "影响核心功能",
          "数据相关"
        ],
        "deferred": [
          "P2/P3问题",
          "非核心功能",
          "体验优化"
        ]
      }
    },
    "output": [
      "问题清单(带优先级)",
      "根因分析报告",
      "影响范围评估",
      "修复建议"
    ]
  },
  "skill_4_修复验证": {
    "description": "修复后验证 - 确认问题已解决",
    "verification_flow": {
      "step1_复现确认": {
        "action": "在修复前环境中确认问题存在",
        "method": "重复问题发现步骤",
        "record": "截图/日志/步骤记录"
      },
      "step2_修复实施": {
        "action": "开发修复代码",
        "principles": [
          "修复根因而非症状",
          "最小化改动",
          "保持代码风格一致"
        ]
      },
      "step3_验证测试": {
        "re_test": {
          "original_case": "原问题用例重新测试",
          "expected": "问题已解决"
        },
        "regression": {
          "related_cases": "关联功能用例测试",
          "expected": "无回归问题"
        },
        "boundary": {
          "edge_cases": "边界条件补充测试",
          "expected": "无边界问题"
        }
      },
      "step4_结果确认": {
        "pass_conditions": [
          "原问题用例测试通过",
          "关联功能测试通过",
          "无新增问题",
          "代码审查通过"
        ],
        "fail_handling": [
          "记录失败用例",
          "返回开发重新修复",
          "更新验证计划"
        ]
      }
    },
    "verification_checklist": [
      "原问题是否复现",
      "修复是否有效",
      "关联功能是否正常",
      "边界情况是否通过",
      "代码是否符合规范"
    ]
  },
  "skill_5_循环管理": {
    "description": "循环内测管理 - 问题追踪与进度控制",
    "loop_structure": {
      "round_def": {
        "duration": "通常1-2天/轮",
        "content": [
          "问题修复验证",
          "新问题发现",
          "回归测试"
        ],
        "exit": "无新增 + 存量修复"
      },
      "cycle": "round → fix → verify → round → ..."
    },
    "problem_tracking": {
      "status_flow": [
        "新建",
        "确认",
        "修复中",
        "已修复",
        "已关闭"
      ],
      "record_fields": [
        "ID",
        "描述",
        "优先级",
        "状态",
        "负责人",
        "轮次"
      ],
      "dashboard": {
        "total": "问题总数",
        "open": "未解决问题",
        "fixed": "已修复数",
        "closed": "已关闭数"
      }
    },
    "regression_management": {
      "scope": "与修复内容相关的所有功能",
      "method": "使用 skill_1 四层验证模型",
      "trigger": "每轮修复后必须执行"
    },
    "progress_control": {
      "metrics": {
        "velocity": "每轮修复问题数",
        "quality": "修复成功率",
        "stability": "回归问题率"
      },
      "stop_conditions": [
        "连续2轮无新增问题",
        "所有P0/P1问题已修复",
        "达到预设轮次上限"
      ]
    },
    "output": [
      "问题追踪表",
      "进度报告",
      "回归测试报告",
      "结束报告"
    ]
  },
  "skill_2a_计划撰写": {
    "description": "内测计划撰写 - 定义测试范围、设计用例、制定验收标准",
    "plan_structure": {
      "step1_定义范围": {
        "input": "功能需求/代码变更点",
        "questions": [
          "测试哪些页面？",
          "测试哪些功能点？",
          "涉及哪些数据流？",
          "边界条件有哪些？"
        ],
        "output": "测试范围清单"
      },
      "step2_设计用例": {
        "types": [
          {
            "name": "正向测试",
            "desc": "正常流程，验证功能正常"
          },
          {
            "name": "边界测试",
            "desc": "空值、特殊字符、超长文本"
          },
          {
            "name": "异常测试",
            "desc": "错误输入、系统异常"
          },
          {
            "name": "关联测试",
            "desc": "跨页面/跨功能影响"
          }
        ],
        "template": {
          "id": "TC_模块_序号",
          "name": "测试用例名称",
          "precondition": "前置条件",
          "steps": [
            "步骤1",
            "步骤2",
            "步骤3"
          ],
          "expected": "预期结果",
          "priority": "P0/P1/P2"
        }
      },
      "step3_定义验收标准": {
        "quantitative": [
          "API响应时间<200ms",
          "字段渲染正确率100%",
          "无JS错误"
        ],
        "qualitative": [
          "UI布局符合设计",
          "交互流畅无卡顿"
        ],
        "stop_criteria": [
          "致命bug未修复",
          "核心功能失效",
          "数据丢失风险"
        ]
      },
      "step4_时间安排": {
        "round_based": [
          {
            "round": "第1轮",
            "focus": "冒烟测试 - 核心功能"
          },
          {
            "round": "第2轮",
            "focus": "功能测试 - 完整流程"
          },
          {
            "round": "第3轮",
            "focus": "边界测试 - 异常情况"
          },
          {
            "round": "第N轮",
            "focus": "回归测试 - 修复验证"
          }
        ],
        "exit_condition": "连续2轮无新问题 + 存量问题均修复"
      }
    },
    "output": [
      "测试范围清单",
      "测试用例集合",
      "验收标准文档",
      "时间计划表"
    ],
    "store_to": "skill_2b 创建的索引系统"
  },
  "skill_2b_索引创建": {
    "description": "内测索引创建 - 为计划建立多维度索引便于快速查询",
    "index_structure": {
      "by_page": {
        "type": "dict",
        "key": "页面路径",
        "value": "相关用例ID列表",
        "example": {
          "raw_data.html": [
            "TC_RAW_001",
            "TC_RAW_002"
          ]
        }
      },
      "by_feature": {
        "type": "dict",
        "key": "功能点",
        "value": "相关用例ID列表",
        "example": {
          "字段渲染": [
            "TC_RAW_001"
          ],
          "项目创建": [
            "TC_RAW_002"
          ]
        }
      },
      "by_type": {
        "type": "dict",
        "key": "用例类型",
        "value": "用例ID列表",
        "example": {
          "正向测试": [
            "TC_001"
          ],
          "边界测试": [
            "TC_002"
          ]
        }
      },
      "by_priority": {
        "type": "dict",
        "key": "优先级",
        "value": "用例ID列表",
        "example": {
          "P0": [
            "TC_P0_001"
          ],
          "P1": [
            "TC_P1_001"
          ]
        }
      },
      "by_field_type": {
        "type": "dict",
        "key": "field_type",
        "value": "相关用例ID列表",
        "example": {
          "link": [
            "TC_LINK_001"
          ],
          "tags": [
            "TC_TAGS_001"
          ]
        }
      },
      "by_round": {
        "type": "dict",
        "key": "轮次",
        "value": "用例ID列表",
        "example": {
          "第1轮冒烟": [
            "TC_R1_001"
          ],
          "第2轮功能": [
            "TC_R2_001"
          ]
        }
      },
      "by_api": {
        "type": "dict",
        "key": "API端点",
        "value": "相关用例ID列表",
        "example": {
          "/api/metadata/fields": [
            "TC_API_001"
          ]
        }
      }
    },
    "index_storage": {
      "file": "internal_testing_index.json",
      "format": "JSON",
      "update_trigger": "skill_2a 完成后自动调用"
    },
    "output": "internal_testing_index.json - 多维度索引文件"
  },
  "skill_2c_计划查询": {
    "description": "内测计划查询 - 根据其他skill需求查询索引和计划内容",
    "query_types": {
      "by_page": {
        "input": "页面路径或文件名",
        "action": "查询 by_page 索引，返回该页面所有用例",
        "example": {
          "input": "raw_data.html",
          "output": [
            "TC_RAW_001",
            "TC_RAW_002"
          ]
        }
      },
      "by_feature": {
        "input": "功能描述或关键词",
        "action": "查询 by_feature 索引，返回相关用例",
        "example": {
          "input": "标签云渲染",
          "output": [
            "TC_TAGS_001"
          ]
        }
      },
      "by_type": {
        "input": "用例类型",
        "action": "查询 by_type 索引",
        "example": {
          "input": "边界测试",
          "output": [
            "TC_002"
          ]
        }
      },
      "by_priority": {
        "input": "优先级",
        "action": "查询 by_priority 索引，返回该优先级所有用例",
        "example": {
          "input": "P0",
          "output": [
            "TC_P0_001"
          ]
        }
      },
      "by_field_type": {
        "input": "field_type值",
        "action": "查询 by_field_type 索引，返回相关用例",
        "example": {
          "input": "tags",
          "output": [
            "TC_TAGS_001",
            "TC_TAGS_002"
          ]
        }
      },
      "by_round": {
        "input": "轮次信息",
        "action": "查询 by_round 索引，返回该轮次用例",
        "example": {
          "input": "第2轮",
          "output": [
            "TC_R2_001"
          ]
        }
      },
      "by_case_id": {
        "input": "用例ID",
        "action": "返回完整用例信息",
        "example": {
          "input": "TC_RAW_001",
          "output": {
            "name": "项目详情渲染测试",
            "steps": [
              "步1",
              "步2"
            ],
            "expected": "渲染正确"
          }
        }
      },
      "by_api": {
        "input": "API端点路径",
        "action": "查询 by_api 索引，返回相关用例",
        "example": {
          "input": "/api/metadata/fields",
          "output": [
            "TC_API_001"
          ]
        }
      }
    },
    "usage_examples": [
      {
        "scenario": "skill_1 发现字段渲染问题",
        "query": "field_type=tags 的测试用例",
        "action": "skill_2c(by_field_type, tags) 返回所有 tags 相关用例"
      },
      {
        "scenario": "skill_4 需要回归测试",
        "query": "页面=raw_data.html 且 类型=正向测试",
        "action": "skill_2c(by_page, raw_data.html) 过滤类型 返回用例"
      },
      {
        "scenario": "skill_5 统计进度",
        "query": "P0 用例完成情况",
        "action": "skill_2c(by_priority, P0) 返回所有 P0 用例进行追踪"
      }
    ],
    "output": "用例详情/用例列表/统计信息"
  }
}
# BioData Manager åº”ç”¨åŠŸèƒ½è®¾è®¡æ–‡æ¡£

## ä¸€ã€ç³»ç»Ÿæ¦‚è¿°

BioData Manager æ˜¯ä¸€ä¸ªç”Ÿç‰©ä¿¡æ¯å­¦æ•°æ®ç®¡ç†ç³»ç»Ÿï¼Œç”¨äºç®¡ç†åŸå§‹æµ‹åºæ•°æ®ã€åˆ†æç»“æœå’Œç›¸å…³å…ƒæ•°æ®ã€‚é‡‡ç”¨ **Python Flask + Jinja2 + Bootstrap 5** æŠ€æœ¯æ ˆï¼Œæä¾›å®Œæ•´çš„é¡¹ç›®ç®¡ç†ã€æ–‡ä»¶ç®¡ç†å’Œå…ƒæ•°æ®é…ç½®åŠŸèƒ½ã€‚

## äºŒã€æŠ€æœ¯é€‰å‹

| ç±»åˆ« | æŠ€æœ¯ | è¯´æ˜ |
|------|------|------|
| åç«¯æ¡†æ¶ | Flask 3.x | Python Web æ¡†æ¶ |
| æ¨¡æ¿å¼•æ“ | Jinja2 | Flask æ¨¡æ¿æ¸²æŸ“ |
| å‰ç«¯ UI | Bootstrap 5 | æœ¬åœ°åŒ– CSS/JS |
| æ•°æ®åº“ | MySQL 8.x | ä¸»æ•°æ®å­˜å‚¨ |
| HTTP å®¢æˆ·ç«¯ | jQuery AJAX | å¼‚æ­¥è¯·æ±‚å¤„ç† |
| æ–‡ä»¶å¤„ç† | Python os/shutil | æœ¬åœ°æ–‡ä»¶ç®¡ç† |

## ä¸‰ã€ç³»ç»Ÿæ¶æ„

### 3.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·æµè§ˆå™¨ (Browser)                          â”‚
â”‚                                                                     â”‚
â”‚    Bootstrap 5 + Jinja2 æ¨¡æ¿ + jQuery AJAX                         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚    â”‚  åŸå§‹æ•°æ®  â”‚  ç»“æœç®¡ç†  â”‚  æ–‡ä»¶ç®¡ç†  â”‚  å…ƒæ•°æ®ç®¡ç†       â”‚     â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚ HTTP è¯·æ±‚/å“åº”
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Python Flask åº”ç”¨ (server.py)                   â”‚
â”‚                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚  é¡µé¢è·¯ç”±    â”‚  â”‚  ä¸šåŠ¡é€»è¾‘   â”‚  â”‚  API æ¥å£   â”‚               â”‚
â”‚   â”‚ /raw-data   â”‚  â”‚ Backend     â”‚  â”‚ /api/*      â”‚               â”‚
â”‚   â”‚ /results    â”‚  â”‚ Manager     â”‚  â”‚             â”‚               â”‚
â”‚   â”‚ /files      â”‚  â”‚             â”‚  â”‚             â”‚               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚              DatabaseManager (è¿æ¥æ± ç®¡ç†)                    â”‚   â”‚
â”‚   â”‚         mysql.connector.pooling.MySQLConnectionPool         â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚ SQL (MySQL)
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        MySQL 8.4 æ•°æ®åº“                             â”‚
â”‚                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚field_config â”‚ â”‚raw_project  â”‚ â”‚select_options              â”‚  â”‚
â”‚   â”‚(å­—æ®µé…ç½®)   â”‚ â”‚(åŸå§‹æ•°æ®)   â”‚ â”‚(ä¸‹æ‹‰é€‰é¡¹)                   â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚result_projectâ”‚ â”‚file_record  â”‚ â”‚abbr_mapping                â”‚  â”‚
â”‚   â”‚(ç»“æœæ•°æ®)   â”‚ â”‚(æ–‡ä»¶è®°å½•)   â”‚ â”‚(ç¼©å†™æ˜ å°„)                   â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 è¿æ¥æ± æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DatabaseManager è¿æ¥æ± æ¶æ„                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   Flask è¯·æ±‚         è¯·æ±‚å¤„ç†          è¿æ¥æ± æ“ä½œ                     â”‚
â”‚                                                                     â”‚
â”‚   è¯·æ±‚A â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º get_connection() â”€â”€â–º ä»æ± è·å–è¿æ¥ #1           â”‚
â”‚                       â”‚                    â”‚                         â”‚
â”‚                       â–¼                    â–¼                         â”‚
â”‚                   query()              æ‰§è¡Œ SQL                      â”‚
â”‚                       â”‚                    â”‚                         â”‚
â”‚                       â–¼                    â–¼                         â”‚
â”‚                   finally: â”€â”€â–º connection.close() å½’è¿˜è¿æ¥          â”‚
â”‚                       â”‚                                              â”‚
â”‚   è¯·æ±‚B â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º get_connection() â”€â”€â–º ä»æ± è·å–è¿æ¥ #2           â”‚
â”‚                       â”‚                    â”‚                         â”‚
â”‚                       â–¼                    â–¼                         â”‚
â”‚                   execute()             æ‰§è¡Œ SQL                      â”‚
â”‚                       â”‚                    â”‚                         â”‚
â”‚                       â–¼                    â–¼                         â”‚
â”‚                   finally: â”€â”€â–º connection.close() å½’è¿˜è¿æ¥          â”‚
â”‚                                                                     â”‚
â”‚   è¿æ¥æ± é…ç½®: pool_size=20, pool_reset_session=True                 â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å››ã€ç›®å½•ç»“æ„

```
app/
â”œâ”€â”€ server.py              # Flask ä¸»åº”ç”¨ + é¡µé¢è·¯ç”± + API æ¥å£
â”œâ”€â”€ backend.py             # ä¸šåŠ¡é€»è¾‘å±‚ (BioDataManager)
â”œâ”€â”€ database_mysql.py      # æ•°æ®åº“ç®¡ç† (DatabaseManager + è¿æ¥æ± )
â”œâ”€â”€ citation_parser.py     # å¼•æ–‡è§£ææ¨¡å— (BibTeX/RIS/ENW)
â”œâ”€â”€ init_db.py             # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ metadata_config_manager_mysql.py  # å…ƒæ•°æ®é…ç½®ç®¡ç†
â”œâ”€â”€ field_names.py         # å­—æ®µåç§°å®šä¹‰
â”‚
â”œâ”€â”€ templates/             # Jinja2 æ¨¡æ¿
â”‚   â”œâ”€â”€ base.html          # åŸºç¡€æ¨¡æ¿ (å¯¼èˆªã€æ ·å¼ã€AJAX å°è£…)
â”‚   â”œâ”€â”€ index.html         # é¦–é¡µ/ä»ªè¡¨ç›˜
â”‚   â”œâ”€â”€ raw_data.html      # åŸå§‹æ•°æ®é¡µé¢
â”‚   â”œâ”€â”€ results.html       # ç»“æœç®¡ç†é¡µé¢
â”‚   â”œâ”€â”€ files.html         # æ–‡ä»¶ç®¡ç†é¡µé¢
â”‚   â”œâ”€â”€ metadata.html      # å…ƒæ•°æ®ç®¡ç†é¡µé¢
â”‚   â””â”€â”€ error.html         # é”™è¯¯é¡µé¢
â”‚
â”œâ”€â”€ static/                # é™æ€æ–‡ä»¶ (æœ¬åœ°åŒ–)
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â”œâ”€â”€ bootstrap.min.css
â”‚   â”‚   â””â”€â”€ bootstrap-icons.css
â”‚   â””â”€â”€ js/
â”‚       â”œâ”€â”€ bootstrap.bundle.min.js
â”‚       â””â”€â”€ jquery.min.js
â”‚
â””â”€â”€ docker-entrypoint.sh   # Docker å…¥å£è„šæœ¬
```

## äº”ã€æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 5.1 æ•°æ®åº“ç®¡ç†æ¨¡å— (database_mysql.py)

#### 5.1.1 DatabaseManager ç±»

```python
class DatabaseManager:
    """æ•°æ®åº“ç®¡ç†å™¨ - ä½¿ç”¨è¿æ¥æ± æ”¯æŒå¹¶å‘è¯·æ±‚"""
    
    _pool = None          # ç±»çº§åˆ«è¿æ¥æ± 
    _pool_lock = None     # çº¿ç¨‹å®‰å…¨é”
    
    def __init__(self):
        """åˆå§‹åŒ–"""
        self.connection = None
        self.config = self._load_config()
    
    def get_connection(self):
        """ä»è¿æ¥æ± è·å–è¿æ¥ (ä¸ç¼“å­˜å®ä¾‹å˜é‡)"""
        if self._pool:
            return self._pool.get_connection()
        return None
    
    def query(self, query, params=None):
        """æŸ¥è¯¢å¤šæ¡è®°å½• (è‡ªåŠ¨è·å–/å½’è¿˜è¿æ¥)"""
        connection = self.get_connection()
        if connection is None:
            return []
        
        cursor = None
        try:
            cursor = connection.cursor()
            cursor.execute(query, params)
            return cursor.fetchall()
        except Error as e:
            print(f"æŸ¥è¯¢å¤±è´¥: {e}")
            return []
        finally:
            if cursor:
                cursor.close()
            if connection:
                connection.close()
```

#### 5.1.2 è¿æ¥æ± é…ç½®

```python
cls._pool = pooling.MySQLConnectionPool(
    pool_name="biodata_pool",
    pool_size=20,              # æ”¯æŒ 20 ä¸ªå¹¶å‘è¿æ¥
    pool_reset_session=True,   # é‡ç½®ä¼šè¯çŠ¶æ€
    **config
)
```

#### 5.1.3 è¿æ¥ç”Ÿå‘½å‘¨æœŸ

```
è¯·æ±‚è¿›å…¥
    â”‚
    â–¼
get_connection() â”€â”€â”€â”€â”€â”€â–º ä»è¿æ¥æ± è·å–è¿æ¥
    â”‚
    â–¼
æ‰§è¡Œ SQL (query/execute)
    â”‚
    â–¼
finally:
    cursor.close()    â”€â”€â”€â”€â–º å…³é—­æ¸¸æ ‡
    connection.close() â”€â”€â”€â”€â–º å½’è¿˜è¿æ¥åˆ°æ± 
    â”‚
    â–¼
è¯·æ±‚å®Œæˆ
```

**å…³é”®åŸåˆ™**:
- æ¯ä¸ªæ•°æ®åº“æ“ä½œéƒ½ç‹¬ç«‹è·å–/å½’è¿˜è¿æ¥
- ä¸åœ¨å®ä¾‹å˜é‡ä¸­ç¼“å­˜è¿æ¥
- å§‹ç»ˆåœ¨ finally å—ä¸­é‡Šæ”¾èµ„æº

### 5.2 ä¸šåŠ¡é€»è¾‘æ¨¡å— (backend.py)

#### 5.2.1 BioDataManager ç±»

```python
class BioDataManager:
    """ç”Ÿç‰©æ•°æ®ä¸šåŠ¡ç®¡ç†å™¨"""
    
    def __init__(self, db_manager, config_manager):
        self.db_manager = db_manager
        self.config_manager = config_manager
    
    def get_all_raw_projects(self):
        """è·å–æ‰€æœ‰åŸå§‹æ•°æ®é¡¹ç›®"""
        return self.db_manager.query("""
            SELECT * FROM raw_project ORDER BY created_at DESC
        """)
    
    def get_all_result_projects(self):
        """è·å–æ‰€æœ‰ç»“æœæ•°æ®é¡¹ç›®"""
        return self.db_manager.query("""
            SELECT * FROM result_project ORDER BY created_at DESC
        """)
    
    def create_raw_project(self, data):
        """åˆ›å»ºåŸå§‹æ•°æ®é¡¹ç›®"""
        raw_id = f"RAW_{uuid.uuid4().hex[:8].upper()}"
        # ... æ’å…¥æ•°æ®
        return raw_id
```

### 5.3 Flask åº”ç”¨æ¨¡å— (server.py)

#### 5.3.1 å•ä¾‹æ¨¡å¼ç®¡ç†å™¨

```python
_db_manager = None
_config_manager = None
_manager = None

def get_db_manager():
    """è·å–æ•°æ®åº“ç®¡ç†å™¨ (å»¶è¿Ÿåˆå§‹åŒ–)"""
    global _db_manager
    if _db_manager is None:
        _db_manager = DatabaseManager()
    return _db_manager
```

#### 5.3.2 é¡µé¢è·¯ç”±

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/` | é¦–é¡µ |
| GET | `/raw-data` | åŸå§‹æ•°æ®åˆ—è¡¨ |
| GET | `/results` | ç»“æœç®¡ç†åˆ—è¡¨ |
| GET | `/files` | æ–‡ä»¶ç®¡ç† |
| GET | `/metadata` | å…ƒæ•°æ®é…ç½® |

#### 5.3.3 API è·¯ç”±

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/projects` | è·å–é¡¹ç›®åˆ—è¡¨ |
| GET | `/api/projects?table=result` | è·å–ç»“æœé¡¹ç›® |
| POST | `/api/projects` | åˆ›å»ºé¡¹ç›® |
| DELETE | `/api/projects/<type>/<id>` | åˆ é™¤é¡¹ç›® |
| GET | `/api/metadata/config` | è·å–å…ƒæ•°æ®é…ç½® |
| POST | `/api/files/scan` | æ‰«æç›®å½• |
| POST | `/api/files/import` | å¯¼å…¥æ–‡ä»¶ |

### 5.4 å‰ç«¯æ¨¡å— (templates/)

#### 5.4.1 åŸºç¡€æ¨¡æ¿ (base.html) - AJAX å°è£…

```javascript
// è¿æ¥æ± ç›¸å…³é…ç½®
const AJAX_POOL = {
    getDebounceMs: 200,    // GET è¯·æ±‚é˜²æŠ–é—´éš”
    postDebounceMs: 500,   // POST/PUT/DELETE é˜²æŠ–é—´éš”
    pending: new Map()     // å¾…å¤„ç†è¯·æ±‚
};

// é˜²æŠ–å‡½æ•°
function debounce(fn, delay) {
    return function(...args) {
        const key = `${fn.name}_${JSON.stringify(args)}`;
        if (AJAX_POOL.pending.has(key)) {
            return AJAX_POOL.pending.get(key);
        }
        const promise = new Promise((resolve) => {
            setTimeout(() => {
                AJAX_POOL.pending.delete(key);
                resolve(fn.apply(this, args));
            }, delay);
        });
        AJAX_POOL.pending.set(key, promise);
        return promise;
    };
}

// API è°ƒç”¨å°è£…
const apiGet = debounce(function(url, params = {}) {
    return $.get(url, params);
}, AJAX_POOL.getDebounceMs);

const apiPost = debounce(function(url, data = {}) {
    return $.ajax({
        url: url,
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(data)
    });
}, AJAX_POOL.postDebounceMs);
```

#### 5.4.2 å‰ç«¯åŠ è½½æµç¨‹

```
é¡µé¢åŠ è½½ (base.html)
    â”‚
    â–¼
$(document).ready()
    â”‚
    â”œâ”€â”€â–º åˆå§‹åŒ–å·¥å…·æç¤º
    â”‚
    â””â”€â”€â–º é¡µé¢ç‰¹å®šåˆå§‹åŒ– (raw_data.html / results.html)
            â”‚
            â”œâ”€â”€â–º apiGet('/api/metadata/config')
            â”‚        â”‚
            â”‚        â–¼
            â”‚    æ¸²æŸ“ç­›é€‰ä¸‹æ‹‰æ¡†
            â”‚
            â”œâ”€â”€â–º apiGet('/api/projects?table=xxx')
            â”‚        â”‚
            â”‚        â–¼
            â”‚    æ¸²æŸ“æ•°æ®è¡¨æ ¼
            â”‚
            â””â”€â”€â–º ç»‘å®šäº‹ä»¶å¤„ç†å™¨
                    â”‚
                    â–¼
                ç”¨æˆ·äº¤äº’ (ç­›é€‰/åˆ·æ–°/ç¼–è¾‘)
                    â”‚
                    â””â”€â”€â–º é˜²æŠ–æ§åˆ¶ â†’ AJAX è¯·æ±‚
```

## å…­ã€æ•°æ®åº“è®¾è®¡

### 6.1 æ•°æ®è¡¨ç»“æ„

| è¡¨å | è¯´æ˜ | æ ¸å¿ƒå­—æ®µ |
|------|------|----------|
| `field_config` | å…ƒæ•°æ®å­—æ®µé…ç½® | field_id, field_name, field_type, field_table, **field_readonly** |
| `raw_project` | åŸå§‹æ•°æ®é¡¹ç›® | raw_id, raw_title, raw_type, raw_species |
| `result_project` | ç»“æœæ•°æ®é¡¹ç›® | results_id, results_title, results_type, results_raw |
| `file_record` | æ–‡ä»¶è®°å½• | file_name, file_path, file_project_type, file_project_id |
| `select_options` | ä¸‹æ‹‰é€‰é¡¹ | option_type, option_value, option_label |
| `abbr_mapping` | ç¼©å†™æ˜ å°„ | field_id, full_name, abbr_name |

> **field_readonly å­—æ®µè¯´æ˜**: ç”¨äºæ§åˆ¶å­—æ®µæ˜¯å¦å¯ç¼–è¾‘ã€‚`0` = å¯ç¼–è¾‘ï¼Œ`1` = åªè¯»ï¼ˆç³»ç»Ÿè‡ªåŠ¨ç®¡ç†ï¼‰ã€‚ç³»ç»Ÿåœ¨å¯¼å…¥æ–‡ä»¶æ—¶ä¼šè‡ªåŠ¨æ›´æ–° `raw_file_count`ã€`raw_total_size`ã€`results_file_count`ã€`results_total_size` ç­‰ç»Ÿè®¡å­—æ®µï¼Œè¿™äº›å­—æ®µæ ‡è®°ä¸ºåªè¯»ã€‚

### 6.2 å­—æ®µç±»å‹æ˜ å°„

| field_type å€¼ | å‰ç«¯ç»„ä»¶ | è¯´æ˜ |
|---------------|----------|------|
| `text` | `<input type="text">` | å•è¡Œæ–‡æœ¬ |
| `textarea` | `<textarea>` | å¤šè¡Œæ–‡æœ¬ |
| `select` | `<select>` | é€‰æ‹©ä¸‹æ‹‰ï¼ˆå¤šé€‰ï¼Œé€—å·åˆ†éš”å­˜å‚¨ï¼‰ |

**ä¸‹æ‹‰æ¡†è¡Œä¸ºæ¨¡å¼**ï¼š
- **æ–°å»ºé¡¹ç›®/ç¼–è¾‘é¡¹ç›®**ï¼šå¯å¤šé€‰ï¼Œä½¿ç”¨ bootstrap-select ç»„ä»¶
- **æ–‡ä»¶å¯¼å…¥**ï¼šä»…å•é€‰

**é€—å·å¤„ç†è§„åˆ™**ï¼š
- **å‰ç«¯è¾“å…¥**ï¼šè¯†åˆ«ä¸­æ–‡é€—å· `ï¼Œ` å’Œè‹±æ–‡é€—å· `,`
- **æ•°æ®å­˜å‚¨**ï¼šç»Ÿä¸€ä½¿ç”¨è‹±æ–‡é€—å· `,` åˆ†éš”
- **å¤„ç†æ—¶æœº**ï¼šå‰ç«¯æäº¤å‰å°†ä¸­æ–‡é€—å·æ›¿æ¢ä¸ºè‹±æ–‡é€—å·

**select å­—æ®µæ•°æ®æµ**ï¼š
| åœºæ™¯ | å‰ç«¯æ˜¾ç¤º | å­˜å‚¨å€¼ | è·å–æ–¹å¼ |
|------|---------|--------|---------|
| é¡¹ç›®åˆ—è¡¨ | label | value | API è¿”å› labelï¼Œå‰ç«¯ç›´æ¥æ˜¾ç¤º |
| æ–°å»ºé¡¹ç›® | label | value | jQuery val() è·å– value |
| ç¼–è¾‘é¡¹ç›® | label (å›æ˜¾) | value | åˆ†å‰²å­˜å‚¨å€¼ï¼ŒåŒ¹é… label æ ‡è®° selected |
| ç­›é€‰æ¡† | label | value | ç”¨æˆ·é€‰ valueï¼Œè½¬ label åä¸ API è¿”å›æ¯”è¾ƒ |

**å‰ç«¯ select ç»„ä»¶ç¤ºä¾‹**ï¼š
```javascript
// å¤šé€‰æ¨¡å¼
const selected = fieldLabels.includes(String(label)) ? 'selected' : '';
`<option value="${val}" ${selected}>${label}</option>`;

// è·å–é€‰ä¸­å€¼
if ($(el).hasClass('selectpicker') && $(el).attr('multiple') !== null) {
    value = ($(el).val() || []).join(',');
}
```

### 6.3 ç¯å¢ƒå˜é‡é…ç½®

| ç¯å¢ƒå˜é‡ | è¯´æ˜ | é»˜è®¤å€¼ |
|----------|------|--------|
| `METADATA_FIELDS_NEW_RAW` | æ–°å»ºåŸå§‹æ•°æ®é¡¹ç›®æ—¶æ˜¾ç¤ºçš„å­—æ®µç¼–å· | `3,4,5,6,7` |
| `METADATA_FIELDS_EXIST_RAW` | å¯¼å…¥åˆ°å·²æœ‰åŸå§‹æ•°æ®é¡¹ç›®æ—¶æ˜¾ç¤ºçš„å­—æ®µç¼–å· | `3,4,5,6,7` |
| `METADATA_FIELDS_NEW_RESULT` | æ–°å»ºç»“æœé¡¹ç›®æ—¶æ˜¾ç¤ºçš„å­—æ®µç¼–å· | `3,4,5` |
| `METADATA_FIELDS_EXIST_RESULT` | å¯¼å…¥åˆ°å·²æœ‰ç»“æœé¡¹ç›®æ—¶æ˜¾ç¤ºçš„å­—æ®µç¼–å· | `3,4,5` |
| `METADATA_PROJECT_ROWTITLE_RAW` |åŸå§‹é¡¹ç›®ç®¡ç†é¡µé¢çš„é¡¹ç›®åˆ—è¡¨åŠ¨æ€æ¸²æŸ“çš„åˆ—çš„å­—æ®µç¼–å·| `0,2,3,4`|
| `METADATA_PROJECT_ROWTITLE_RESULT` |ç»“æœé¡¹ç›®ç®¡ç†é¡µé¢çš„é¡¹ç›®åˆ—è¡¨åŠ¨æ€æ¸²æŸ“çš„åˆ—çš„å­—æ®µç¼–å·| `0,2,3`|

> **è¯´æ˜**: å­—æ®µç¼–å·å¯¹åº” `field_config` è¡¨ä¸­çš„ `field_seq` å­—æ®µï¼Œå¤šä¸ªç¼–å·ç”¨é€—å·åˆ†éš”ã€‚é…ç½®åéœ€é‡å¯æœåŠ¡ç”Ÿæ•ˆã€‚

## ä¸ƒã€åŠŸèƒ½æ¨¡å—è¯¦ç»†è®¾è®¡

### 7.1 åŸå§‹æ•°æ®ç®¡ç†

#### åŠŸèƒ½ç‰¹æ€§
- é¡¹ç›®åˆ—è¡¨å±•ç¤ºä¸åˆ†é¡µ
- å¤šæ¡ä»¶ç­›é€‰ (æ•°æ®ç±»å‹ã€ç‰©ç§ã€ç»„ç»‡æ¥æºç­‰)
- é¡¹ç›®è¯¦æƒ…æŸ¥çœ‹ (å¼¹çª—å±•ç¤º)
- æ–°å»º/ç¼–è¾‘/åˆ é™¤é¡¹ç›®
- æ–‡çŒ®å¼•ç”¨æ–‡ä»¶å¯¼å…¥ (.bib/.ris/.enw)

#### é¡¹ç›®ç¼–å·è§„åˆ™
```
æ ¼å¼: {TYPE}_{8ä½UUID}

TYPE:
- åŸå§‹æ•°æ®: RAW
- ç»“æœæ•°æ®: RES

ç¤ºä¾‹:
- RAW_L22Y86D7
- RES_A1B2C3D4

UUIDè§„åˆ™:
- å­—ç¬¦é›†: 0-9, A-Z, a-z (å…±62ä¸ªå­—ç¬¦)
- é•¿åº¦: 8ä½
- ç”± backend.py çš„ generate_project_id() ç”Ÿæˆ
```

#### é¡µé¢å¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŸå§‹æ•°æ®                                    [æ–°å»ºåŸå§‹æ•°æ®é¡¹ç›®] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç­›é€‰æ¡ä»¶:                                                          â”‚
â”‚  [æ•°æ®ç±»å‹ â–¼] [ç‰©ç§ â–¼] [ç»„ç»‡æ¥æº â–¼]  [é‡ç½®] [åº”ç”¨ç­›é€‰]          â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ # â”‚ é¡¹ç›®ç¼–(åŠ¨æ€æ¸²æŸ“)   â”‚ æ•°æ®ç±»å‹(åŠ¨æ€æ¸²æŸ“) â”‚ ç‰©ç§(åŠ¨æ€æ¸²æŸ“)  â”‚ åˆ›å»ºæ—¶é—´ â”‚ æ“ä½œ    â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ 1 â”‚ RAW_L22Y86D7 â”‚ RNA-Seq  â”‚ äººç±»  â”‚ 2026-01  â”‚ [æŸ¥çœ‹]  â”‚   â”‚
â”‚  â”‚   â”‚           â”‚          â”‚       â”‚          â”‚ [åˆ é™¤]  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  å…± X æ¡è®°å½•  [< 1 2 3 >]  æ¯é¡µ [10 â–¼] æ¡                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
åˆ—è¡¨çš„åˆ—é‡‡å–åŠ¨æ€æ¸²æŸ“çš„æ–¹å¼å±•ç¤ºï¼ŒåŒ…æ‹¬å›ºå®šåˆ—å’ŒåŠ¨æ€æ¸²æŸ“åˆ—ï¼Œå…·ä½“å¸ƒå±€å¦‚ä¸‹ï¼š
```
|#|åŠ¨æ€æ¸²æŸ“åˆ—|åˆ›å»ºæ—¶é—´|æ“ä½œ|
````

åŠ¨æ€æ¸²æŸ“åˆ—æ ¹æ®METADATA_PROJECT_ROWTITLE_RAWç¯å¢ƒå˜é‡è¯»å–ä»¥é€—å·åˆ†éš”çš„field_seqå€¼ï¼Œè€ŒåæŸ¥è¯¢field_configè¡¨ï¼Œåœ¨åŸå§‹æ•°æ®å­—æ®µï¼ˆfield_table=raw)é‡ŒæŸ¥è¯¢field_seqç¬¦åˆè¦æ±‚çš„å­—æ®µï¼Œå¹¶æ ¹æ®field_seqä»å°åˆ°å¤§é¡ºåºè¿”å›å­—æ®µçš„field_nameå’Œfield_idã€‚è€Œååˆ—æ ‡é¢˜å°±æ˜¯field_nameï¼Œåˆ—å…·ä½“å±•ç¤º/æŸ¥è¯¢çš„å…ƒæ•°æ®å€¼å°±æ˜¯ä»¥åˆ—å=field_idå»raw_projectè¡¨æŸ¥è¯¢å…·ä½“å€¼ã€‚

### 7.2 ç»“æœæ•°æ®ç®¡ç†

ä¸åŸå§‹æ•°æ®ç®¡ç†åŠŸèƒ½ç›¸åŒï¼Œé’ˆå¯¹ `result_project` è¡¨è¿›è¡Œç®¡ç†ã€‚ä½†åŠ¨æ€æ¸²æŸ“åˆ—ä¿¡æ¯åˆ™å»field_table=resultè¿›è¡ŒæŸ¥è¯¢ï¼Œåˆ—å€¼å»result_projectè¡¨æŸ¥è¯¢å€¼ã€‚

#### ç‰¹æœ‰åŠŸèƒ½
- å…³è”åŸå§‹æ•°æ®é¡¹ç›® (`results_raw` å­—æ®µï¼Œæ”¯æŒé€—å·åˆ†éš”å¤šä¸ªé¡¹ç›®ç¼–å·)
- ç»“æœç±»å‹åˆ†ç±» (DEAã€Markerã€Enrichmentã€PPIã€Network ç­‰)

#### å…³è”é¡¹ç›®ç¼–å·å¤„ç†è§„åˆ™
- `results_raw` å­—æ®µæ”¯æŒé€—å·åˆ†éš”è¾“å…¥å¤šä¸ªåŸå§‹é¡¹ç›®ç¼–å·ï¼ˆä¸­è‹±æ–‡é€—å·éƒ½è¯†åˆ«ï¼‰
- å‰ç«¯æäº¤å‰è‡ªåŠ¨å°†ä¸­æ–‡é€—å·æ›¿æ¢ä¸ºè‹±æ–‡é€—å·
- å¤šä¸ªé¡¹ç›®ç¼–å·æŒ‰ ASCII å­—æ¯é¡ºåºæ’åºåç›´æ¥ç»„åˆï¼ˆæ— åˆ†éš”ç¬¦ï¼‰
- å­˜å‚¨è·¯å¾„ç¤ºä¾‹: `/bio/results/RES_X1Y2Z3/DEA/RAW_A1RAW_B2RAW_C3/`

### 7.3 æ–‡ä»¶ç®¡ç† - ç®¡ç†é¡µé¢

#### åŠŸèƒ½æ¦‚è¿°

æ–‡ä»¶ç®¡ç†-ç®¡ç†é¡µé¢æä¾›æ–‡ä»¶é¡¹ç›®çš„ç­›é€‰ã€æŸ¥çœ‹å’Œæ–‡ä»¶æ“ä½œåŠŸèƒ½ï¼Œé€šè¿‡"ç®¡ç†"å’Œ"å¯¼å…¥"ä¸¤ä¸ªæ ‡ç­¾é¡µåˆ‡æ¢ä¸åŒçš„åŠŸèƒ½æ¨¡å—ã€‚

#### é¡µé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–‡ä»¶ç®¡ç†                                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ç®¡ç†] [å¯¼å…¥]                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ç­›é€‰æ¡ä»¶                                                             â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ [é¡¹ç›®ç±»å‹ â–¼] [é¡¹ç›®ç¼–å·      ]  [æŸ¥è¯¢]                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ å·²å¯¼å…¥é¡¹ç›®                                            (å…± X ä¸ªé¡¹ç›®)  â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ # â”‚ é¡¹ç›®ç¼–å·     â”‚ é¡¹ç›®åç§° â”‚ é¡¹ç›®ç±»å‹ â”‚ åˆ›å»ºæ—¶é—´ â”‚ æ–‡ä»¶æ•°é‡ â”‚ æ“ä½œ â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ 1 â”‚ RAW_XXX     â”‚ é¡¹ç›®A   â”‚ åŸå§‹æ•°æ® â”‚ 2026-01  â”‚ 10      â”‚[è¯¦æƒ…]â”‚   â”‚
â”‚  â”‚ 2 â”‚ RES_YYY     â”‚ é¡¹ç›®B   â”‚ ç»“æœæ•°æ® â”‚ 2026-01  â”‚ 5       â”‚[è¯¦æƒ…]â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  å…± X æ¡è®°å½•  [< 1 2 3 >]  æ¯é¡µ [10 â–¼] æ¡                                   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ ‡ç­¾é¡µç»“æ„

| æ ‡ç­¾ | åŠŸèƒ½ |
|------|------|
| ç®¡ç† | ç­›é€‰å·²å¯¼å…¥é¡¹ç›®ã€æŸ¥çœ‹é¡¹ç›®è¯¦æƒ…ã€ç®¡ç†æ–‡ä»¶ |
| å¯¼å…¥ | æ‰«æä¸‹è½½ç›®å½•ã€å¯¼å…¥æ–°æ–‡ä»¶ |

#### 7.3.1 ç­›é€‰æ¡ä»¶æ¨¡å—ï¼ˆç®¡ç†æ ‡ç­¾é¡µå†…ï¼‰

##### åŠŸèƒ½æè¿°

æ ¹æ®ç”¨æˆ·é€‰æ‹©çš„é¡¹ç›®ç±»å‹å’Œè¾“å…¥çš„é¡¹ç›®ç¼–å·ï¼Œå‘åå°å‘é€è¯·æ±‚è·å–ç¬¦åˆæ¡ä»¶çš„é¡¹ç›®ä¿¡æ¯ã€‚

##### å‰ç«¯äº¤äº’

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç­›é€‰æ¡ä»¶                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [é¡¹ç›®ç±»å‹ â–¼] [é¡¹ç›®ç¼–å·      ]  [æŸ¥è¯¢]                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é¡¹ç›®ç±»å‹é€‰é¡¹:                                                    â”‚
â”‚   - å…¨éƒ¨ï¼ˆé»˜è®¤ï¼‰                                                  â”‚
â”‚   - åŸå§‹æ•°æ® (raw)                                               â”‚
â”‚   - ç»“æœæ•°æ® (result)                                            â”‚
â”‚                                                                 â”‚
â”‚ é¡¹ç›®ç¼–å·è¾“å…¥:                                                    â”‚
â”‚   - æ”¯æŒé€—å·åˆ†éš”è¾“å…¥å¤šä¸ªé¡¹ç›®ç¼–å·ï¼ˆä¸­è‹±æ–‡é€—å·éƒ½å¯ï¼‰                  â”‚
â”‚   - ä¾‹å¦‚: RAW_XXX, RES_YYY, RAW_ZZZ                              â”‚
â”‚   - ç•™ç©ºåˆ™è¡¨ç¤ºä¸é™åˆ¶é¡¹ç›®ç¼–å·                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

##### ç­›é€‰é€»è¾‘

**æŸ¥è¯¢æ¡ä»¶ç»„åˆè§„åˆ™ï¼š**
```
æœ€ç»ˆæŸ¥è¯¢ = é¡¹ç›®ç±»å‹æ¡ä»¶ AND (é¡¹ç›®ç¼–å·1 OR é¡¹ç›®ç¼–å·2 OR ...)

ç¤ºä¾‹:
- é¡¹ç›®ç±»å‹=raw, é¡¹ç›®ç¼–å·=RAW_A,RAW_B
  â†’ file_project_type='raw' AND (file_project_id='RAW_A' OR file_project_id='RAW_B')

- é¡¹ç›®ç±»å‹=ç•™ç©º, é¡¹ç›®ç¼–å·=ç•™ç©º
  â†’ è¿”å›æ‰€æœ‰é¡¹ç›® (æ— ç­›é€‰æ¡ä»¶)

- é¡¹ç›®ç±»å‹=raw, é¡¹ç›®ç¼–å·=ç•™ç©º
  â†’ file_project_type='raw'

- é¡¹ç›®ç±»å‹=ç•™ç©º, é¡¹ç›®ç¼–å·=RAW_A,RAW_B
  â†’ (file_project_id='RAW_A' OR file_project_id='RAW_B')
```

| é¡¹ç›®ç±»å‹ | é¡¹ç›®ç¼–å·è¾“å…¥ | ç­›é€‰è¡Œä¸º |
|---------|-------------|---------|
| å…¨éƒ¨ | ç•™ç©º | æ˜¾ç¤ºæ‰€æœ‰é¡¹ç›® |
| åŸå§‹æ•°æ® | ç•™ç©º | æ˜¾ç¤ºæ‰€æœ‰ raw ç±»å‹é¡¹ç›® |
| ç»“æœæ•°æ® | ç•™ç©º | æ˜¾ç¤ºæ‰€æœ‰ result ç±»å‹é¡¹ç›® |
| å…¨éƒ¨ | RAW_A,RAW_B | æ˜¾ç¤ºç¼–å·ä¸º RAW_A æˆ– RAW_B çš„æ‰€æœ‰é¡¹ç›® |
| åŸå§‹æ•°æ® | RAW_A,RAW_B | æ˜¾ç¤º raw ç±»å‹ä¸”ç¼–å·ä¸º RAW_A æˆ– RAW_B çš„é¡¹ç›® |
| ç»“æœæ•°æ® | RAW_A,RAW_B | æ˜¾ç¤º result ç±»å‹ä¸”ç¼–å·ä¸º RAW_A æˆ– RAW_B çš„é¡¹ç›® |

##### å‰ç«¯ä»£ç ç¤ºä¾‹

```javascript
// è§£æé¡¹ç›®ç¼–å·è¾“å…¥ï¼ˆæ”¯æŒä¸­è‹±æ–‡é€—å·ï¼‰
function parseProjectIds(input) {
    if (!input.trim()) return [];
    // æ”¯æŒä¸­æ–‡é€—å·å’Œè‹±æ–‡é€—å·
    return input.split(/[,ï¼Œ]/).map(id => id.trim()).filter(id => id);
}

// åº”ç”¨ç­›é€‰
function applyFilter() {
    const projectType = $('#filter-project-type').val();
    const projectIdInput = $('#filter-project-id').val();
    const projectIds = parseProjectIds(projectIdInput);
    
    apiGet('/api/files/imported-projects', {
        file_project_type: projectType || undefined,
        file_project_ids: projectIds.length > 0 ? projectIds.join(',') : undefined
    }).then(function(res) {
        if (res.success) {
            renderProjectList(res.data);
        }
    });
}

// é‡ç½®ç­›é€‰
function resetFilter() {
    $('#filter-project-type').val('');
    $('#filter-project-id').val('');
    applyFilter(); // åŠ è½½å…¨éƒ¨é¡¹ç›®
}
```

#### 7.3.2 å·²å¯¼å…¥é¡¹ç›®è¡¨æ ¼æ¨¡å—ï¼ˆç®¡ç†æ ‡ç­¾é¡µå†…ï¼‰

##### è¡¨æ ¼å­—æ®µè¯´æ˜

| å­—æ®µ | æ•°æ®åº“æ¥æº | è¯´æ˜ |
|------|-----------|------|
| # | åºå· | è‡ªåŠ¨ç¼–å· |
| é¡¹ç›®ç¼–å· | file_record.file_project_id | æ‰€å±é¡¹ç›®ç¼–å· |
| é¡¹ç›®åç§° | raw_project.raw_title / result_project.results_title | é¡¹ç›®æ ‡é¢˜ |
| é¡¹ç›®ç±»å‹ | file_record.file_project_type | raw / result |
| åˆ›å»ºæ—¶é—´ | raw_project.created_at / result_project.created_at | é¡¹ç›®åˆ›å»ºæ—¶é—´ |
| æ–‡ä»¶æ•°é‡ | raw_project.raw_file_count / result_project.results_file_count | å…³è”æ–‡ä»¶æ•°é‡ |
| æ“ä½œ | - | æŸ¥çœ‹è¯¦æƒ…æŒ‰é’® |

##### æ•°æ®è·å–æµç¨‹

```
ç”¨æˆ·é€‰æ‹©ç­›é€‰æ¡ä»¶
        â”‚
        â–¼
å‰ç«¯å‘é€è¯·æ±‚: GET /api/files/imported-projects
    å‚æ•°: file_project_type?, file_project_ids?
        â”‚
        â–¼
åå°æŸ¥è¯¢ file_record è¡¨è·å–ç¬¦åˆæ¡ä»¶çš„ file_project_id å’Œ file_project_type
        â”‚
        â–¼
æ ¹æ® file_project_type å…³è”æŸ¥è¯¢ raw_project æˆ– result_project
        â”‚
        â–¼
è¿”å›: [{ project_id, project_type, title, created_at, file_count }, ...]
        â”‚
        â–¼
å‰ç«¯æ¸²æŸ“è¡¨æ ¼
```

##### å‰ç«¯ä»£ç ç¤ºä¾‹

```javascript
// åŠ è½½å·²å¯¼å…¥é¡¹ç›®åˆ—è¡¨
function loadImportedProjects() {
    apiGet('/api/files/imported-projects').then(function(res) {
        if (res.success && res.data) {
            renderProjectList(res.data);
        }
    });
}

// æ¸²æŸ“é¡¹ç›®åˆ—è¡¨
function renderProjectList(projects) {
    const tbody = $('#project-list');
    $('#project-count').text(projects.length + ' ä¸ª');
    
    if (projects.length === 0) {
        tbody.html(`
            <tr>
                <td colspan="7" class="text-center py-4 text-muted">
                    <i class="bi bi-inbox fs-4 d-block mb-2"></i>
                    æš‚æ— ç¬¦åˆæ¡ä»¶çš„é¡¹ç›®
                </td>
            </tr>
        `);
        return;
    }
    
    let html = '';
    projects.forEach(function(p, index) {
        const typeLabel = p.project_type === 'raw' ? 'åŸå§‹æ•°æ®' : 'ç»“æœæ•°æ®';
        html += `
            <tr>
                <td>${index + 1}</td>
                <td><code>${p.project_id}</code></td>
                <td>${p.title || '-'}</td>
                <td><span class="badge bg-info">${typeLabel}</span></td>
                <td>${p.created_at || '-'}</td>
                <td>${p.file_count || 0}</td>
                <td>
                    <button class="btn btn-outline-primary btn-sm" 
                            onclick="showProjectDetail('${p.project_id}', '${p.project_type}')">
                        <i class="bi bi-eye"></i> æŸ¥çœ‹
                    </button>
                </td>
            </tr>
        `;
    });
    tbody.html(html);
}
```

#### 7.3.3 åˆ—è¡¨æ’åºåŠŸèƒ½

##### åŠŸèƒ½æè¿°

å·²å¯¼å…¥é¡¹ç›®è¡¨æ ¼æ”¯æŒç‚¹å‡»åˆ—æ ‡é¢˜è¿›è¡Œå‡åº/é™åºæ’åºã€‚ç”¨æˆ·å¯ä»¥ç‚¹å‡»ä»»æ„æ”¯æŒæ’åºçš„åˆ—æ ‡é¢˜ï¼Œåˆ‡æ¢æ’åºé¡ºåºã€‚

##### æ’åºè§„åˆ™

- **é»˜è®¤æ’åº**: æŒ‰é¡¹ç›®ç¼–å·ï¼ˆproject_idï¼‰å‡åºæ’åˆ—
- **åˆ‡æ¢é€»è¾‘**: ç‚¹å‡»åŒä¸€åˆ—æ—¶ï¼Œåœ¨ å‡åº â†’ é™åº â†’ æ¢å¤é»˜è®¤æ’åº ä¹‹é—´å¾ªç¯
- **å¤šåˆ—æ’åº**: ä»…æ”¯æŒå•åˆ—æ’åºï¼Œç‚¹å‡»æ–°åˆ—æ—¶ä¼šæ¸…é™¤ä¹‹å‰çš„æ’åº
- **ä¸æ”¯æŒæ’åº**: åºå·åˆ—ï¼ˆ#ï¼‰å’Œæ“ä½œåˆ—ä¸æ”¯æŒæ’åº

##### æ’åºçŠ¶æ€æŒ‡ç¤º

| çŠ¶æ€ | å›¾æ ‡ | è¯´æ˜ |
|------|------|------|
| æœªæ’åº | - | ç‚¹å‡»åæœªè¿›è¡Œæ’åº |
| å‡åº | â†—ï¸ æˆ– bi-arrow-up | æŒ‰å½“å‰åˆ—å‡åºæ’åˆ— |
| é™åº | â†˜ï¸ æˆ– bi-arrow-down | æŒ‰å½“å‰åˆ—é™åºæ’åˆ— |

##### æ”¯æŒæ’åºçš„åˆ—

| åˆ—å | æ’åºå­—æ®µ | æ’åºç±»å‹ |
|------|---------|---------|
| é¡¹ç›®ç¼–å· | project_id | å­—ç¬¦ä¸² |
| é¡¹ç›®åç§° | title | å­—ç¬¦ä¸² |
| é¡¹ç›®ç±»å‹ | project_type | å­—ç¬¦ä¸² |
| åˆ›å»ºæ—¶é—´ | created_at | æ—¥æœŸæ—¶é—´ |
| æ–‡ä»¶æ•°é‡ | file_count | æ•°å­— |

##### å‰ç«¯ä»£ç ç¤ºä¾‹

```javascript
// æ’åºçŠ¶æ€ç®¡ç†
let projectSortState = {
    column: 'project_id',  // å½“å‰æ’åºåˆ—
    direction: 'asc'       // æ’åºæ–¹å‘: 'asc' | 'desc'
};

// åˆå§‹åŒ–æ’åº
function initProjectSortableHeaders() {
    $('#project-list thead th[data-sortable="true"]').click(function() {
        const column = $(this).data('sort-column');
        toggleProjectSort(column);
    });
    updateProjectSortIcons();
}

// åˆ‡æ¢æ’åº
function toggleProjectSort(column) {
    if (projectSortState.column === column) {
        if (projectSortState.direction === 'asc') {
            projectSortState.direction = 'desc';
        } else {
            // æ¢å¤é»˜è®¤æ’åº
            projectSortState.column = 'project_id';
            projectSortState.direction = 'asc';
        }
    } else {
        projectSortState.column = column;
        projectSortState.direction = 'asc';
    }
    
    updateProjectSortIcons();
    applyFilter(); // é‡æ–°åŠ è½½å¹¶æ’åº
}

// æ›´æ–°æ’åºå›¾æ ‡
function updateProjectSortIcons() {
    $('#project-list thead th').each(function() {
        const column = $(this).data('sort-column');
        const icon = $(this).find('.sort-icon');
        
        icon.removeClass('bi-arrow-up bi-arrow-down bi-dash');
        
        if (column === projectSortState.column) {
            if (projectSortState.direction === 'asc') {
                icon.addClass('bi-arrow-up');
            } else {
                icon.addClass('bi-arrow-down');
            }
        } else {
            icon.addClass('bi-dash');
        }
    });
}

// æ’åºå‡½æ•°
function sortProjects(projects) {
    return projects.sort((a, b) => {
        let valueA = a[projectSortState.column];
        let valueB = b[projectSortState.column];
        
        // å¤„ç†ç©ºå€¼
        if (valueA === null || valueA === undefined) valueA = '';
        if (valueB === null || valueB === undefined) valueB = '';
        
        // æ–‡ä»¶æ•°é‡æ’åºï¼ˆæ•°å­—ï¼‰
        if (projectSortState.column === 'file_count') {
            return projectSortState.direction === 'asc' 
                ? (valueA || 0) - (valueB || 0)
                : (valueB || 0) - (valueA || 0);
        }
        
        // æ—¥æœŸæ’åº
        if (projectSortState.column === 'created_at') {
            const dateA = new Date(valueA);
            const dateB = new Date(valueB);
            return projectSortState.direction === 'asc' 
                ? dateA.getTime() - dateB.getTime()
                : dateB.getTime() - dateA.getTime();
        }
        
        // å­—ç¬¦ä¸²æ’åº
        const strA = String(valueA).toLowerCase();
        const strB = String(valueB).toLowerCase();
        
        if (strA < strB) return projectSortState.direction === 'asc' ? -1 : 1;
        if (strA > strB) return projectSortState.direction === 'asc' ? 1 : -1;
        return 0;
    });
}
```

##### HTML è¡¨å¤´ç¤ºä¾‹

```html
<table class="table table-hover">
    <thead class="table-light">
        <tr>
            <th data-sortable="false">#</th>
            <th data-sortable="true" data-sort-column="project_id">
                é¡¹ç›®ç¼–å· <i class="bi bi-dash sort-icon"></i>
            </th>
            <th data-sortable="true" data-sort-column="title">
                é¡¹ç›®åç§° <i class="bi bi-dash sort-icon"></i>
            </th>
            <th data-sortable="true" data-sort-column="project_type">
                é¡¹ç›®ç±»å‹ <i class="bi bi-dash sort-icon"></i>
            </th>
            <th data-sortable="true" data-sort-column="created_at">
                åˆ›å»ºæ—¶é—´ <i class="bi bi-dash sort-icon"></i>
            </th>
            <th data-sortable="true" data-sort-column="file_count">
                æ–‡ä»¶æ•°é‡ <i class="bi bi-dash sort-icon"></i>
            </th>
            <th data-sortable="false">æ“ä½œ</th>
        </tr>
    </thead>
    <tbody id="project-list">
        <!-- é¡¹ç›®åˆ—è¡¨å†…å®¹ -->
    </tbody>
</table>
```

### 7.4 æ–‡ä»¶ç®¡ç† - å¯¼å…¥é¡µé¢

#### åŠŸèƒ½æ¦‚è¿°

å¯¼å…¥é¡µé¢æä¾›æ‰«æä¸‹è½½ç›®å½•ã€é€‰æ‹©æ–‡ä»¶å’Œå¯¼å…¥é¡¹ç›®çš„å®Œæ•´åŠŸèƒ½ã€‚

#### é¡µé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–‡ä»¶ç®¡ç†                                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ç®¡ç†] [å¯¼å…¥]                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ä¸‹è½½ç›®å½•æ–‡ä»¶å¤¹                                            [æ‰«æ]     â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  [ğŸ“] folder1                                   [å¯¼å…¥] [æŸ¥çœ‹]       â”‚   â”‚
â”‚  â”‚       10 ä¸ªæ–‡ä»¶                                                  â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  [ğŸ“] folder2                                   [å¯¼å…¥] [æŸ¥çœ‹]       â”‚   â”‚
â”‚  â”‚       5 ä¸ªæ–‡ä»¶                                                   â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 7.5 æ–‡ä»¶å¯¼å…¥å®Œæ•´é€»è¾‘

#### 7.5.1 åŸå§‹æ•°æ®å¯¼å…¥

##### 7.5.1.1 åˆ›å»ºæ–°é¡¹ç›®

**å‰ç«¯è¯·æ±‚æ ¼å¼ï¼š**
```json
{
    "folder_name": "test_import",
    "files": ["sample1.fastq", "sample2.fastq"],
    "data_type": "raw",
    "project_info": {
        "raw_title": "é¡¹ç›®åç§°",
        "raw_type": "è½¬å½•ç»„",
        "raw_species": "äºº",
        "raw_tissue": "è‚"
    }
}
```

**åç«¯å¤„ç†æµç¨‹ï¼š**

| æ­¥éª¤ | æ“ä½œ | è¯´æ˜ |
|------|------|------|
| 1 | ç”Ÿæˆ raw_id | `generate_project_id('RAW')` â†’ `RAW_XXXXXXXX` |
| 2 | åˆ›å»º raw_project | INSERT INTO raw_project |
| 3 | æ„å»ºè·¯å¾„ | `_build_raw_project_path(raw_type, raw_species, raw_tissue, raw_id)` |
| 4 | ç”Ÿæˆ file_property | `_build_file_property('raw', raw_id, raw_type, raw_species, raw_tissue)` |
| 5 | å¤åˆ¶æ–‡ä»¶ | `/bio/downloads/{folder_name}/` â†’ é¡¹ç›®è·¯å¾„ |
| 6 | åˆ›å»º file_record | INSERT INTO file_record |

**è·¯å¾„ç”Ÿæˆè§„åˆ™ `_build_raw_project_path`ï¼š**

```
å¦‚æœ raw_tissue éç©ºï¼š
  /bio/rawdata/{raw_typeç¼©å†™}/{raw_speciesç¼©å†™}/{raw_tissueç¼©å†™}/{raw_id}/

å¦‚æœ raw_tissue ä¸ºç©ºï¼š
  /bio/rawdata/{raw_typeç¼©å†™}/{raw_speciesç¼©å†™}/{raw_id}/
```

**file_property ç”Ÿæˆè§„åˆ™ `_build_file_property`ï¼š**

```
å¦‚æœ raw_tissue éç©ºï¼š
  {raw_type_label}-{raw_species_label}-{raw_tissue_label}

å¦‚æœ raw_tissue ä¸ºç©ºï¼š
  {raw_type_label}-{raw_species_label}
```

---

##### 7.5.1.2 å¯¼å…¥è‡³å·²æœ‰é¡¹ç›®

**å‰ç«¯è¯·æ±‚æ ¼å¼ï¼š**
```json
{
    "folder_name": "test_import",
    "files": ["sample1.fastq"],
    "data_type": "raw",
    "project_id": "RAW_YYYYYYYY",
    "metadata_override": {
        "raw_type": "è›‹ç™½ç»„",
        "raw_species": "å°é¼ ",
        "raw_tissue": "å¿ƒ"
    }
}
```

**åç«¯å¤„ç†æµç¨‹ï¼š**

| æ­¥éª¤ | æ“ä½œ | è¯´æ˜ |
|------|------|------|
| 1 | éªŒè¯é¡¹ç›®å­˜åœ¨ | `SELECT * FROM raw_project WHERE raw_id = ?` |
| 2 | è·å–å‰ç«¯ä¼ å…¥å€¼ | `raw_type`, `raw_species`, `raw_tissue` æ¥è‡ª `metadata_override` |
| 3 | æ„å»ºè·¯å¾„ | `_build_raw_project_path(raw_type, raw_species, raw_tissue, raw_id)` |
| 4 | ç”Ÿæˆ file_property | `_build_file_property('raw', raw_id, raw_type, raw_species, raw_tissue)` |
| 5 | å¤åˆ¶æ–‡ä»¶ | `/bio/downloads/{folder_name}/` â†’ é¡¹ç›®è·¯å¾„ |
| 6 | åˆ›å»º file_record | INSERT INTO file_record |
| 7 | åˆå¹¶å…ƒæ•°æ® | è°ƒç”¨ `merge_field_value('raw_project', raw_id, field_id, value)` |

**å‚æ•°æ¥æºè§„åˆ™ï¼ˆè·¯å¾„ç”Ÿæˆå’Œ file_property åªç”¨å‰ç«¯ä¼ å…¥çš„å€¼ï¼‰ï¼š**
```python
raw_type = (metadata_override or {}).get('raw_type', '')
raw_species = (metadata_override or {}).get('raw_species', '')
raw_tissue = (metadata_override or {}).get('raw_tissue', '')
```

---

#### 7.5.2 ç»“æœå¯¼å…¥

##### 7.5.2.1 åˆ›å»ºæ–°é¡¹ç›®

**å‰ç«¯è¯·æ±‚æ ¼å¼ï¼š**
```json
{
    "folder_name": "test_import",
    "files": ["result.csv"],
    "data_type": "result",
    "project_info": {
        "results_title": "é¡¹ç›®åç§°",
        "results_type": "å·®å¼‚åˆ†æ",
        "results_raw": "RAW_A1,RAW_B2"
    }
}
```

**åç«¯å¤„ç†æµç¨‹ï¼š**

| æ­¥éª¤ | æ“ä½œ | è¯´æ˜ |
|------|------|------|
| 1 | ç”Ÿæˆ results_id | `generate_project_id('RES')` â†’ `RES_XXXXXXXX` |
| 2 | åˆ›å»º result_project | INSERT INTO result_project |
| 3 | æ’åºå…³è”é¡¹ç›® | `_parse_and_sort(results_raw)` â†’ `"RAW_A1RAW_B2"` |
| 4 | æ„å»ºè·¯å¾„ | `_build_result_project_path(results_type, sorted_raw_ids, results_id)` |
| 5 | ç”Ÿæˆ file_property | `_build_file_property('result', results_id, results_type, sorted_raw_ids)` |
| 6 | å¤åˆ¶æ–‡ä»¶ | `/bio/downloads/{folder_name}/` â†’ é¡¹ç›®è·¯å¾„ |
| 7 | åˆ›å»º file_record | INSERT INTO file_record |

**è·¯å¾„ç”Ÿæˆè§„åˆ™ `_build_result_project_path`ï¼š**

```
å¦‚æœ results_raw éç©ºï¼š
  /bio/results/{results_id}/{results_typeç¼©å†™}/{æ’åºåçš„results_raw}/

å¦‚æœ results_raw ä¸ºç©ºï¼š
  /bio/results/{results_id}/{results_typeç¼©å†™}/
```

**file_property ç”Ÿæˆè§„åˆ™ `_build_file_property`ï¼š**

```
å¦‚æœ results_raw éç©ºï¼š
  {results_id}-{results_typeç¼©å†™}-{æ’åºåçš„results_raw}

å¦‚æœ results_raw ä¸ºç©ºï¼š
  {results_id}-{results_typeç¼©å†™}
```

---

##### 7.5.2.2 å¯¼å…¥è‡³å·²æœ‰é¡¹ç›®

**å‰ç«¯è¯·æ±‚æ ¼å¼ï¼ˆmetadata_override éç©ºï¼‰ï¼š**
```json
{
    "folder_name": "test_import",
    "files": ["result.csv"],
    "data_type": "result",
    "project_id": "RES_YYYYYYYY",
    "metadata_override": {
        "results_type": "å¯Œé›†åˆ†æ",
        "results_raw": "RAW_C3"
    }
}
```

**å‰ç«¯è¯·æ±‚æ ¼å¼ï¼ˆmetadata_override ä¸ºç©ºï¼‰ï¼š**
```json
{
    "folder_name": "test_import",
    "files": ["result.csv"],
    "data_type": "result",
    "project_id": "RES_YYYYYYYY",
    "metadata_override": {}
}
```

**åç«¯å¤„ç†æµç¨‹ï¼š**

| æ­¥éª¤ | æ“ä½œ | è¯´æ˜ |
|------|------|------|
| 1 | éªŒè¯é¡¹ç›®å­˜åœ¨ | `SELECT * FROM result_project WHERE results_id = ?` |
| 2 | è·å–å‰ç«¯ä¼ å…¥å€¼ | `results_type`, `results_raw` æ¥è‡ª `metadata_override` |
| 3 | æ’åºå…³è”é¡¹ç›® | `_parse_and_sort(results_raw)` â†’ `"RAW_C3"` æˆ– `""` |
| 4 | æ„å»ºè·¯å¾„ | `_build_result_project_path(results_type, sorted_raw_ids, results_id)` |
| 5 | ç”Ÿæˆ file_property | `_build_file_property('result', results_id, results_type, sorted_raw_ids)` |
| 6 | å¤åˆ¶æ–‡ä»¶ | `/bio/downloads/{folder_name}/` â†’ é¡¹ç›®è·¯å¾„ |
| 7 | åˆ›å»º file_record | INSERT INTO file_record |
| 8 | åˆå¹¶å…ƒæ•°æ® | è°ƒç”¨ `merge_field_value('result_project', results_id, field_id, value)` |

**å‚æ•°æ¥æºè§„åˆ™ï¼ˆè·¯å¾„ç”Ÿæˆå’Œ file_property åªç”¨å‰ç«¯ä¼ å…¥çš„å€¼ï¼‰ï¼š**
```python
results_type = (metadata_override or {}).get('results_type', '')
results_raw = (metadata_override or {}).get('results_raw', '')
```

---

#### 7.5.3 å…³è”é¡¹ç›®ç¼–å·æ’åºè§„åˆ™ `_parse_and_sort`

```
è¾“å…¥: "RAW_A1ï¼ŒRAW_2A, RAW_sa"
è§£æ: æ›¿æ¢ä¸­æ–‡é€—å·ä¸ºè‹±æ–‡ï¼Œåˆ†å‰²ä¸ºåˆ—è¡¨ï¼Œå»é™¤ç©ºå€¼
æ’åº: æŒ‰ASCIIé¡ºåºæ’åºï¼ˆæ•°å­— < å¤§å†™å­—æ¯ < å°å†™å­—æ¯ï¼‰
è¾“å‡º: "RAW_2ARAW_A1RAW_sa"
```

---

#### 7.5.4 å…ƒæ•°æ®çš„è¿½åŠ -è¦†ç›– `merge_field_value`

**é€‚ç”¨æ¡ä»¶**ï¼šå¯¼å…¥è‡³å·²æœ‰é¡¹ç›®æ—¶ï¼ˆæ–°å»ºé¡¹ç›®ä¸éœ€è¦ï¼‰

**å¤„ç†æµç¨‹**ï¼ˆä¸è®º `metadata_override` æ˜¯å¦ä¸ºç©ºï¼‰ï¼š

```
æ­¥éª¤1: æŸ¥è¯¢æ•°æ®åº“å·²æœ‰å€¼ â†’ metadata_existing
æ­¥éª¤2: ä¸å‰ç«¯ä¼ å…¥å€¼åˆå¹¶ï¼ˆç”¨è‹±æ–‡é€—å·åˆ†éš”ï¼‰
æ­¥éª¤3: æŒ‰é€—å·åˆ†å‰²æˆåˆ—è¡¨ï¼ˆåŒ…æ‹¬ç©ºå€¼ï¼‰
æ­¥éª¤4: å»é‡
æ­¥éª¤5: å»ç©ºå€¼
æ­¥éª¤6: æŒ‰ASCIIæ’åº
æ­¥éª¤7: ç”¨é€—å·è¿æ¥
æ­¥éª¤8: è¦†ç›–æ•°æ®åº“
```

**ç¤ºä¾‹ 1ï¼šmetadata_override éç©º**

| æ•°æ®åº“å·²æœ‰å€¼ (metadata_existing) | å‰ç«¯ä¼ å…¥å€¼ (metadata_override) | åˆå¹¶å | å»é‡å»ç©ºæ’åºå | æœ€ç»ˆç»“æœ |
|--------------------------------|------------------------------|-------|--------------|---------|
| "RAW_A1,RAW_B2" | "RAW_C3" | "RAW_A1,RAW_B2,RAW_C3" | ["RAW_A1","RAW_B2","RAW_C3"] | "RAW_A1,RAW_B2,RAW_C3" |
| "RAW_A1,RAW_B2" | "RAW_B2" | "RAW_A1,RAW_B2,RAW_B2" | ["RAW_A1","RAW_B2"] | "RAW_A1,RAW_B2" |
| "RAW_A1" | "RAW_A1,RAW_B2" | "RAW_A1,RAW_A1,RAW_B2" | ["RAW_A1","RAW_B2"] | "RAW_A1,RAW_B2" |

**ç¤ºä¾‹ 2ï¼šmetadata_override ä¸ºç©º**

| æ•°æ®åº“å·²æœ‰å€¼ (metadata_existing) | å‰ç«¯ä¼ å…¥å€¼ (metadata_override) | åˆå¹¶å | å»é‡å»ç©ºæ’åºå | æœ€ç»ˆç»“æœ |
|--------------------------------|------------------------------|-------|--------------|---------|
| "RAW_A1,RAW_B2" | "" | "RAW_A1,RAW_B2," | ["RAW_A1","RAW_B2"] | "RAW_A1,RAW_B2" |
| "RAW_A1,RAW_B2" | (ä¸å­˜åœ¨æˆ–null) | "RAW_A1,RAW_B2" | ["RAW_A1","RAW_B2"] | "RAW_A1,RAW_B2" |
| "" | "" | "," | [] | "" |
| "RAW_A1" | "" | "RAW_A1," | ["RAW_A1"] | "RAW_A1" |

**ç¤ºä¾‹ 3ï¼šå…¶ä»–å­—æ®µçš„åˆå¹¶**

| å­—æ®µ | æ•°æ®åº“å·²æœ‰å€¼ | å‰ç«¯ä¼ å…¥å€¼ | åˆå¹¶å | æœ€ç»ˆç»“æœ |
|------|-------------|-----------|-------|---------|
| results_type | "DEA" | "å¯Œé›†åˆ†æ" | "DEA,å¯Œé›†åˆ†æ" | "DEA,å¯Œé›†åˆ†æ" |
| results_keywords | "å·®å¼‚è¡¨è¾¾" | "ç«å±±å›¾" | "å·®å¼‚è¡¨è¾¾,ç«å±±å›¾" | "å·®å¼‚è¡¨è¾¾,ç«å±±å›¾" |
| results_description | "åŸæè¿°" | "æ–°æè¿°" | "åŸæè¿°,æ–°æè¿°" | "åŸæè¿°,æ–°æè¿°" |

**å…³é”®è¯´æ˜**ï¼š
- ä¸è®º `metadata_override` æ˜¯å¦ä¸ºç©ºï¼Œå¤„ç†æµç¨‹å®Œå…¨ç›¸åŒ
- ç©ºå€¼åˆå¹¶åä¼šè¢«å»é™¤ï¼Œä¸å½±å“æœ€ç»ˆç»“æœ
- æ–°å€¼ä¼šè¿½åŠ åˆ°å·²æœ‰å€¼åé¢ï¼Œç„¶åå»é‡æ’åº

---

#### 7.5.5 server.py å®Œæ•´é€»è¾‘

```python
@app.route('/api/import-download', methods=['POST'])
def api_import_download():
    data = request.get_json()
    project_id = data.get('project_id')
    files = data.get('files', [])
    project_info = data.get('project_info', {})
    folder_name = data.get('folder_name')
    metadata_override = data.get('metadata_override', {})
    data_type = data.get('data_type', 'raw')
    
    # æ–°å»ºé¡¹ç›®
    if not project_id and project_info:
        if data_type == 'result':
            project = get_manager().create_result_project(project_info)
        else:
            project = get_manager().create_raw_project(project_info)
        project_id = project.get('results_id') or project.get('raw_id')
        # æ–°å»ºé¡¹ç›®æ—¶ï¼Œmetadata_override ä½¿ç”¨ project_info
        metadata_override = project_info
    
    # å¯¼å…¥æ–‡ä»¶
    result = get_manager().import_download_files(
        project_id, files, folder_name, metadata_override, data_type
    )
    return jsonify(result)
```

---

#### 7.5.6 backend.py å…³é”®å‡½æ•°

##### import_download_files
```python
def import_download_files(self, project_id, files, folder_name, metadata_override, data_type):
    if data_type == 'raw':
        return self._import_raw_files(project_id, files, folder_name, metadata_override)
    else:
        return self._import_result_files(project_id, files, folder_name, metadata_override)
```

##### _import_raw_files - å‚æ•°æ¥æºï¼ˆè·¯å¾„ç”Ÿæˆåªç”¨å‰ç«¯ä¼ å…¥çš„å€¼ï¼‰
```python
# åªä½¿ç”¨å‰ç«¯ä¼ å…¥çš„å€¼æ„å»ºè·¯å¾„ï¼Œç»ä¸æŸ¥è¯¢æ•°æ®åº“
raw_type = (metadata_override or {}).get('raw_type', '')
raw_species = (metadata_override or {}).get('raw_species', '')
raw_tissue = (metadata_override or {}).get('raw_tissue', '')
```

##### _import_result_files - å‚æ•°æ¥æºï¼ˆè·¯å¾„ç”Ÿæˆåªç”¨å‰ç«¯ä¼ å…¥çš„å€¼ï¼‰
```python
# åªä½¿ç”¨å‰ç«¯ä¼ å…¥çš„å€¼æ„å»ºè·¯å¾„ï¼Œç»ä¸æŸ¥è¯¢æ•°æ®åº“
results_type = (metadata_override or {}).get('results_type', '')
results_raw = (metadata_override or {}).get('results_raw', '')
```

##### merge_field_value - å…ƒæ•°æ®åˆå¹¶ï¼ˆä¸è®º metadata_override æ˜¯å¦ä¸ºç©ºï¼‰
```python
def merge_field_value(self, table_name, project_id, field_id, new_value):
    # æ­¥éª¤1: æŸ¥è¯¢æ•°æ®åº“å·²æœ‰å€¼
    existing = self._get_field_value(table_name, project_id, field_id)
    
    # æ­¥éª¤2: åˆå¹¶ï¼ˆå·²æœ‰å€¼ + "," + æ–°å€¼ï¼‰
    merged = f"{existing},{new_value}" if existing else new_value
    
    # æ­¥éª¤3: åˆ†å‰²ã€å»é‡ã€å»ç©ºã€æ’åº
    processed = self._parse_and_sort(merged)
    
    # æ­¥éª¤4: è¦†ç›–æ•°æ®åº“
    self._update_field_value(table_name, project_id, field_id, processed)
```

---

#### 7.5.7 å‚æ•°æ¥æºæ€»è¡¨

| å‚æ•° | åˆ›å»ºæ–°é¡¹ç›® | å¯¼å…¥è‡³å·²æœ‰é¡¹ç›® | å…è®¸æŸ¥è¯¢æ•°æ®åº“ï¼Ÿ |
|------|-----------|---------------|----------------|
| raw_id / results_id | project_info ä¸­ç”Ÿæˆ | project_id ä¸­è·å–ï¼ˆåªéªŒè¯å­˜åœ¨ï¼‰ | âœ“ åªéªŒè¯å­˜åœ¨ |
| raw_type / results_type | project_info | metadata_override | âœ— ç¦æ­¢ |
| raw_species | project_info | metadata_override | âœ— ç¦æ­¢ |
| raw_tissue | project_info | metadata_override | âœ— ç¦æ­¢ |
| results_raw | project_info | metadata_override | âœ— ç¦æ­¢ |

**å…³é”®è§„åˆ™**ï¼š
1. **è·¯å¾„ç”Ÿæˆ**ï¼šåªä½¿ç”¨å‰ç«¯ä¼ å…¥çš„å‚æ•°ï¼Œ**ç»ä¸ä»æ•°æ®åº“æŸ¥è¯¢**
2. **å…ƒæ•°æ®åˆå¹¶**ï¼šå¯¼å…¥è‡³å·²æœ‰é¡¹ç›®æ—¶ï¼Œè°ƒç”¨ `merge_field_value` è¿›è¡Œåˆå¹¶ï¼ˆä¸è®º metadata_override æ˜¯å¦ä¸ºç©ºï¼‰
3. **ç©ºå€¼å¤„ç†**ï¼š
   - raw_tissue ä¸ºç©ºï¼šè·¯å¾„çœç•¥è¯¥é¡¹
   - results_raw ä¸ºç©ºï¼šè·¯å¾„çœç•¥è¯¥é¡¹
   - metadata_override ä¸ºç©ºï¼šåˆå¹¶æ—¶è‡ªåŠ¨å»é™¤ç©ºå€¼ï¼Œä¸å½±å“æœ€ç»ˆç»“æœ

---

#### 7.5.8 file_project_ref_id ç”¨é€”

| å­—æ®µ | è¯´æ˜ |
|------|------|
| file_project_type | 'raw' æˆ– 'result' |
| file_project_id | é¡¹ç›®ç¼–å·ï¼ˆRAW_XXX æˆ– RES_XXXï¼‰ |
| file_project_ref_id | **ä»…ç»“æœæ•°æ®ä½¿ç”¨**ï¼Œå…³è”çš„åŸå§‹æ•°æ®é¡¹ç›®ç¼–å· |

**ç”¨é€”ï¼š**
1. ç»“æœæ•°æ®å…³è”åˆ°åŸå§‹æ•°æ®é¡¹ç›®
2. åœ¨ç»“æœé¡¹ç›®è¯¦æƒ…é¡µæ˜¾ç¤ºå…³è”çš„åŸå§‹æ•°æ®æ–‡ä»¶
3. ä¾¿äºè¿½æº¯æ•°æ®çš„åˆ†ææ¥æº

---

### 7.6 é¡¹ç›®è¯¦æƒ…æ¨¡æ€æ¡†

#### åŠŸèƒ½æè¿°

ç‚¹å‡»"æŸ¥çœ‹è¯¦æƒ…"æŒ‰é’®åå¼¹å‡ºæ¨¡æ€æ¡†ï¼Œå±•ç¤ºè¯¥é¡¹ç›®çš„æ–‡ä»¶ä¿¡æ¯ã€‚

#### æ¨¡æ€æ¡†å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é¡¹ç›®è¯¦æƒ… - RAW_XXX                                             [å…³é—­] [X]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  é¡¹ç›®åç§°: æµ‹è¯•é¡¹ç›®                                      åˆ›å»ºæ—¶é—´: 2026-01-01â”‚
â”‚  é¡¹ç›®ç±»å‹: åŸå§‹æ•°æ®                                    æ–‡ä»¶æ•°é‡: 10         â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â˜ â”‚ æ–‡ä»¶å              â”‚ æ–‡ä»¶å¤§å° â”‚ æ–‡ä»¶ç±»å‹ â”‚ å¯¼å…¥æ—¶é—´            â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ â˜‘ â”‚ sample1.fastq.gz   â”‚ 1.5 GB   â”‚ FASTQ    â”‚ 2026-01-01 10:30:00 â”‚   â”‚
â”‚  â”‚ â˜‘ â”‚ sample2.fastq.gz   â”‚ 1.4 GB   â”‚ FASTQ    â”‚ 2026-01-01 10:32:00 â”‚   â”‚
â”‚  â”‚ â˜ â”‚ sample3.fastq.gz   â”‚ 1.3 GB   â”‚ FASTQ    â”‚ 2026-01-01 10:34:00 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  [åˆ é™¤] [ä¸‹è½½]                                                               â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ¨¡æ€æ¡†å­—æ®µè¯´æ˜

| å­—æ®µ | æ•°æ®åº“æ¥æº | è¯´æ˜ |
|------|-----------|------|
| â˜ | - | å¤é€‰æ¡†ï¼ˆç”¨äºé€‰æ‹©è¦æ“ä½œçš„æ–‡ä»¶ï¼‰ |
| æ–‡ä»¶å | file_record.file_name | å®Œæ•´æ–‡ä»¶åï¼ˆå«æ‰©å±•åï¼‰ |
| æ–‡ä»¶å¤§å° | file_record.file_size | æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰ |
| æ–‡ä»¶ç±»å‹ | file_record.file_type | æ–‡ä»¶ç±»å‹æ‰©å±•å |
| å¯¼å…¥æ—¶é—´ | file_record.imported_at | å¯¼å…¥æ—¶é—´ |

#### é¡¹ç›®åŸºæœ¬ä¿¡æ¯åŒºåŸŸ

| å­—æ®µ | æ•°æ®åº“æ¥æº | è¯´æ˜ |
|------|-----------|------|
| é¡¹ç›®åç§° | raw_project.raw_title / result_project.results_title | é¡¹ç›®æ ‡é¢˜ |
| é¡¹ç›®ç±»å‹ | file_record.file_project_type | raw / result |
| åˆ›å»ºæ—¶é—´ | raw_project.created_at / result_project.created_at | é¡¹ç›®åˆ›å»ºæ—¶é—´ |
| æ–‡ä»¶æ•°é‡ | COUNT(file_record.id) | å…³è”æ–‡ä»¶æ•°é‡ |

#### ç©ºé¡¹ç›®çŠ¶æ€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é¡¹ç›®è¯¦æƒ… - RAW_XXX                                             [å…³é—­] [X]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  é¡¹ç›®åç§°: æµ‹è¯•é¡¹ç›®                                      åˆ›å»ºæ—¶é—´: 2026-01-01â”‚
â”‚  é¡¹ç›®ç±»å‹: åŸå§‹æ•°æ®                                    æ–‡ä»¶æ•°é‡: 0         â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚              è¯¥é¡¹ç›®æš‚æ— æ–‡ä»¶                                          â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  [åˆ é™¤] [ä¸‹è½½] (æŒ‰é’®ç¦ç”¨çŠ¶æ€)                                               â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- æ˜¾ç¤ºæ–‡å­—ï¼š"è¯¥é¡¹ç›®æš‚æ— æ–‡ä»¶"
- ç¦ç”¨"åˆ é™¤"å’Œ"ä¸‹è½½"æŒ‰é’®

#### 7.5.1 æ–‡ä»¶åˆ—è¡¨æ’åºåŠŸèƒ½

##### åŠŸèƒ½æè¿°

é¡¹ç›®è¯¦æƒ…æ¨¡æ€æ¡†å†…çš„æ–‡ä»¶åˆ—è¡¨æ”¯æŒç‚¹å‡»åˆ—æ ‡é¢˜è¿›è¡Œå‡åº/é™åºæ’åºã€‚

##### æ’åºè§„åˆ™

- **é»˜è®¤æ’åº**: æŒ‰å¯¼å…¥æ—¶é—´ï¼ˆimported_atï¼‰é™åºæ’åˆ—ï¼ˆæœ€æ–°çš„æ–‡ä»¶åœ¨å‰é¢ï¼‰
- **åˆ‡æ¢é€»è¾‘**: ç‚¹å‡»åŒä¸€åˆ—æ—¶ï¼Œåœ¨ å‡åº â†’ é™åº â†’ æ¢å¤é»˜è®¤æ’åº ä¹‹é—´å¾ªç¯
- **å¤šåˆ—æ’åº**: ä»…æ”¯æŒå•åˆ—æ’åºï¼Œç‚¹å‡»æ–°åˆ—æ—¶ä¼šæ¸…é™¤ä¹‹å‰çš„æ’åº
- **ä¸æ”¯æŒæ’åº**: å¤é€‰æ¡†åˆ—ï¼ˆâ˜ï¼‰ä¸æ”¯æŒæ’åº

##### æ”¯æŒæ’åºçš„åˆ—

| åˆ—å | æ’åºå­—æ®µ | æ’åºç±»å‹ |
|------|---------|---------|
| æ–‡ä»¶å | file_name | å­—ç¬¦ä¸² |
| æ–‡ä»¶å¤§å° | file_size | æ•°å­— |
| æ–‡ä»¶ç±»å‹ | file_type | å­—ç¬¦ä¸² |
| å¯¼å…¥æ—¶é—´ | imported_at | æ—¥æœŸæ—¶é—´ |

##### å‰ç«¯ä»£ç ç¤ºä¾‹

```javascript
// é¡¹ç›®è¯¦æƒ…æ¨¡æ€æ¡†æ’åºçŠ¶æ€ç®¡ç†
let detailSortState = {
    column: 'imported_at',  // å½“å‰æ’åºåˆ—
    direction: 'desc'       // æ’åºæ–¹å‘: 'asc' | 'desc'
};

// åˆå§‹åŒ–è¯¦æƒ…æ¨¡æ€æ¡†æ’åº
function initDetailSortableHeaders() {
    $('#detail-content thead th[data-sortable="true"]').click(function() {
        const column = $(this).data('sort-column');
        toggleDetailSort(column);
    });
    updateDetailSortIcons();
}

// åˆ‡æ¢è¯¦æƒ…æ¨¡æ€æ¡†æ’åº
function toggleDetailSort(column) {
    if (detailSortState.column === column) {
        if (detailSortState.direction === 'asc') {
            detailSortState.direction = 'desc';
        } else {
            // æ¢å¤é»˜è®¤æ’åº
            detailSortState.column = 'imported_at';
            detailSortState.direction = 'desc';
        }
    } else {
        detailSortState.column = column;
        detailSortState.direction = 'asc';
    }
    
    updateDetailSortIcons();
    // é‡æ–°æ¸²æŸ“æ–‡ä»¶åˆ—è¡¨
    const projectId = $('#detail-modal').data('project-id');
    const projectType = $('#detail-modal').data('project-type');
    showProjectDetail(projectId, projectType);
}

// è¯¦æƒ…æ¨¡æ€æ¡†æ’åºå‡½æ•°
function sortFiles(files) {
    return files.sort((a, b) => {
        let valueA = a[detailSortState.column];
        let valueB = b[detailSortState.column];
        
        // å¤„ç†ç©ºå€¼
        if (valueA === null || valueA === undefined) valueA = '';
        if (valueB === null || valueB === undefined) valueB = '';
        
        // æ–‡ä»¶å¤§å°æ’åºï¼ˆæ•°å­—ï¼‰
        if (detailSortState.column === 'file_size') {
            return detailSortState.direction === 'asc' 
                ? valueA - valueB 
                : valueB - valueA;
        }
        
        // æ—¥æœŸæ’åº
        if (detailSortState.column === 'imported_at') {
            const dateA = new Date(valueA);
            const dateB = new Date(valueB);
            return detailSortState.direction === 'asc' 
                ? dateA.getTime() - dateB.getTime() 
                : dateB.getTime() - dateA.getTime();
        }
        
        // å­—ç¬¦ä¸²æ’åº
        const strA = String(valueA).toLowerCase();
        const strB = String(valueB).toLowerCase();
        
        if (strA < strB) return detailSortState.direction === 'asc' ? -1 : 1;
        if (strA > strB) return detailSortState.direction === 'asc' ? 1 : -1;
        return 0;
    });
}
```

### 7.6 æ–‡ä»¶æ“ä½œåŠŸèƒ½

#### 7.6.1 åˆ é™¤åŠŸèƒ½

##### å‰ç«¯äº¤äº’

```
ç”¨æˆ·ç‚¹å‡» [åˆ é™¤] æŒ‰é’®
        â”‚
        â–¼
å¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¡®è®¤åˆ é™¤                                â”‚
â”‚                                         â”‚
â”‚  è¯·è¾“å…¥ "æˆ‘å·²çŸ¥æ™“ï¼Œç¡®è®¤åˆ é™¤" ä»¥ç¡®è®¤æ“ä½œ:   â”‚
â”‚  _____________________________________  â”‚
â”‚                                         â”‚
â”‚  [å–æ¶ˆ]                        [ç¡®è®¤åˆ é™¤] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
ç”¨æˆ·è¾“å…¥æ­£ç¡®æ–‡å­—å¹¶ç‚¹å‡»ç¡®è®¤
        â”‚
        â–¼
å‰ç«¯å‘é€è¯·æ±‚: DELETE /api/files
    å‚æ•°: { file_ids: [id1, id2, ...] }
        â”‚
        â–¼
åå°æ‰§è¡Œ:
    1. æŸ¥è¯¢ file_record è·å– file_path å’Œ file_name
    2. æ‹¼æ¥å®Œæ•´è·¯å¾„: /bio/{file_path}/{file_name}
    3. å¤åˆ¶æ–‡ä»¶åˆ° /bio/recycle/{file_path}/ (ç»´æŒç›®å½•ç»“æ„)
    4. åˆ é™¤æºæ–‡ä»¶
    5. åˆ é™¤ file_record è¡¨ä¸­çš„è®°å½•
        â”‚
        â–¼
è¿”å›: { success: true, message: "åˆ é™¤æˆåŠŸ" }
        â”‚
        â–¼
å‰ç«¯åˆ·æ–°æ¨¡æ€æ¡†å†…çš„æ–‡ä»¶è¡¨æ ¼
```

##### ç¡®è®¤å¯¹è¯æ¡†ç¤ºä¾‹

```javascript
// åˆ é™¤æ–‡ä»¶
function deleteSelectedFiles() {
    const selectedIds = [];
    $('.file-checkbox:checked').each(function() {
        selectedIds.push(parseInt($(this).val()));
    });
    
    if (selectedIds.length === 0) {
        showToast('è¯·é€‰æ‹©è¦åˆ é™¤çš„æ–‡ä»¶', 'warning');
        return;
    }
    
    // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
    $('#delete-confirm-modal').modal('show');
}

// æ‰§è¡Œåˆ é™¤ç¡®è®¤
function confirmDelete() {
    const confirmText = $('#delete-confirm-input').val();
    if (confirmText !== 'æˆ‘å·²çŸ¥æ™“ï¼Œç¡®è®¤åˆ é™¤') {
        showToast('è¯·è¾“å…¥æ­£ç¡®çš„ç¡®è®¤æ–‡å­—', 'error');
        return;
    }
    
    const selectedIds = [];
    $('.file-checkbox:checked').each(function() {
        selectedIds.push(parseInt($(this).val()));
    });
    
    apiDelete('/api/files', { file_ids: selectedIds }).then(function(res) {
        if (res.success) {
            showToast('åˆ é™¤æˆåŠŸ', 'success');
            $('#delete-confirm-modal').modal('hide');
            $('#delete-confirm-input').val('');
            // åˆ·æ–°æ–‡ä»¶åˆ—è¡¨
            const projectId = $('#detail-modal').data('project-id');
            showProjectDetail(projectId);
        } else {
            showToast(res.message || 'åˆ é™¤å¤±è´¥', 'error');
        }
    });
}
```

##### ç›®å½•ç»“æ„ç»´æŒç¤ºä¾‹

```
åŸè·¯å¾„: /bio/rawdata/mRseq/Hs/Li/RAW_XXX/sample.fastq
ç›®æ ‡:  /bio/recycle/rawdata/mRseq/Hs/Li/RAW_XXX/sample.fastq
```

#### 7.6.2 ä¸‹è½½åŠŸèƒ½

##### å‰ç«¯äº¤äº’

```
ç”¨æˆ·é€‰æ‹©æ–‡ä»¶ï¼ˆå‹¾é€‰å¤é€‰æ¡†ï¼‰
        â”‚
        â–¼
ç”¨æˆ·ç‚¹å‡» [ä¸‹è½½] æŒ‰é’®
        â”‚
        â–¼
å‰ç«¯å‘é€è¯·æ±‚: POST /api/files/download
    å‚æ•°: { file_ids: [id1, id2, ...] }
        â”‚
        â–¼
åå°æ‰§è¡Œ:
    1. æŸ¥è¯¢ file_record è·å– file_path å’Œ file_name
    2. æ‹¼æ¥å®Œæ•´è·¯å¾„: /bio/{file_path}/{file_name}
    3. è¯»å–å„ä¸ªæ–‡ä»¶å†…å®¹
    4. æ‰“åŒ…ä¸º ZIP æ–‡ä»¶ (download.zip)
    5. è¿”å› ZIP æ–‡ä»¶æµ
        â”‚
        â–¼
æµè§ˆå™¨è§¦å‘ä¸‹è½½
```

##### å‰ç«¯ä»£ç ç¤ºä¾‹

```javascript
// ä¸‹è½½é€‰ä¸­æ–‡ä»¶
function downloadSelectedFiles() {
    const selectedIds = [];
    $('.file-checkbox:checked').each(function() {
        selectedIds.push(parseInt($(this).val()));
    });
    
    if (selectedIds.length === 0) {
        showToast('è¯·é€‰æ‹©è¦ä¸‹è½½çš„æ–‡ä»¶', 'warning');
        return;
    }
    
    // åˆ›å»ºè¡¨å•æäº¤
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = '/api/files/download';
    form.style.display = 'none';
    
    const input = document.createElement('input');
    input.type = 'hidden';
    input.name = 'file_ids';
    input.value = JSON.stringify(selectedIds);
    form.appendChild(input);
    
    document.body.appendChild(form);
    form.submit();
    document.body.removeChild(form);
    
    showToast('å¼€å§‹ä¸‹è½½...', 'info');
}
```

##### ZIP åŒ…ç»“æ„

```
download.zip
â”œâ”€â”€ sample1.fastq
â”œâ”€â”€ sample2.fastq
â””â”€â”€ sample3.fastq
```

### 7.7 API æ¥å£è®¾è®¡

#### 7.7.1 è·å–å·²å¯¼å…¥é¡¹ç›®åˆ—è¡¨

```
GET /api/files/imported-projects

è¯´æ˜: è·å–å·²å¯¼å…¥é¡¹ç›®çš„åˆ—è¡¨ï¼Œæ”¯æŒæŒ‰é¡¹ç›®ç±»å‹å’Œé¡¹ç›®ç¼–å·ç­›é€‰

å‚æ•°:
- file_project_type: string (å¯é€‰, raw | result)
- file_project_ids: string (å¯é€‰, é€—å·åˆ†éš”çš„é¡¹ç›®ç¼–å·)

è¯·æ±‚ç¤ºä¾‹:
GET /api/files/imported-projects
GET /api/files/imported-projects?file_project_type=raw
GET /api/files/imported-projects?file_project_ids=RAW_XXX,RAW_YYY
GET /api/files/imported-projects?file_project_type=raw&file_project_ids=RAW_XXX,RAW_YYY

å“åº”æˆåŠŸ (200):
{
    "success": true,
    "data": [
        {
            "project_id": "RAW_XXX",
            "project_type": "raw",
            "title": "é¡¹ç›®åç§°",
            "created_at": "2026-01-01 10:00:00",
            "file_count": 10
        }
    ],
    "total": 1
}

å“åº”å¤±è´¥ (400/500):
{
    "success": false,
    "message": "é”™è¯¯ä¿¡æ¯"
}
```

#### 7.7.2 è·å–é¡¹ç›®æ–‡ä»¶åˆ—è¡¨

```
GET /api/files

è¯´æ˜: è·å–æŒ‡å®šé¡¹ç›®çš„æ–‡ä»¶åˆ—è¡¨

å‚æ•°:
- project_id: string (å¿…å¡«, é¡¹ç›®ç¼–å·)

è¯·æ±‚ç¤ºä¾‹:
GET /api/files?project_id=RAW_XXX

å“åº”æˆåŠŸ (200):
{
    "success": true,
    "project_id": "RAW_XXX",
    "project_type": "raw",
    "files": [
        {
            "id": 1,
            "file_name": "sample1.fastq.gz",
            "file_size": 1612345678,
            "file_type": "fastq.gz",
            "imported_at": "2026-01-01 10:30:00"
        }
    ],
    "total": 1
}

å“åº”å¤±è´¥ (400/500):
{
    "success": false,
    "message": "é”™è¯¯ä¿¡æ¯"
}
```

#### 7.7.3 åˆ é™¤æ–‡ä»¶

```
DELETE /api/files

è¯´æ˜: åˆ é™¤æŒ‡å®šçš„æ–‡ä»¶è®°å½•ï¼Œå¹¶å°†æºæ–‡ä»¶ç§»åŠ¨åˆ°å›æ”¶ç«™

è¯·æ±‚ä½“ (Content-Type: application/json):
{
    "file_ids": [1, 2, 3]
}

å“åº”æˆåŠŸ (200):
{
    "success": true,
    "message": "åˆ é™¤æˆåŠŸ",
    "deleted_count": 3
}

å“åº”å¤±è´¥ (400/500):
{
    "success": false,
    "message": "é”™è¯¯ä¿¡æ¯"
}
```

#### 7.7.4 ä¸‹è½½æ–‡ä»¶

```
POST /api/files/download

è¯´æ˜: ä¸‹è½½æŒ‡å®šçš„æ–‡ä»¶ï¼Œæ”¯æŒå•æ–‡ä»¶å’Œå¤šæ–‡ä»¶æ‰“åŒ…ä¸‹è½½

è¯·æ±‚ä½“ (Content-Type: application/json):
{
    "file_ids": [1, 2, 3]
}

å“åº”æˆåŠŸ (200):
- Content-Type: application/zip
- Content-Disposition: attachment; filename="download.zip"
- Body: ZIP æ–‡ä»¶æµ

å“åº”å¤±è´¥ (400/500):
{
    "success": false,
    "message": "é”™è¯¯ä¿¡æ¯"
}
```

#### 7.7.5 é”™è¯¯å“åº”æ ¼å¼

æ‰€æœ‰ API çš„é”™è¯¯å“åº”ç»Ÿä¸€æ ¼å¼ï¼š

```json
{
    "success": false,
    "message": "é”™è¯¯æè¿°ä¿¡æ¯",
    "code": "ERROR_CODE"
}
```

å¸¸è§é”™è¯¯ç ï¼š

| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| INVALID_PARAMS | å‚æ•°é”™è¯¯ |
| PROJECT_NOT_FOUND | é¡¹ç›®ä¸å­˜åœ¨ |
| FILE_NOT_FOUND | æ–‡ä»¶ä¸å­˜åœ¨ |
| FILE_DELETE_FAILED | æ–‡ä»¶åˆ é™¤å¤±è´¥ |
| FILE_DOWNLOAD_FAILED | æ–‡ä»¶ä¸‹è½½å¤±è´¥ |
| INTERNAL_ERROR | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

---

### 7.3.2 æ–‡ä»¶å¯¼å…¥

å¯¹åº”å­é¡µé¢ï¼šæ–‡ä»¶ç®¡ç†-å¯¼å…¥

### é é¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–‡ä»¶ç®¡ç†                                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ç®¡ç†] [å°å…¥]                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ æ–‡ä»¶å¤¿åˆ—è¡¨                                          [3ä¸ª] [æƒæ]     â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  [ğŸ“] folder1                                   [å°å…¥] [æŸ¥çœ‹]       â”‚   â”‚
â”‚  â”‚       10 å€‹æ–‡ä»¶                                                  â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  [ğŸ“] folder2                                   [å°å…¥] [æŸ¥çœ‹]       â”‚   â”‚
â”‚  â”‚       5 å€‹æ–‡ä»¶                                                   â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  [ğŸ“] folder3                                   [å°å…¥] [æŸ¥çœ‹]       â”‚   â”‚
â”‚  â”‚       8 å€‹æ–‡ä»¶                                                   â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é é¢åŠŸèƒ½èªªæ˜

| åŠŸèƒ½ | èªªæ˜ |
|------|------|
| æƒææŒ‰éˆ• | é»æ“Šå¾Œæƒæ /bio/downloads ç›®éŒ„ï¼Œåˆ—å‡ºæ‰€æœ‰å­æ–‡ä»¶å¤¾ ï¼Œå¹¶åœ¨å³ä¾§æ˜¾ç¤ºæ–‡ä»¶å¤¹æ•°é‡|
| æ–‡ä»¶å¤¿åˆ—è¡¨ | é¡¯ç¤ºæƒæåˆ°çš„æ–‡ä»¶ï¼Œæ¯è¡Œé¡¯ç¤ºæ–‡ä»¶å¤¿åç¨±ã€æ–‡ä»¶æ•¸é‡ |
| å°å…¥æŒ‰éˆ• | é»æ“Šå¾Œæ‰“é–‹å°å…¥å½ˆçª—ï¼Œé¸æ“‡æˆ–æ–°å»ºé …ç›®å¾Œå°å…¥æ–‡ä»¶ |
| æŸ¥çœ‹æŒ‰éˆ• | é»æ“Šå¾ŒæŸ¥çœ‹æ–‡ä»¶å¤¿å…§çš„çš„æ–‡ä»¶åˆ—è¡¨ |

#### æ–‡ä»¶å¯¼å…¥è¡¨å•
å¯¼å…¥æ–‡ä»¶æ—¶ï¼Œç³»ç»Ÿæ ¹æ®æ•°æ®ç±»å‹ï¼ˆåŸå§‹æ•°æ®/ç»“æœæ•°æ®ï¼‰åŠ¨æ€åŠ è½½å…ƒæ•°æ®å­—æ®µé…ç½®ï¼š

**ç›®æ ‡é¡¹ç›®é€‰æ‹©**ï¼š
- **[æ–°å»ºé¡¹ç›®]**: åˆ‡æ¢åˆ°æ–°å»ºé¡¹ç›®æ¨¡å¼ï¼Œæ˜¾ç¤ºå®Œæ•´å…ƒæ•°æ®è¡¨å•
- **[é€‰æ‹©å·²æœ‰é¡¹ç›®]**: åˆ‡æ¢åˆ°é€‰æ‹©å·²æœ‰é¡¹ç›®æ¨¡å¼ï¼Œæ˜¾ç¤ºé¡¹ç›®ä¸‹æ‹‰é€‰æ‹©æ¡†
- ä¸‹æ‹‰æ¡†é€‰é¡¹æ ¼å¼: `é¡¹ç›®ç¼–å·|é¡¹ç›®æ ‡é¢˜`ï¼ˆå¦‚ `RAW_A1B2C3D4|è‚ºç™ŒmRNAseqç ”ç©¶`ï¼‰

**åŸå§‹æ•°æ®å¯¼å…¥è¡¨å•å¸ƒå±€**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç›®æ ‡é¡¹ç›®: [æ–°å»ºé¡¹ç›®]  â—‰ [é€‰æ‹©å·²æœ‰é¡¹ç›®]                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ•°æ®ç±»å‹: â— [åŸå§‹æ•°æ®]  â—‹ [ç»“æœæ•°æ®]                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é€‰æ‹©å·²æœ‰é¡¹ç›®: [RAW_A1B2C3D4|è‚ºç™ŒmRNAseqç ”ç©¶ â–¼]         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é¡¹ç›®ç¼–å·: RAW_A1B2C3D4   (åªè¯»)                         â”‚
â”‚ æ•°æ®ç±»å‹: [mRNAseq â–¼]       (å¯ç¼–è¾‘ï¼Œsingle_select)     â”‚
â”‚ ç‰©ç§:     [Homo sapiens â–¼]  (å¯ç¼–è¾‘ï¼Œsingle_select)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é€‰æ‹©æ–‡ä»¶: [å…¨é€‰] [å–æ¶ˆå…¨é€‰]                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â˜‘ file1.fastq  â˜‘ file2.fastq                       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç»“æœæ•°æ®å¯¼å…¥è¡¨å•å¸ƒå±€**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç›®æ ‡é¡¹ç›®: [æ–°å»ºé¡¹ç›®]  â—‰ [é€‰æ‹©å·²æœ‰é¡¹ç›®]                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ•°æ®ç±»å‹: â—‹ [åŸå§‹æ•°æ®]  â— [ç»“æœæ•°æ®]                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é€‰æ‹©å·²æœ‰é¡¹ç›®: [RES_X1Y2Z3|å·®å¼‚åˆ†æç»“æœ â–¼]               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é¡¹ç›®ç¼–å·: RES_X1Y2Z3   (åªè¯»)                           â”‚
â”‚ åˆ†æç±»å‹: [DEA â–¼]              (å¯ç¼–è¾‘ï¼Œsingle_select)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é€‰æ‹©æ–‡ä»¶: [å…¨é€‰] [å–æ¶ˆå…¨é€‰]                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â˜‘ result.csv  â˜‘ stats.txt                          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…ƒæ•°æ®å­—æ®µæ˜¾ç¤ºè§„åˆ™**ï¼š
- æ ¹æ®ç¯å¢ƒå˜é‡é…ç½®åŠ¨æ€é€‰æ‹©æ˜¾ç¤ºçš„å­—æ®µç¼–å·
- `METADATA_FIELDS_NEW_RAW`ï¼šæ–°å»ºåŸå§‹æ•°æ®é¡¹ç›®æ—¶æ˜¾ç¤ºçš„å­—æ®µï¼ˆé»˜è®¤: 3,4,5,6,7ï¼‰
- `METADATA_FIELDS_EXIST_RAW`ï¼šå¯¼å…¥åˆ°å·²æœ‰åŸå§‹æ•°æ®é¡¹ç›®æ—¶æ˜¾ç¤ºçš„å­—æ®µï¼ˆé»˜è®¤: 3,4,5,6,7ï¼‰
- `METADATA_FIELDS_NEW_RESULT`ï¼šæ–°å»ºç»“æœé¡¹ç›®æ—¶æ˜¾ç¤ºçš„å­—æ®µï¼ˆé»˜è®¤: 3,4,5ï¼‰
- `METADATA_FIELDS_EXIST_RESULT`ï¼šå¯¼å…¥åˆ°å·²æœ‰ç»“æœé¡¹ç›®æ—¶æ˜¾ç¤ºçš„å­—æ®µï¼ˆé»˜è®¤: 3,4,5ï¼‰
- å­—æ®µæ§ä»¶ç±»å‹æ ¹æ® `field_type` åŠ¨æ€æ¸²æŸ“ï¼štext â†’ è¾“å…¥æ¡†ï¼Œtextarea â†’ æ–‡æœ¬åŸŸï¼Œselect â†’ ä¸‹æ‹‰æ¡†

**å…ƒæ•°æ®å€¼å¤„ç†è§„åˆ™**ï¼š
- **å­—æ®µå€¼è¿½åŠ **ï¼šç”¨æˆ·é€‰æ‹©çš„æ–°å€¼ä¼šè¿½åŠ åˆ°é¡¹ç›®å½“å‰å­—æ®µå€¼ä¸­ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰ï¼Œ**å»é‡**
- **å­˜å‚¨è·¯å¾„è®¡ç®—**ï¼šæ ¹æ®ç”¨æˆ·é€‰æ‹©çš„æ–°å­—æ®µå€¼åŠ¨æ€ç¡®å®šå­˜å‚¨ç›®å½•
- **è¯¦ç»†è§„åˆ™**ï¼šå‚è§ [7.5 æ–‡ä»¶å¯¼å…¥å®Œæ•´é€»è¾‘](#75-æ–‡ä»¶å¯¼å…¥å®Œæ•´é€»è¾‘)

**æ–‡ä»¶å¯¼å…¥å®Œæ•´æµç¨‹**ï¼šå‚è§ [7.5 æ–‡ä»¶å¯¼å…¥å®Œæ•´é€»è¾‘](#75-æ–‡ä»¶å¯¼å…¥å®Œæ•´é€»è¾‘)

### 7.4 å…ƒæ•°æ®é…ç½®

#### åŠŸèƒ½ç‰¹æ€§
- åŠ¨æ€å­—æ®µé…ç½®ç®¡ç†
- å­—æ®µç±»å‹ç¼–è¾‘
- **åªè¯»å­—æ®µè®¾ç½® (`field_readonly`)**: å¯è®¾ç½®å­—æ®µä¸ºç³»ç»Ÿè‡ªåŠ¨ç®¡ç†ï¼ˆæ–‡ä»¶å¯¼å…¥æ—¶è‡ªåŠ¨æ›´æ–°ï¼‰
- ä¸‹æ‹‰é€‰é¡¹ç®¡ç†
- å­—æ®µæ’åºè°ƒæ•´
- æ•°æ®åº“å¤‡ä»½

#### å­—æ®µé…ç½®ç®¡ç†
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å…ƒæ•°æ®é…ç½®                      [åˆ·æ–°] [æ›´æ–°æ’åº] [å¤‡ä»½]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åŸå§‹æ•°æ®â”‚ ç»“æœ   â”‚ æ–‡ä»¶   â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ æ’åº â”‚ å­—æ®µæ ‡è¯†ç¬¦  â”‚ å­—æ®µåç§° â”‚ ç±»å‹  â”‚ å¿…å¡« â”‚ æ’åˆ—æ–¹å¼ â”‚ åªè¯» â”‚ æ“ä½œâ”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ [1]  â”‚ raw_type   â”‚ æ•°æ®ç±»å‹ â”‚ ä¸‹æ‹‰  â”‚ æ˜¯   â”‚ ä¸¤åˆ—     â”‚ å¦   â”‚ [ç¼–è¾‘]â”‚   â”‚
â”‚  â”‚ [2]  â”‚ raw_speciesâ”‚ ç‰©ç§     â”‚ ä¸‹æ‹‰  â”‚ æ˜¯   â”‚ ä¸¤åˆ—     â”‚ å¦   â”‚ [ç¼–è¾‘]â”‚   â”‚
â”‚  â”‚ [12] â”‚ raw_file_count â”‚ æ–‡ä»¶æ•°é‡ â”‚ æ–‡æœ¬ â”‚ å¦   â”‚ ä¸¤åˆ—     â”‚ æ˜¯   â”‚ [ç¼–è¾‘]â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  åˆ—è¯´æ˜:                                                     â”‚
â”‚  - æ’åº: æ‹–æ‹½è°ƒæ•´å­—æ®µæ˜¾ç¤ºé¡ºåº                                â”‚
â”‚  - å­—æ®µæ ‡è¯†ç¬¦: æ•°æ®åº“å­—æ®µåç§° (å¦‚ raw_type)                  â”‚
â”‚  - å­—æ®µåç§°: å‰ç«¯æ˜¾ç¤ºçš„æ ‡ç­¾åç§°                              â”‚
â”‚  - ç±»å‹: æ–‡æœ¬/å¤šè¡Œæ–‡æœ¬/ä¸‹æ‹‰                                  â”‚
â”‚  - å¿…å¡«: æ˜¯å¦ä¸ºå¿…å¡«å­—æ®µ                                     â”‚
â”‚  - æ’åˆ—æ–¹å¼: å•åˆ—(å æ»¡æ•´è¡Œ) æˆ– ä¸¤åˆ—(é»˜è®¤)                    â”‚
â”‚  - åªè¯»: æ˜¯å¦ä¸ºç³»ç»Ÿè‡ªåŠ¨ç®¡ç†å­—æ®µ (ä¸å¯æ‰‹åŠ¨ç¼–è¾‘)               â”‚
â”‚                                                             â”‚
â”‚  ä¸‹æ‹‰æ¡†æ¨¡å¼è¯´æ˜:                                             â”‚
â”‚  - æ–°å»ºé¡¹ç›®/ç¼–è¾‘é¡¹ç›®: multi_select (å¯å¤šé€‰)                  â”‚
â”‚  - æ–‡ä»¶å¯¼å…¥: single_select (ä»…å•é€‰)                          â”‚
â”‚                                                             â”‚
â”‚  [æ·»åŠ å­—æ®µ]                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å…«ã€API æ¥å£è®¾è®¡

### 8.1 é¡¹ç›®ç›¸å…³æ¥å£

#### è·å–é¡¹ç›®åˆ—è¡¨
```
GET /api/projects?table=raw|result

Response:
{
    "success": true,
    "data": [
        {
            "id": 1,
            "raw_id": "RAW-A1B2C3D4",
            "raw_title": "é¡¹ç›®åç§°",
            "raw_type": "mRNAseq",
            "raw_species": "Homo sapiens",
            ...
        }
    ],
    "total": 10
}
```

#### åˆ›å»ºé¡¹ç›®
```
POST /api/projects
Content-Type: application/json

{
    "table": "raw",
    "data": {
        "raw_title": "é¡¹ç›®åç§°",
        "raw_type": "mRNAseq",
        "raw_species": "Homo sapiens",
        ...
    }
}

Response:
{"success": true, "message": "åˆ›å»ºæˆåŠŸ", "id": "RAW-A1B2C3D4"}
```

### 8.2 å…ƒæ•°æ®é…ç½®æ¥å£

#### è·å–é…ç½®
```
GET /api/metadata/config

Response:
{
    "success": true,
    "config": [
        {
            "id": 1,
            "field_id": "raw_type",
            "field_name": "æ•°æ®ç±»å‹",
            "field_type": "select",
            "field_table": "raw",
            "field_necessary": true,
            "field_readonly": false,
            "field_placeholder": "2",
            "field_seq": 2,
            "field_options": [
                {"value": "mRNAseq", "label": "mRNAseq"},
                {"value": "miRNAseq", "label": "miRNAseq"}
            ]
        },
        {
            "id": 12,
            "field_id": "raw_file_count",
            "field_name": "æ–‡ä»¶æ•°é‡",
            "field_type": "text",
            "field_table": "raw",
            "field_necessary": false,
            "field_readonly": true,
            "field_placeholder": "2",
            "field_seq": 12,
            "field_options": null
        }
    ]
}
```

**å“åº”å­—æ®µè¯´æ˜**:
- `field_placeholder`: æ’åˆ—æ–¹å¼ï¼Œ`1`=å•åˆ—æ˜¾ç¤ºï¼Œ`2`=ä¸¤åˆ—æ˜¾ç¤º
- `field_readonly`: åªè¯»å±æ€§ï¼Œ`0`=å¯ç¼–è¾‘ï¼Œ`1`=ç³»ç»Ÿè‡ªåŠ¨ç®¡ç†

### 8.3 æ–‡ä»¶ç®¡ç†æ¥å£

#### æ‰«æç›®å½•
```
POST /api/files/scan
Content-Type: application/json

{"path": "/downloads/test_project"}

Response:
{
    "success": true,
    "files": [
        {"name": "sample.fastq", "path": "...", "size": 1024000}
    ]
}
```

#### å¯¼å…¥æ–‡ä»¶ï¼ˆåˆ›å»ºæ–°é¡¹ç›®ï¼‰
```
POST /api/import-download
Content-Type: application/json

{
    "folder_name": "test_import",
    "files": ["sample1.fastq", "sample2.fastq"],
    "data_type": "raw",
    "project_info": {
        "raw_id": "RAW_XXXXXXXX",
        "raw_title": "é¡¹ç›®åç§°",
        "raw_type": "è½¬å½•ç»„",
        "raw_species": "äºº",
        "raw_tissue": "è‚"
    }
}

Response:
{
    "success": true,
    "imported": 2,
    "duplicate": 0,
    "project_id": "RAW_XXXXXXXX",
    "storage_path": "/bio/rawdata/mRseq/Hs/Li/RAW_XXXXXXXX/"
}
```

#### å¯¼å…¥æ–‡ä»¶ï¼ˆåˆ›å»ºå·²æœ‰é¡¹ç›®ï¼‰
```
POST /api/import-download
Content-Type: application/json

{
    "folder_name": "test_import",
    "files": ["sample1.fastq"],
    "data_type": "raw",
    "project_id": "RAW_YYYYYYYY",
    "metadata_override": {
        "raw_type": "è›‹ç™½ç»„",
        "raw_species": "å°é¼ ",
        "raw_tissue": "å¿ƒ"
    }
}

Response:
{
    "success": true,
    "imported": 1,
    "duplicate": 0,
    "project_id": "RAW_YYYYYYYY",
    "storage_path": "/bio/rawdata/Prot/Ms/He/RAW_YYYYYYYY/"
}
```

**API è¯´æ˜**ï¼š
- `folder_name`: ä¸‹è½½ç›®å½•ä¸‹çš„æ–‡ä»¶å¤¹åç§°
- `files`: è¦å¯¼å…¥çš„æ–‡ä»¶ååˆ—è¡¨
- `data_type`: 'raw' æˆ– 'result'
- `project_info`: æ–°å»ºé¡¹ç›®æ—¶ä¼ å…¥çš„é¡¹ç›®ä¿¡æ¯
- `project_id`: é€‰æ‹©å·²æœ‰é¡¹ç›®æ—¶ä¼ å…¥çš„é¡¹ç›®ç¼–å·
- `metadata_override`: é€‰æ‹©å·²æœ‰é¡¹ç›®æ—¶ä¼ å…¥çš„è¦è¿½åŠ çš„å…ƒæ•°æ®

**è¯¦ç»†å¯¼å…¥æµç¨‹**ï¼šå‚è§ [7.5 æ–‡ä»¶å¯¼å…¥å®Œæ•´é€»è¾‘](#75-æ–‡ä»¶å¯¼å…¥å®Œæ•´é€»è¾‘)

## ä¹ã€æ€§èƒ½ä¼˜åŒ–

### 9.1 æ•°æ®åº“è¿æ¥æ± 

```python
# ä¼˜åŒ–é…ç½®
pool_size=20              # æ ¹æ®å¹¶å‘éœ€æ±‚è°ƒæ•´
pool_reset_session=True   # é‡ç½®ä¼šè¯çŠ¶æ€
connection_timeout=30     # è¿æ¥è¶…æ—¶æ—¶é—´
```

**ä¼˜åŒ–æ•ˆæœ**:
- é¿å…é¢‘ç¹åˆ›å»º/é”€æ¯è¿æ¥
- æ”¯æŒå¹¶å‘è¯·æ±‚å¤„ç†
- å‡å°‘æ•°æ®åº“æœåŠ¡å™¨è´Ÿè½½

### 9.2 è¯·æ±‚é˜²æŠ–

```javascript
// é˜²æŠ–é…ç½®
const AJAX_POOL = {
    getDebounceMs: 200,    // GET è¯·æ±‚ 200ms
    postDebounceMs: 500    // POST è¯·æ±‚ 500ms
};
```

**ä¼˜åŒ–æ•ˆæœ**:
- é˜²æ­¢ç”¨æˆ·å¿«é€Ÿç‚¹å‡»å¯¼è‡´çš„é‡å¤è¯·æ±‚
- å‡å°‘æ•°æ®åº“æŸ¥è¯¢å‹åŠ›
- æå‡å‰ç«¯å“åº”ä½“éªŒ

### 9.3 è¿æ¥ç”Ÿå‘½å‘¨æœŸç®¡ç†

```python
# æ¯ä¸ªæ“ä½œç‹¬ç«‹è·å–/å½’è¿˜è¿æ¥
def query(self, query, params=None):
    connection = self.get_connection()
    try:
        # æ‰§è¡ŒæŸ¥è¯¢
        cursor.execute(query, params)
        return cursor.fetchall()
    finally:
        # å§‹ç»ˆé‡Šæ”¾èµ„æº
        cursor.close()
        connection.close()
```

**ä¼˜åŒ–æ•ˆæœ**:
- é˜²æ­¢è¿æ¥æ³„æ¼
- ç¡®ä¿è¿æ¥åŠæ—¶å½’è¿˜æ± 
- é¿å…è¿æ¥è€—å°½

## åã€éƒ¨ç½²æ¶æ„

### 10.1 Docker éƒ¨ç½²

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Docker Compose                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ biodata-manager     â”‚    â”‚ biodata-mysql       â”‚           â”‚
â”‚  â”‚ - Flask 8000        â”‚â”€â”€â”€â–ºâ”‚ - MySQL 3306        â”‚           â”‚
â”‚  â”‚ - è¿æ¥æ±  20         â”‚    â”‚                     â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                 â”‚
â”‚  ç«¯å£æ˜ å°„:                                                         â”‚
â”‚  - 20425:8000 (å¯¹å¤–)                                              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.2 æ•°æ®å­˜å‚¨

```
/bioraw/
â”œâ”€â”€ rawdata/          # åŸå§‹æ•°æ®å­˜å‚¨
â”‚   â””â”€â”€ {abbr}/{abbr}/{abbr}/{raw_id}/
â”œâ”€â”€ downloads/        # ä¸‹è½½ç›®å½• (æ‰«æå¯¼å…¥)
â”œâ”€â”€ results/          # ç»“æœæ•°æ®å­˜å‚¨
â””â”€â”€ analysis/         # åˆ†æç»“æœå­˜å‚¨
```

## åä¸€ã€å¼•æ–‡è§£ææ¨¡å—

### 11.1 æ¨¡å—æ¦‚è¿°

å¼•æ–‡è§£ææ¨¡å—ç”¨äºè§£ææ–‡çŒ®å¼•ç”¨æ–‡ä»¶ï¼ˆ.bibã€.risã€.enwï¼‰ï¼Œè‡ªåŠ¨æå–æ–‡çŒ®ä¿¡æ¯å¹¶å¡«å……é¡¹ç›®å…ƒæ•°æ®ã€‚

### 11.2 æ–‡ä»¶ç»“æ„

```
app/
â”œâ”€â”€ citation_parser.py   # å¼•æ–‡è§£ææ¨¡å—
```

### 11.3 CitationParser ç±»

```python
class CitationParser:
    """æ–‡çŒ®å¼•ç”¨è§£æå™¨"""
    
    SUPPORTED_FORMATS = ['.bib', '.ris', '.enw']
    
    def parse_file(self, file_path: str) -> List[Dict[str, Any]]:
        """è§£æå¼•æ–‡æ–‡ä»¶"""
        # æ ¹æ®æ–‡ä»¶æ‰©å±•åè‡ªåŠ¨é€‰æ‹©è§£ææ–¹å¼
        # æ”¯æŒ BibTeXã€RISã€ENW æ ¼å¼
        
    def parse_content(self, content: str, format_type: str) -> List[Dict[str, Any]]:
        """ç›´æ¥è§£æå†…å®¹å­—ç¬¦ä¸²"""
        
    def citation_to_project(self, citation: Dict[str, Any]) -> Dict[str, Any]:
        """å°†å¼•æ–‡ä¿¡æ¯è½¬æ¢ä¸ºé¡¹ç›®æ•°æ®"""
```

### 11.4 æ”¯æŒçš„æ ¼å¼

| æ ¼å¼ | æ‰©å±•å | è¯´æ˜ |
|------|--------|------|
| BibTeX | .bib | LaTeX æ–‡çŒ®å¼•ç”¨æ ¼å¼ |
| RIS | .ris | ç ”ç©¶ä¿¡æ¯æ ‡å‡†æ ¼å¼ |
| ENW | .enw | EndNote å¼•ç”¨æ ¼å¼ |

### 11.5 API æ¥å£

```python
@app.route('/api/parse-citation', methods=['POST'])
def api_parse_citation():
    """è§£æå¼•æ–‡æ–‡ä»¶
    
    è¯·æ±‚:
    - Content-Type: multipart/form-data
    - file: å¼•æ–‡æ–‡ä»¶ (.bib, .ris, .enw)
    
    å“åº”:
    {
        "success": true,
        "count": 1,
        "citations": [{
            "citation": {...},  # åŸå§‹è§£æç»“æœ
            "project": {...}    # è½¬æ¢ä¸ºé¡¹ç›®æ•°æ®
        }]
    }
    """
```

### 11.6 å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å¼•æ–‡è§£æå·¥ä½œæµç¨‹                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶ (.bib/.ris/.enw)                               â”‚
â”‚           â”‚                                                     â”‚
â”‚           â–¼                                                     â”‚
â”‚  2. å‰ç«¯ POST /api/parse-citation                               â”‚
â”‚           â”‚                                                     â”‚
â”‚           â–¼                                                     â”‚
â”‚  3. åç«¯ä¿å­˜ä¸´æ—¶æ–‡ä»¶                                            â”‚
â”‚           â”‚                                                     â”‚
â”‚           â–¼                                                     â”‚
â”‚  4. CitationParser è§£æå†…å®¹                                     â”‚
â”‚           â”‚                                                     â”‚
â”‚           â–¼                                                     â”‚
â”‚  5. è½¬æ¢ä¸ºé¡¹ç›®æ•°æ®æ ¼å¼                                          â”‚
â”‚           â”‚                                                     â”‚
â”‚           â–¼                                                     â”‚
â”‚  6. è¿”å›è§£æç»“æœ                                                â”‚
â”‚           â”‚                                                     â”‚
â”‚           â–¼                                                     â”‚
â”‚  7. å‰ç«¯è‡ªåŠ¨å¡«å……è¡¨å•                                            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.7 æå–çš„å­—æ®µ

| å¼•æ–‡å­—æ®µ | é¡¹ç›®å­—æ®µ | è¯´æ˜ |
|----------|----------|------|
| title | raw_title | æ–‡çŒ®æ ‡é¢˜ |
| author | (å¤„ç†ä¸­) | ä½œè€…åˆ—è¡¨ |
| year | - | å‡ºç‰ˆå¹´ä»½ |
| journal | - | æœŸåˆŠåç§° |
| doi | raw_DOI | DOI å· |
| abstract | raw_description | æ‘˜è¦ |
| keywords | raw_keywords | å…³é”®è¯ |

## åäºŒã€é”™è¯¯å¤„ç†

### 11.1 å‰ç«¯é”™è¯¯å¤„ç†

```javascript
// ç»Ÿä¸€é”™è¯¯å¤„ç†
$.ajaxSetup({
    timeout: 30000,
    error: function(xhr, status, error) {
        showToast('è¯·æ±‚å¤±è´¥: ' + error, 'error');
    }
});

// Loading çŠ¶æ€ç®¡ç†
let loadingCount = 0;
function showLoading() {
    loadingCount++;
    if (loadingCount === 1) $('#loading').show();
}
function hideLoading() {
    loadingCount--;
    if (loadingCount <= 0) {
        loadingCount = 0;
        $('#loading').hide();
    }
}
```

### 11.2 åç«¯é”™è¯¯å¤„ç†

```python
@app.errorhandler(500)
def internal_error(error):
    return render_template('error.html', message="æœåŠ¡å™¨å†…éƒ¨é”™è¯¯"), 500

@app.errorhandler(404)
def not_found_error(error):
    return render_template('error.html', message="é¡µé¢ä¸å­˜åœ¨"), 404
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: 6.5  
**æ›´æ–°æ—¥æœŸ**: 2026-01-27  
**æŠ€æœ¯æ ˆ**: Python Flask + Jinja2 + Bootstrap 5 + MySQL  
**ä¸»è¦æ›´æ–°**: 
- æ–°å¢å¤šé€‰ç¼–è¾‘åŠŸèƒ½ï¼ˆbootstrap-select æ”¯æŒï¼‰
- æ–°å¢ç­›é€‰æ¡†å€¼åˆ°æ ‡ç­¾è½¬æ¢é€»è¾‘
- æ–°å¢ç¼–è¾‘é¡¹ç›®å›æ˜¾å·²æœ‰å€¼åŠŸèƒ½
- æ–°å¢æ–‡ä»¶å¯¼å…¥ overwrite å‚æ•°æ”¯æŒ
- raw_tissue éªŒè¯æ”¯æŒä¸­æ–‡å­—ç¬¦

**ä¸»è¦æ›´æ–° (v6.4)**: 
- æ–°å¢ 7.3 æ–‡ä»¶ç®¡ç†-ç®¡ç†é¡µé¢ï¼ˆå«ç­›é€‰æ¡ä»¶ã€å·²å¯¼å…¥é¡¹ç›®è¡¨æ ¼ã€åˆ—è¡¨æ’åºåŠŸèƒ½ï¼‰
- æ–°å¢ 7.4 æ–‡ä»¶ç®¡ç†-å¯¼å…¥é¡µé¢
- æ–°å¢ 7.5 é¡¹ç›®è¯¦æƒ…æ¨¡æ€æ¡†ï¼ˆå«æ–‡ä»¶åˆ—è¡¨æ’åºåŠŸèƒ½ï¼‰
- æ–°å¢ 7.6 æ–‡ä»¶æ“ä½œåŠŸèƒ½ï¼ˆåˆ é™¤ã€ä¸‹è½½ï¼‰
- æ–°å¢ 7.7 API æ¥å£è®¾è®¡
- ä¼˜åŒ–é¡¹ç›®ç¼–å·æ ¼å¼ä¸º RAW_XXXï¼ˆ8ä½UUIDï¼‰
- æ–‡ä»¶å¯¼å…¥åŠŸèƒ½å®Œå–„

---

## åä¸‰ã€å¤šé€‰ç¼–è¾‘ä¸ç­›é€‰åŠŸèƒ½

### 13.1 bootstrap-select å¤šé€‰ç»„ä»¶

#### 13.1.1 ç¼–è¾‘é¡¹ç›®è¡¨å•å¤šé€‰æ”¯æŒ

```javascript
// åˆå§‹åŒ– bootstrap-select å¤šé€‰ç»„ä»¶
$('.selectpicker').selectpicker({
    noneSelectedText: 'è¯·é€‰æ‹©...',
    selectAllText: 'å…¨é€‰',
    deselectAllText: 'å–æ¶ˆå…¨é€‰'
});

// å¤šé€‰å€¼è·å–ï¼ˆé€—å·åˆ†éš”ï¼‰
if ($(el).hasClass('selectpicker') && $(el).attr('multiple') !== null) {
    value = ($(el).val() || []).join(',');
}
```

#### 13.1.2 ç¼–è¾‘å›æ˜¾å·²æœ‰å€¼

```javascript
// è·å–å·²æœ‰å€¼å¹¶æŒ‰é€—å·åˆ†å‰²
const fieldLabels = fieldValue.split(',').map(v => v.trim()).filter(v => v);

// åŒ¹é…é€‰é¡¹å¹¶æ ‡è®°å·²é€‰æ‹©
const selected = fieldLabels.includes(String(label)) ? 'selected' : '';
```

### 13.2 ç­›é€‰æ¡†å€¼åˆ°æ ‡ç­¾è½¬æ¢

#### 13.2.1 é—®é¢˜èƒŒæ™¯

API è¿”å›çš„æ•°æ®ä¸­ï¼Œselect ç±»å‹å­—æ®µæ˜¾ç¤ºçš„æ˜¯ labelï¼ˆå¦‚"è½¬å½•ç»„"ï¼‰ï¼Œä½†ç­›é€‰ä¸‹æ‹‰æ¡†å­˜å‚¨çš„æ˜¯ valueï¼ˆå¦‚"mRNAseq"ï¼‰ã€‚ç›´æ¥æ¯”è¾ƒä¼šå¯¼è‡´ç­›é€‰å¤±è´¥ã€‚

#### 13.2.2 è§£å†³æ–¹æ¡ˆ

```
ç”¨æˆ·é€‰æ‹© value â†’ è½¬æ¢ä¸º label â†’ ä¸ API è¿”å›çš„ label æ¯”è¾ƒ
```

```javascript
// æ„å»º value â†’ label æ˜ å°„
window.filterValueToLabelMap = {
    raw_type: { 'mRNAseq': 'è½¬å½•ç»„', 'è›‹ç™½ç»„': 'è›‹ç™½ç»„' },
    raw_species: { 'Homo sapiens': 'äºº', 'Mus musculus': 'å°é¼ ' }
};

// ç­›é€‰æ—¶è½¬æ¢
const typeValue = $('#filter-raw_type').val();
const type = window.filterValueToLabelMap?.raw_type?.[typeValue] ? 
    window.filterValueToLabelMap.raw_type[typeValue] : typeValue;

// ä½¿ç”¨ label è¿›è¡ŒåŒ…å«åŒ¹é…
if (type) {
    filtered = filtered.filter(p => p.raw_type && p.raw_type.includes(type));
}
```

#### 13.2.3 å¤šå€¼å­—æ®µç­›é€‰

`results_raw` ç­‰é€—å·åˆ†éš”å­—æ®µä½¿ç”¨ `includes()` è¿›è¡Œéƒ¨åˆ†åŒ¹é…ï¼š

```javascript
if (raw) {
    filtered = filtered.filter(p => p.results_raw && p.results_raw.includes(raw));
}
```

### 13.3 æ•°æ®æµæ€»ç»“

| åœºæ™¯ | æ˜¾ç¤º | å­˜å‚¨ | APIè¿”å› | ç­›é€‰æ¯”è¾ƒ |
|------|------|------|---------|---------|
| é¡¹ç›®åˆ—è¡¨ | label | value | label | valueâ†’label |
| æ–°å»º/ç¼–è¾‘ | value (select) | value | - | - |
| ç­›é€‰æ¡† | label (æ˜¾ç¤º) | value (é€‰ä¸­å€¼) | label | valueâ†’label |

---

## åå››ã€æ–‡ä»¶å¯¼å…¥ Overwrite åŠŸèƒ½

### 14.1 åŒåæ–‡ä»¶å¤„ç†æµç¨‹

```
ç”¨æˆ·é€‰æ‹©æ–‡ä»¶ â†’ åç«¯æ£€æµ‹åŒåæ–‡ä»¶ â†’ 
    â”œâ”€â”€ overwrite=false â†’ è¿”å›é”™è¯¯æç¤º
    â””â”€â”€ overwrite=true â†’ åˆ é™¤æ—§è®°å½•ï¼Œæ’å…¥æ–°è®°å½•
```

### 14.2 API è¯·æ±‚å‚æ•°

```json
{
    "folder_name": "test_import",
    "files": ["sample.fastq"],
    "data_type": "raw",
    "project_id": "RAW_XXXXXXXX",
    "overwrite": true,
    "metadata_override": { ... }
}
```

### 14.3 å‰ç«¯å¤„ç†

```javascript
// å¯¼å…¥åˆ°å·²æœ‰é¡¹ç›®æ—¶è¯¢é—®æ˜¯å¦è¦†ç›–
if (res.is_duplicate && !overwrite) {
    if (confirm(`æ–‡ä»¶ "${fileName}" å·²å­˜åœ¨ï¼Œæ˜¯å¦è¦†ç›–ï¼Ÿ`)) {
        // é‡æ–°æäº¤å¹¶è®¾ç½® overwrite=true
        importFilesWithOverwrite();
    }
} else if (res.success) {
    showToast('å¯¼å…¥æˆåŠŸ');
}
```

---

## åäº”ã€ä¸­æ–‡å­—ç¬¦éªŒè¯

### 15.1 raw_tissue éªŒè¯è§„åˆ™

```python
raw_tissue = self._validate_comma_separated(raw_tissue_input, 'ç»„ç»‡æ¥æº (raw_tissue)', allow_chinese=True)
```

**æ”¯æŒçš„å­—ç¬¦ï¼š**
- è‹±æ–‡é€—å· `,` åˆ†éš”å¤šä¸ªå€¼
- ä¸­æ–‡é€—å· `ï¼Œ` æ›¿ä»£è‹±æ–‡é€—å·
- ä¸­æ–‡å­—ç¬¦ï¼ˆç»„ç»‡åç§°å¦‚"è‚"ã€"å¿ƒ"ã€"è‚º"ç­‰ï¼‰

**éªŒè¯é€šè¿‡ç¤ºä¾‹ï¼š**
- `Liver,Kidney`
- `è‚è„,å¿ƒè„`
- `è‚, å¿ƒ, è‚º`ï¼ˆå¸¦ç©ºæ ¼ï¼‰

---
---

### 7.6 æ–‡ä»¶æ ¡éªŒåŠŸèƒ½ï¼ˆå¼‚æ­¥ Hash è®¡ç®—ï¼‰

#### åŠŸèƒ½æ¦‚è¿°

æ–‡ä»¶æ ¡éªŒåŠŸèƒ½æä¾›æ–‡ä»¶ MD5 å’Œ SHA256 å“ˆå¸Œå€¼çš„å¼‚æ­¥è®¡ç®—ã€ä¿å­˜å’Œå¯¹æ¯”åŠŸèƒ½ã€‚æ”¯æŒå¤§æ–‡ä»¶ï¼ˆGB çº§åˆ«ï¼‰æ ¡éªŒï¼Œè§£å†³è®¡ç®—è¶…æ—¶é—®é¢˜ã€‚

#### é¡µé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–‡ä»¶ç®¡ç†                                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å·²å¯¼å…¥é¡¹ç›®                                            (å…± X ä¸ªé¡¹ç›®)  â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ # â”‚ é¡¹ç›®ç¼–å·     â”‚ é¡¹ç›®åç§° â”‚ é¡¹ç›®ç±»å‹ â”‚ åˆ›å»ºæ—¶é—´ â”‚ æ–‡ä»¶æ•°é‡ â”‚ æ“ä½œ â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ 1 â”‚ RAW_XXX     â”‚ é¡¹ç›®A   â”‚ åŸå§‹æ•°æ® â”‚ 2026-01  â”‚ 10      â”‚[æŸ¥çœ‹]â”‚   â”‚
â”‚  â”‚   â”‚           â”‚          â”‚       â”‚          â”‚[æ ¡éªŒ]â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ ¡éªŒå¼¹çª—å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–‡ä»¶æ ¡éªŒ                                          [å…³é—­]                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é¡¹ç›®ç¼–å·: RAW_XXX                                                       â”‚
â”‚  æ•°æ®ç±»å‹: åŸå§‹æ•°æ®                                                       â”‚
â”‚  æ–‡ä»¶æ•°é‡: 10                                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â˜‘ â”‚ æ–‡ä»¶å              â”‚ å±æ€§      â”‚ æ—§Hashå€¼               â”‚ æ–°Hashå€¼ â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚   â”‚ sample1.fastq.gz   â”‚ scseq     â”‚ MD5ï¼š...              â”‚          â”‚ â”‚
â”‚  â”‚   â”‚                   â”‚           â”‚ SHA256ï¼š...            â”‚          â”‚ â”‚
â”‚  â”‚   â”‚ sample2.fastq.gz   â”‚ scseq     â”‚ MD5ï¼š...              â”‚          â”‚ â”‚
â”‚  â”‚   â”‚                   â”‚           â”‚ SHA256ï¼š...            â”‚          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  [æ ¡éªŒé€‰ä¸­] [ä¿å­˜æ ¡éªŒ]                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Hash å€¼æ˜¾ç¤ºæ ¼å¼

```
æ—§Hashå€¼ï¼š
MD5ï¼šxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
SHA256ï¼šxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

æ–°Hashå€¼ï¼š
MD5ï¼šxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
SHA256ï¼šxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

#### æŠ€æœ¯å®ç°

##### 7.6.1 å¼‚æ­¥ä»»åŠ¡ç®¡ç†å™¨ (TaskManager)

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- åˆ›å»ºå¼‚æ­¥ä»»åŠ¡å¹¶è¿”å›ä»»åŠ¡ ID
- åå°çº¿ç¨‹æ‰§è¡Œ Hash è®¡ç®—
- å®æ—¶è·Ÿè¸ªä»»åŠ¡çŠ¶æ€å’Œè¿›åº¦
- æ”¯æŒå¤šæ–‡ä»¶æ‰¹é‡è®¡ç®—

**ä»»åŠ¡çŠ¶æ€**ï¼š
- `pending` - ç­‰å¾…æ‰§è¡Œ
- `running` - æ­£åœ¨è®¡ç®—
- `completed` - è®¡ç®—å®Œæˆ
- `failed` - è®¡ç®—å¤±è´¥

**ç›¸å…³æ–¹æ³•**ï¼š
```python
class TaskManager:
    def create_task(self, file_ids, db_manager):
        """åˆ›å»ºæ–°ä»»åŠ¡ï¼Œè¿”å›ä»»åŠ¡ ID"""
        task_id = str(uuid.uuid4())
        self.tasks[task_id] = {
            'status': 'pending',
            'file_ids': file_ids,
            'total': len(file_ids),
            'current': 0,
            'results': {},
            'error': None,
            'db_manager': db_manager
        }
        return task_id
    
    def start_task(self, task_id):
        """å¯åŠ¨åå°ä»»åŠ¡"""
        thread = threading.Thread(target=self._run_task, args=(task_id,))
        thread.daemon = True
        thread.start()
    
    def get_task_status(self, task_id):
        """è·å–ä»»åŠ¡çŠ¶æ€"""
        task = self.tasks.get(task_id)
        if not task:
            return None
        
        return {
            'status': task['status'],
            'total': task['total'],
            'current': task['current'],
            'progress': int((task['current'] / task['total']) * 100),
            'results': task['results'] if task['status'] == 'completed' else {},
            'error': task['error']
        }
```

##### 7.6.2 åˆ†å—è¯»å–è®¡ç®—

**å®ç°ç»†èŠ‚**ï¼š
```python
def _calculate_file_hash(self, file_path: Path) -> tuple:
    """è®¡ç®—å•ä¸ªæ–‡ä»¶çš„ MD5 å’Œ SHA256"""
    md5_hash = hashlib.md5()
    sha256_hash = hashlib.sha256()
    
    # åˆ†å—è¯»å–ï¼Œé¿å…å†…å­˜é—®é¢˜
    chunk_size = 8192
    with open(file_path, 'rb') as f:
        while chunk := f.read(chunk_size):
            md5_hash.update(chunk)
            sha256_hash.update(chunk)
    
    return md5_hash.hexdigest(), sha256_hash.hexdigest()
```

##### 7.6.3 å‰ç«¯è½®è¯¢æœºåˆ¶

**è½®è¯¢æµç¨‹**ï¼š
```
ç”¨æˆ·ç‚¹å‡»"æ ¡éªŒé€‰ä¸­"
        â”‚
        â–¼
POST /api/files/hash/calculate
        â”‚
        â–¼
è¿”å›: { task_id: "xxx", message: "ä»»åŠ¡å·²åˆ›å»º" }
        â”‚
        â–¼
å‰ç«¯æ¯ 2 ç§’è½®è¯¢ä¸€æ¬¡
        â”‚
        â–¼
GET /api/files/hash/status/{task_id}
        â”‚
        â–¼
è¿”å›: { status: "running", current: 1, total: 3, progress: 33% }
        â”‚
        â–¼
æ˜¾ç¤ºè¿›åº¦: "æ­£åœ¨è®¡ç®—: 1/3 æ–‡ä»¶ (33%)"
        â”‚
        â–¼
ç»§ç»­è½®è¯¢...
        â”‚
        â–¼
GET /api/files/hash/status/{task_id}
        â”‚
        â–¼
è¿”å›: { status: "completed", results: {...} }
        â”‚
        â–¼
æ˜¾ç¤ºè®¡ç®—ç»“æœ
```

**å‰ç«¯ä»£ç **ï¼š
```javascript
function calculateSelectedHash() {
    const fileIds = getVerifyFileIds();
    
    // ç¦ç”¨æŒ‰é’®ï¼Œæ˜¾ç¤ºåŠ è½½åŠ¨ç”»
    $('#calculate-hash-btn').prop('disabled', true)
        .html('<i class="bi bi-spinner spin me-1"></i>æ­£åœ¨è®¡ç®—...');
    
    apiPost('/api/files/hash/calculate', { file_ids: fileIds }).then(function(res) {
        if (res.success && res.task_id) {
            pollHashTaskStatus(res.task_id);
        }
    });
}

function pollHashTaskStatus(taskId) {
    const pollInterval = setInterval(function() {
        apiGet(`/api/files/hash/status/${taskId}`).then(function(res) {
            if (res.status === 'running') {
                showToast(`æ­£åœ¨è®¡ç®—: ${res.current}/${res.total} æ–‡ä»¶ (${res.progress}%)`, 'info');
            } else if (res.status === 'completed') {
                clearInterval(pollInterval);
                
                // æ˜¾ç¤ºè®¡ç®—ç»“æœ
                for (const [fileId, hashData] of Object.entries(res.results)) {
                    const hashDisplay = formatHashValue(hashData.md5, hashData.sha256);
                    $(`#new-hash-${fileId}`).html(hashDisplay);
                    currentVerifiedHash[fileId] = hashData;
                }
                
                showToast(`æˆåŠŸè®¡ç®— ${res.total} ä¸ªæ–‡ä»¶çš„å“ˆå¸Œå€¼`, 'success');
                resetCalculateButton();
            } else if (res.status === 'failed') {
                clearInterval(pollInterval);
                showToast('è®¡ç®—å¤±è´¥: ' + res.error, 'error');
                resetCalculateButton();
            }
        });
    }, 2000); // æ¯ 2 ç§’è½®è¯¢ä¸€æ¬¡
}
```

##### 7.6.4 API æ¥å£

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | `/api/files/hash/calculate` | åˆ›å»ºå¼‚æ­¥è®¡ç®—ä»»åŠ¡ |
| GET | `/api/files/hash/status/<task_id>` | æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€ |
| POST | `/api/files/hash/save` | ä¿å­˜å“ˆå¸Œå€¼åˆ°æ•°æ®åº“ |

##### 7.6.5 å¤§æ–‡ä»¶æµ‹è¯•ç»“æœ

**æµ‹è¯•æ•°æ®**ï¼š
- æ–‡ä»¶å¤§å°ï¼š47GB
- è®¡ç®—æ—¶é—´ï¼šçº¦ 2-3 åˆ†é’Ÿ
- API å“åº”æ—¶é—´ï¼š0 ç§’ï¼ˆç«‹å³è¿”å›ï¼‰
- è¶…æ—¶é—®é¢˜ï¼šå·²å½»åº•è§£å†³

**æµ‹è¯•ç»“æœ**ï¼š
```
âœ… ä»»åŠ¡åˆ›å»ºæˆåŠŸï¼Œç«‹å³è¿”å›ä»»åŠ¡ ID
âœ… åå°çº¿ç¨‹æ­£å¸¸æ‰§è¡Œè®¡ç®—
âœ… å‰ç«¯è½®è¯¢æ­£å¸¸å·¥ä½œ
âœ… è¿›åº¦æ˜¾ç¤ºæ­£ç¡®
âœ… å“ˆå¸Œå€¼è®¡ç®—å‡†ç¡®
âœ… ä¿å­˜åˆ°æ•°æ®åº“æˆåŠŸ
```

#### 7.6.6 ä½¿ç”¨æµç¨‹

1. è®¿é—®æ–‡ä»¶ç®¡ç†é¡µé¢
2. ç‚¹å‡»é¡¹ç›®çš„"æ ¡éªŒ"æŒ‰é’®
3. åœ¨æ ¡éªŒå¼¹çª—ä¸­é€‰æ‹©è¦æ ¡éªŒçš„æ–‡ä»¶
4. ç‚¹å‡»"æ ¡éªŒé€‰ä¸­"åˆ›å»ºå¼‚æ­¥ä»»åŠ¡
5. ç³»ç»Ÿç«‹å³è¿”å›ä»»åŠ¡ IDï¼ˆä¸ç­‰å¾…è®¡ç®—ï¼‰
6. å‰ç«¯æ¯ 2 ç§’è½®è¯¢æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€
7. æ˜¾ç¤ºè®¡ç®—è¿›åº¦ï¼ˆæ­£åœ¨è®¡ç®— X/Y æ–‡ä»¶ï¼‰
8. è®¡ç®—å®Œæˆåæ˜¾ç¤ºç»“æœï¼ˆæ—§ Hash å€¼ vs æ–° Hash å€¼ï¼‰
9. å¯¹æ¯”éªŒè¯æ–‡ä»¶å®Œæ•´æ€§
10. ç‚¹å‡»"ä¿å­˜æ ¡éªŒ"ä¿å­˜åˆ°æ•°æ®åº“

#### 7.6.7 æ³¨æ„äº‹é¡¹

1. **ä»»åŠ¡å­˜å‚¨**ï¼šä»»åŠ¡çŠ¶æ€å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼ŒæœåŠ¡é‡å¯åä»»åŠ¡ä¼šä¸¢å¤±
2. **å¤§æ–‡ä»¶æ”¯æŒ**ï¼šæ”¯æŒ GB çº§åˆ«æ–‡ä»¶è®¡ç®—ï¼Œä¸ä¼šè¶…æ—¶
3. **åˆ†å—è¯»å–**ï¼š8KB åˆ†å—è¯»å–ï¼Œé¿å…å†…å­˜é—®é¢˜
4. **å¹¶å‘æ§åˆ¶**ï¼šå¤šä¸ªç”¨æˆ·å¯ä»¥åŒæ—¶åˆ›å»ºæ ¡éªŒä»»åŠ¡
5. **è¿›åº¦æ˜¾ç¤º**ï¼šå®æ—¶æ˜¾ç¤ºå½“å‰/æ€»æ•°å’Œç™¾åˆ†æ¯”
6. **é”™è¯¯å¤„ç†**ï¼šæ–‡ä»¶ä¸å­˜åœ¨æ—¶ä¼šç«‹å³è¿”å›é”™è¯¯ä¿¡æ¯
7. **Hash æ ¼å¼**ï¼šMD5 ä¸º 32 ä½åå…­è¿›åˆ¶ï¼ŒSHA256 ä¸º 64 ä½åå…­è¿›åˆ¶
8. **æŒ‰é’®çŠ¶æ€**ï¼šè®¡ç®—æœŸé—´æŒ‰é’®è¢«ç¦ç”¨ï¼Œé˜²æ­¢é‡å¤ç‚¹å‡»


# BioData Manager 数据库设计规范

## 一、数据库概览

BioData Manager 使用 MySQL 8.x 数据库，包含以下核心数据表：

| 表名 | 中文名 | 说明 |
|------|--------|------|
| `field_config` | 元数据字段配置表 | 定义所有元数据字段 |
| `raw_project` | 原始数据项目表 | 存储原始数据项目信息 |
| `result_project` | 结果数据项目表 | 存储结果数据项目信息 |
| `file_record` | 文件记录表 | 存储文件导入记录 |
| `select_options` | 下拉选项表 | 存储单选/多选字段的选项 |
| `abbr_mapping` | 缩写映射表 | 存储字段值的全称与缩写对应关系 |

---

## 二、表结构详细设计

### 2.1 元数据字段配置表 (field_config)

**用途**: 定义所有元数据字段的配置，供前端动态生成表单和筛选器

```sql
CREATE TABLE field_config (
    id              INT PRIMARY KEY AUTO_INCREMENT COMMENT '字段配置ID',
    field_seq       INT NOT NULL DEFAULT 0 COMMENT '序号',
    field_id        VARCHAR(50) NOT NULL UNIQUE COMMENT '字段标识',
    field_name      VARCHAR(100) NOT NULL COMMENT '字段名称',
    field_type      ENUM('text', 'textarea', 'select', 'link', 'tags') NOT NULL DEFAULT 'text' COMMENT '字段类型',
    field_necessary TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否必填',
    field_placeholder VARCHAR(10) DEFAULT '2' COMMENT '排列方式',
    field_readonly  TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否只读',
    field_table     ENUM('raw', 'result', 'file') NOT NULL COMMENT '所属项目类型',
    field_options   JSON COMMENT '选项配置',
    field_default   VARCHAR(255) DEFAULT NULL COMMENT '默认值',
    created_at      DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at      DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_field_table (field_table),
    INDEX idx_field_seq (field_seq)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='元数据字段配置表';
```

#### field_type 枚举值说明

| 值 | 说明 | 前端渲染 |
|---|------|----------|
| `text` | 单行文本 | 原始值显示 |
| `textarea` | 多行文本 | 背景色框内显示 |
| `select` | 选择下拉 | 显示 value 对应的 label |
| `link` | 链接字段 | 超链接可点击 |
| `tags` | 标签字段 | 逗号分隔的关键词渲染为标签云 |

**前端渲染逻辑**（完全基于 field_type 动态决定，无硬编码）：

```javascript
switch(field.field_type) {
    case 'textarea':
        displayValue = `<div class="bg-light p-3 rounded">${fieldValue}</div>`;
        break;
    case 'link':
        displayValue = `<a href="${fieldValue}" target="_blank" class="text-break">${fieldValue}</a>`;
        break;
    case 'tags':
        const tags = (fieldValue || '').replace(/[，,]/g, ',').split(',').map(k => k.trim()).filter(k => k);
        displayValue = tags.map(k => `<span class="badge bg-primary me-1 mb-1">${k}</span>`).join('');
        break;
    case 'select':
        // value 转换为 label 显示
        displayValue = getOptionLabel(field.field_id, fieldValue);
        break;
    default:
        displayValue = fieldValue;
}
```

#### field_placeholder 排列方式说明

| 值 | 说明 | 前端布局 |
|---|------|----------|
| `1` | 单列显示 | 字段占满整行 |
| `2` | 两列显示 | 字段与相邻字段成对排列显示（默认） |

#### field_readonly 只读控制说明

| 值 | 说明 | 前端行为 |
|---|------|----------|
| `0` | 可编辑 | 用户可以输入/选择字段值 |
| `1` | 系统自动管理 | 字段值由系统自动生成（如文件数量、总大小），用户不可编辑 |

---

### 2.2 原始数据项目表 (raw_project)

**用途**: 存储原始数据项目的基本信息和元数据

```sql
CREATE TABLE raw_project (
    id                  INT PRIMARY KEY AUTO_INCREMENT COMMENT '自增ID',
    raw_id              VARCHAR(50) NOT NULL UNIQUE COMMENT '项目编号(格式: RAW_UUID)',
    raw_title           VARCHAR(255) NOT NULL COMMENT '项目名称',
    raw_type            VARCHAR(50) NOT NULL COMMENT '数据类型(存储option_value)',
    raw_species         VARCHAR(50) NOT NULL COMMENT '物种(存储option_value)',
    raw_tissue          VARCHAR(255) DEFAULT NULL COMMENT '组织来源(多选逗号分隔)',
    raw_DOI             VARCHAR(100) DEFAULT NULL COMMENT 'DOI号',
    raw_db_id           VARCHAR(100) DEFAULT NULL COMMENT '数据库编号',
    raw_db_link         VARCHAR(500) DEFAULT NULL COMMENT '数据库链接',
    raw_author          VARCHAR(500) DEFAULT NULL COMMENT '作者(多人逗号分隔)',
    raw_article         VARCHAR(500) DEFAULT NULL COMMENT '文章标题',
    raw_description     TEXT DEFAULT NULL COMMENT '项目描述',
    raw_keywords        VARCHAR(500) DEFAULT NULL COMMENT '关键词(逗号分隔)',
    raw_file_count      INT DEFAULT 0 COMMENT '关联文件数量',
    raw_total_size      BIGINT DEFAULT 0 COMMENT '文件总大小(字节)',
    created_at          DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at          DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_raw_id (raw_id),
    INDEX idx_raw_type (raw_type),
    INDEX idx_raw_species (raw_species),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='原始数据项目表';
```

#### 字段存储值说明

| 字段 | 存储值类型 | 存储规则 | 示例 |
|------|-----------|----------|------|
| raw_id | 字符串 | 格式: RAW_8位UUID | "RAW_A1b2C3d4" |
| raw_title | 字符串 | 项目名称 | "肺癌转录组分析" |
| raw_type | 字符串 | 逗号分隔的 option_value | "mRNAseq,蛋白组" |
| raw_species | 字符串 | 逗号分隔的 option_value | "Homo sapiens,Mus musculus" |
| raw_tissue | 字符串 | 逗号分隔的 option_value | "Liver,Kidney" |
| raw_DOI | 字符串 | DOI号格式 | "10.1038/s41586-020-2649-2" |
| raw_db_id | 字符串 | 数据库唯一标识 | "GSE123456" |
| raw_db_link | 字符串 | 完整URL | "https://www.ncbi.nlm.nih.gov/geo/acc=GSE123456" |
| raw_author | 字符串 | 多作者逗号分隔 | "张三,李四" |
| raw_article | 字符串 | 文章标题 | "Single-cell transcriptomics..." |
| raw_description | 文本 | 项目描述 | "本项目收集了..." |
| raw_keywords | 字符串 | 关键词逗号分隔 | "肺癌,转录组" |
| raw_file_count | 整数 | 关联文件数量 | 15 |
| raw_total_size | 整数 | 字节单位 | 5242880000 |

#### 逗号分隔存储规则

以下字段使用逗号分隔存储多个值（**所有 select 类型均为多选，逗号分隔存储**）：

| 字段 | field_type | 存储内容 | 示例 |
|------|-----------|----------|------|
| raw_type | select | 逗号分隔的 option_value | "mRNAseq,蛋白组" |
| raw_species | select | 逗号分隔的 option_value | "Homo sapiens,Mus musculus" |
| raw_tissue | select | 逗号分隔的 option_value | "Liver,Kidney" |
| raw_author | text | 逗号分隔的文本 | "张三,李四" |
| raw_keywords | tags | 逗号分隔的文本 | "肺癌,转录组" |
| results_type | select | 逗号分隔的 option_value | "DEA,Marker" |
| results_raw | tags | 逗号分隔的 raw_id | "RAW_A1,RAW_B2" |
| results_keywords | tags | 逗号分隔的文本 | "差异表达,火山图" |

**存储规则说明：**
- `select` 类型：存储 `option_value`（从 select_options 表获取），逗号分隔
- `tags` 类型：存储用户输入的文本，逗号分隔
- `text` 类型（作者等）：存储用户输入的文本，逗号分隔

**逗号处理规则：**
- **前端输入**：识别中文逗号 `，` 和英文逗号 `,`
- **数据存储**：统一使用英文逗号 `,` 分隔
- **处理时机**：前端提交前将中文逗号替换为英文逗号，后端不做额外处理

**渲染规则说明（前端）：**
- `select` 类型：通过 `getOptionLabel(field_id, value)` 将 option_value 转换回 option_label 显示
- `tags` 类型：逗号分隔的文本渲染为标签云
- `text` 类型：原始值显示

---

### 2.3 结果数据项目表 (result_project)

**用途**: 存储结果数据项目的信息

```sql
CREATE TABLE result_project (
    id                  INT PRIMARY KEY AUTO_INCREMENT COMMENT '自增ID',
    results_id          VARCHAR(50) NOT NULL UNIQUE COMMENT '项目编号(格式: RES_UUID)',
    results_title       VARCHAR(255) NOT NULL COMMENT '项目名称',
    results_type        VARCHAR(50) NOT NULL COMMENT '结果类型(存储option_value)',
    results_raw         VARCHAR(255) DEFAULT NULL COMMENT '关联原始项目ID(逗号分隔的raw_id)',
    results_description TEXT DEFAULT NULL COMMENT '项目描述',
    results_keywords    VARCHAR(500) DEFAULT NULL COMMENT '关键词(逗号分隔)',
    results_DOI         VARCHAR(100) DEFAULT NULL COMMENT 'DOI号',
    results_db_link     VARCHAR(500) DEFAULT NULL COMMENT '数据库链接',
    results_file_count  INT DEFAULT 0 COMMENT '关联文件数量',
    results_total_size  BIGINT DEFAULT 0 COMMENT '文件总大小(字节)',
    created_at          DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at          DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_results_id (results_id),
    INDEX idx_results_type (results_type),
    INDEX idx_results_raw (results_raw),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='结果数据项目表';
```

#### 字段存储值说明

| 字段 | 存储值类型 | 存储规则 | 示例 |
|------|-----------|----------|------|
| results_id | 字符串 | 格式: RES_8位UUID | "RES_X9y8Z7w6" |
| results_title | 字符串 | 项目名称 | "差异表达分析结果" |
| results_type | 字符串 | 逗号分隔的 option_value | "DEA,Marker" |
| results_raw | 字符串 | 逗号分隔的 raw_id | "RAW_A1B2C3D4,RAW_E5F6G7H8" |
| results_description | 文本 | 项目描述 | "基于DESeq2的差异分析..." |
| results_keywords | 字符串 | 关键词逗号分隔 | "差异表达,火山图" |
| results_DOI | 字符串 | DOI号 | "10.1186/s13059-020-0196-3" |
| results_db_link | 字符串 | 数据库链接 | "https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE654321" |
| results_file_count | 整数 | 关联文件数量 | 8 |
| results_total_size | 整数 | 字节单位 | 1048576000 |

---

### 2.4 文件记录表 (file_record)

**用途**: 存储导入文件的信息和归属关系

```sql
CREATE TABLE file_record (
    id                  INT PRIMARY KEY AUTO_INCREMENT COMMENT '自增ID',
    file_name           VARCHAR(255) NOT NULL COMMENT '文件名（包含扩展名）',
    file_path           VARCHAR(500) NOT NULL COMMENT '相对于/bio的路径（不包含文件名）',
    file_property       VARCHAR(500) DEFAULT NULL COMMENT '文件属性（用于显示和筛选）',
    file_size           BIGINT NOT NULL COMMENT '文件大小（字节）',
    file_type           VARCHAR(50) DEFAULT NULL COMMENT '文件扩展名（小写）',
    file_project_type   ENUM('raw', 'result') NOT NULL COMMENT '所属项目类型',
    file_project_id     VARCHAR(50) NOT NULL COMMENT '所属项目编号',
    file_project_ref_id VARCHAR(50) DEFAULT NULL COMMENT '关联项目编号（结果文件关联的原始数据项目）',
    imported_at         DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '导入时间',
    INDEX idx_project (file_project_type, file_project_id),
    INDEX idx_file_path (file_path),
    INDEX idx_file_property (file_property),
    INDEX idx_file_project_ref_id (file_project_ref_id),
    INDEX idx_imported_at (imported_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='文件记录表';
```

#### 字段存储值说明

| 字段 | 存储值类型 | 存储规则 | 示例 |
|------|-----------|----------|------|
| file_name | 字符串 | 完整文件名 | "sample1.fastq.gz" |
| file_path | 字符串 | 相对于/bio的路径 | "mRseq/Hs/Li" |
| file_property | 字符串 | 文件属性 | "转录组-人类-食管" |
| file_size | 整数 | 字节单位 | 5242880000 |
| file_type | 字符串 | 文件扩展名 | "gz", "fastq", "csv" |
| file_project_type | 枚举 | 'raw' 或 'result' | "raw" |
| file_project_id | 字符串 | 所属项目编号 | "RAW_A1B2C3D4" |
| file_project_ref_id | 字符串 | 关联项目编号（仅结果文件使用，关联的原始数据项目） | "RAW_A1B2C3D4" |
| imported_at | 日期时间 | 导入时间 | "2026-01-17 10:30:00" |

#### file_project_ref_id 用途说明

| 字段 | 说明 |
|------|------|
| file_project_type | 'raw' 或 'result' |
| file_project_id | 项目编号（RAW_XXX 或 RES_XXX） |
| file_project_ref_id | **仅结果数据使用**，关联的原始数据项目编号（排序后） |

**用途：**
1. 结果数据关联到原始数据项目
2. 在结果项目详情页显示关联的原始数据文件
3. 便于追溯数据的分析来源

**示例：**
```
results_raw = "RAW_A1,RAW_B2" → 排序后 = "RAW_A1RAW_B2"
file_project_ref_id = "RAW_A1RAW_B2"
```

#### file_property 生成规则

| 项目类型 | 条件 | 生成规则 | 示例 |
|---------|------|----------|------|
| 原始数据 (raw) | raw_tissue 非空 | `{raw_type_label}-{raw_species_label}-{raw_tissue_label}` | "转录组-人类-肝脏" |
| 原始数据 (raw) | raw_tissue 为空 | `{raw_type_label}-{raw_species_label}` | "转录组-人类" |
| 结果数据 (result) | results_raw 非空 | `{results_id}-{results_type缩写}-{排序后的results_raw}` | "RES_X1Y2Z3-DEA-RAW_A1RAW_B2" |
| 结果数据 (result) | results_raw 为空 | `{results_id}-{results_type缩写}` | "RES_X1Y2Z3-DEA" |

**生成规则说明：**
- **原始数据**：使用完整的 label（非缩写）
- **结果数据**：使用 results_id（而非缩写）+ results_type 缩写 + 排序后的 results_raw（raw_id 拼接）
- **排序规则**：results_raw 按 ASCII 顺序排序（数字 < 大写字母 < 小写字母），然后直接拼接

#### file_path 计算规则

**原始数据文件路径：**

```
如果 raw_tissue 非空：
  file_path = {数据类型缩写}/{物种缩写}/{组织来源缩写}
            = mRseq/Hs/Li

如果 raw_tissue 为空：
  file_path = {数据类型缩写}/{物种缩写}
            = mRseq/Hs

完整路径 = /bio/{file_path}/{raw_id}/{file_name}
         = /bio/mRseq/Hs/Li/RAW_A1B2C3D4/sample1.fastq.gz
```

**结果数据文件路径：**

```
如果 results_raw 非空：
  file_path = {results_type缩写}/{排序后的results_raw}
            = DEA/RAW_A1RAW_B2

如果 results_raw 为空：
  file_path = {results_type缩写}
            = DEA

完整路径 = /bio/results/{results_id}/{file_path}/{file_name}
         = /bio/results/RES_X1Y2Z3/DEA/RAW_A1RAW_B2/heatmap.png
         = /bio/results/RES_X1Y2Z3/DEA/volcano.png
```

**排序规则 `_parse_and_sort`：**
```
输入: "RAW_A1，RAW_2A, RAW_sa"
解析: 替换中文逗号为英文，分割为列表，去除空值
排序: 按ASCII顺序排序（数字 < 大写字母 < 小写字母）
输出: "RAW_A1RAW_B2RAW_sa"（直接拼接，无分隔符）
```

---

### 2.5 下拉选项表 (select_options)

**用途**: 存储单选/多选字段的选项列表

```sql
CREATE TABLE select_options (
    id              INT PRIMARY KEY AUTO_INCREMENT COMMENT '自增ID',
    option_type     VARCHAR(50) NOT NULL COMMENT '选项类型(对应field_id)',
    option_value    VARCHAR(100) NOT NULL COMMENT '选项值(value)',
    option_label    VARCHAR(255) NOT NULL COMMENT '选项标签(label)',
    option_seq      INT DEFAULT 0 COMMENT '排序序号',
    created_at      DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    UNIQUE KEY uk_type_value (option_type, option_value),
    INDEX idx_option_type (option_type),
    INDEX idx_option_seq (option_seq)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='下拉选项表';
```

---

### 2.6 缩写映射表 (abbr_mapping)

**用途**: 存储字段值的全称与缩写对应关系，用于生成文件路径

```sql
CREATE TABLE abbr_mapping (
    id              INT PRIMARY KEY AUTO_INCREMENT COMMENT '自增ID',
    field_id        VARCHAR(50) NOT NULL COMMENT '字段标识符',
    full_name       VARCHAR(100) NOT NULL COMMENT '全称(选项值)',
    abbr_name       VARCHAR(20) NOT NULL COMMENT '缩写(用于文件路径)',
    created_at      DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    UNIQUE KEY uk_field_full (field_id, full_name),
    INDEX idx_field_id (field_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='缩写映射表';
```

---

## 三、field_config 初始配置

### 3.1 原始数据字段配置 (raw_project)

```sql
INSERT INTO field_config (field_id, field_name, field_type, field_table, field_necessary, field_seq, field_options, field_placeholder, field_readonly) VALUES
('raw_id', '项目编号', 'text', 'raw', 1, 0, NULL, '2', 0),
('raw_title', '项目名称', 'text', 'raw', 1, 1, NULL, '2', 0),
('raw_type', '数据类型', 'select', 'raw', 1, 2, '{...}', '2', 0),
('raw_species', '物种', 'select', 'raw', 1, 3, '{...}', '2', 0),
('raw_tissue', '组织来源', 'select', 'raw', 0, 4, '{...}', '2', 0),
('raw_DOI', 'DOI', 'link', 'raw', 0, 5, NULL, '2', 0),
('raw_db_id', '数据库编号', 'text', 'raw', 0, 6, NULL, '2', 0),
('raw_db_link', '数据库链接', 'link', 'raw', 0, 7, NULL, '2', 0),
('raw_author', '作者', 'text', 'raw', 0, 8, NULL, '2', 0),
('raw_article', '文章标题', 'text', 'raw', 0, 9, NULL, '2', 0),
('raw_description', '描述', 'textarea', 'raw', 0, 10, NULL, '1', 0),
('raw_keywords', '关键词', 'tags', 'raw', 0, 11, NULL, '1', 0),
('raw_file_count', '文件数量', 'text', 'raw', 0, 12, NULL, '2', 1),
('raw_total_size', '文件总大小', 'text', 'raw', 0, 13, NULL, '2', 1);
```

### 3.2 结果数据字段配置 (result_project)

```sql
INSERT INTO field_config (field_id, field_name, field_type, field_table, field_necessary, field_seq, field_options, field_placeholder, field_readonly) VALUES
('results_id', '项目编号', 'text', 'result', 1, 0, NULL, '2', 0),
('results_title', '项目名称', 'text', 'result', 1, 1, NULL, '2', 0),
('results_type', '结果类型', 'select', 'result', 1, 2, '{...}', '2', 0),
('results_raw', '关联原始项目', 'tags', 'result', 0, 3, NULL, '1', 0),
('results_description', '描述', 'textarea', 'result', 0, 4, NULL, '1', 0),
('results_keywords', '关键词', 'tags', 'result', 0, 5, NULL, '1', 0),
('results_DOI', 'DOI', 'link', 'result', 0, 6, NULL, '2', 0),
('results_db_link', '数据库链接', 'link', 'result', 0, 7, NULL, '2', 0),
('results_file_count', '文件数量', 'text', 'result', 0, 6, NULL, '2', 1),
('results_total_size', '文件总大小', 'text', 'result', 0, 7, NULL, '2', 1);
```

### 3.3 文件管理字段配置 (file_record)

```sql
INSERT INTO field_config (field_id, field_name, field_type, field_table, field_necessary, field_seq, field_options, field_placeholder, field_readonly) VALUES
('file_name', '文件名', 'text', 'file', 1, 0, NULL, '2', 0),
('file_path', '文件路径', 'text', 'file', 1, 1, NULL, '2', 0),
('file_property', '文件属性', 'text', 'file', 0, 2, NULL, '2', 0),
('file_size', '文件大小', 'text', 'file', 0, 3, NULL, '2', 0),
('file_type', '文件类型', 'text', 'file', 0, 4, NULL, '2', 0),
('file_project_type', '项目类型', 'text', 'file', 1, 5, NULL, '2', 0),
('file_project_id', '项目编号', 'text', 'file', 1, 6, NULL, '2', 0),
('imported_at', '导入时间', 'text', 'file', 0, 7, NULL, '2', 0);
```

---

## 四、select_options 初始数据

### 4.1 数据类型选项 (raw_type)

```sql
INSERT INTO select_options (option_type, option_value, option_label, option_seq) VALUES
('raw_type', 'mRNAseq', '转录组', 1),
('raw_type', 'Long-Read RNAseq', '长读转录组', 2),
('raw_type', 'lncRNAseq', 'lncRNAseq', 3),
('raw_type', 'miRNAseq', 'miRNAseq', 4),
('raw_type', 'sRNAseq', '小RNA转录组', 5),
('raw_type', 'epitRNAseq', '表观转录组', 6),
('raw_type', 'scRNAseq', '单细胞转录组', 7),
('raw_type', 'LR-scRNAseq', '长读单细胞转录组', 8),
('raw_type', '蛋白组', '蛋白组', 9),
('raw_type', '磷酸化组', '磷酸化组', 10),
('raw_type', '泛素化组', '泛素化组', 11),
('raw_type', '乙酰化组', '乙酰化组', 12),
('raw_type', 'SUMO PTMome', 'SUMO PTMome', 13),
('raw_type', '甲基化组', '甲基化组', 14),
('raw_type', '糖基化组', '糖基化组', 15),
('raw_type', '棕榈酰化组', '棕榈酰化组', 16),
('raw_type', '代谢组', '代谢组', 17),
('raw_type', '脂质组学', '脂质组学', 18),
('raw_type', '免疫组学', '免疫组学', 19),
('raw_type', '空间多组学', '空间多组学', 20);
```

### 4.2 物种选项 (raw_species)

```sql
INSERT INTO select_options (option_type, option_value, option_label, option_seq) VALUES
('raw_species', 'Homo sapiens', '人', 1),
('raw_species', 'Mus musculus', '小鼠', 2),
('raw_species', 'Rattus norvegicus', '大鼠', 3),
('raw_species', 'Others', '其他', 4);
```

### 4.3 组织来源选项 (raw_tissue)

```sql
INSERT INTO select_options (option_type, option_value, option_label, option_seq) VALUES
('raw_tissue', 'Not Specific', 'Not Specific (非单一组织)', 0),
('raw_tissue', 'Adipose tissue', 'Adipose tissue (脂肪组织)', 1),
('raw_tissue', 'Adrenal gland', 'Adrenal gland (肾上腺)', 2),
('raw_tissue', 'Amygdala', 'Amygdala (杏仁核)', 3),
('raw_tissue', 'Basal ganglia', 'Basal ganglia (基底神经节)', 4),
('raw_tissue', 'Blood vessel', 'Blood vessel (血管)', 5),
('raw_tissue', 'Bone marrow', 'Bone marrow (骨髓)', 6),
('raw_tissue', 'Breast', 'Breast (乳房)', 7),
('raw_tissue', 'Cerebellum', 'Cerebellum (小脑)', 8),
('raw_tissue', 'Cerebral cortex', 'Cerebral cortex (大脑皮层)', 9),
('raw_tissue', 'Cervix', 'Cervix (子宫颈)', 10),
('raw_tissue', 'Choroid plexus', 'Choroid plexus (脉络丛)', 11),
('raw_tissue', 'Colon', 'Colon (结肠)', 12),
('raw_tissue', 'Duodenum', 'Duodenum (十二指肠)', 13),
('raw_tissue', 'Endometrium', 'Endometrium (子宫内膜)', 14),
('raw_tissue', 'Epididymis', 'Epididymis (附睾)', 15),
('raw_tissue', 'Esophagus', 'Esophagus (食管)', 16),
('raw_tissue', 'Fallopian tube', 'Fallopian tube (输卵管)', 17),
('raw_tissue', 'Gallbladder', 'Gallbladder (胆囊)', 18),
('raw_tissue', 'Heart muscle', 'Heart muscle (心肌)', 19),
('raw_tissue', 'Hippocampal formation', 'Hippocampal formation (海马结构)', 20),
('raw_tissue', 'Hypothalamus', 'Hypothalamus (下丘脑)', 21),
('raw_tissue', 'Kidney', 'Kidney (肾脏)', 22),
('raw_tissue', 'Liver', 'Liver (肝脏)', 23),
('raw_tissue', 'Lung', 'Lung (肺)', 24),
('raw_tissue', 'Lymph node', 'Lymph node (淋巴结)', 25),
('raw_tissue', 'Midbrain', 'Midbrain (中脑)', 26),
('raw_tissue', 'Ovary', 'Ovary (卵巢)', 27),
('raw_tissue', 'Pancreas', 'Pancreas (胰腺)', 28),
('raw_tissue', 'Parathyroid gland', 'Parathyroid gland (甲状旁腺)', 29),
('raw_tissue', 'Pituitary gland', 'Pituitary gland (垂体)', 30),
('raw_tissue', 'Placenta', 'Placenta (胎盘)', 31),
('raw_tissue', 'Prostate', 'Prostate (前列腺)', 32),
('raw_tissue', 'Rectum', 'Rectum (直肠)', 33),
('raw_tissue', 'Retina', 'Retina (视网膜)', 34),
('raw_tissue', 'Salivary gland', 'Salivary gland (唾液腺)', 35),
('raw_tissue', 'Seminal vesicle', 'Seminal vesicle (精囊)', 36),
('raw_tissue', 'Skeletal muscle', 'Skeletal muscle (骨骼肌)', 37),
('raw_tissue', 'Skin', 'Skin (皮肤)', 38),
('raw_tissue', 'Small intestine', 'Small intestine (小肠)', 39),
('raw_tissue', 'Smooth muscle', 'Smooth muscle (平滑肌)', 40),
('raw_tissue', 'Spinal cord', 'Spinal cord (脊髓)', 41),
('raw_tissue', 'Spleen', 'Spleen (脾脏)', 42),
('raw_tissue', 'Stomach', 'Stomach (胃)', 43),
('raw_tissue', 'Testis', 'Testis (睾丸)', 44),
('raw_tissue', 'Thymus', 'Thymus (胸腺)', 45),
('raw_tissue', 'Thyroid gland', 'Thyroid gland (甲状腺)', 46),
('raw_tissue', 'Tongue', 'Tongue (舌头)', 47),
('raw_tissue', 'Tonsil', 'Tonsil (扁桃体)', 48),
('raw_tissue', 'Urinary bladder', 'Urinary bladder (膀胱)', 49),
('raw_tissue', 'Vagina', 'Vagina (阴道)', 50);
```

---

### 4.4 结果类型选项 (results_type)

```sql
INSERT INTO select_options (option_type, option_value, option_label, option_seq) VALUES
('results_type', 'DEA', '差异分析 (DEA)', 1),
('results_type', 'Marker', 'Marker基因', 2),
('results_type', 'Enrichment', '富集分析', 3),
('results_type', 'PPI', '蛋白互作 (PPI)', 4),
('results_type', 'Network', '网络分析', 5),
('results_type', 'Clustering', '聚类分析', 6),
('results_type', 'Dimension', '降维分析', 7),
('results_type', 'Trajectory', '轨迹分析', 8);
```

**重要说明**：
- `results_type` 必须有对应的 `select_options` 数据
- 否则前端下拉框无法正常显示选项
- `abbr_mapping` 表必须同步添加对应的缩写映射
- 路径生成需要使用 `abbr_mapping` 表中的缩写（如 `DEA` 而不是 `差异分析`）

---

## 五、abbr_mapping 初始数据

### 5.1 数据类型缩写 (raw_type)

```sql
INSERT INTO abbr_mapping (field_id, full_name, abbr_name) VALUES
('raw_type', 'mRNAseq', 'mRseq'),
('raw_type', 'Long-Read RNAseq', 'LRseq'),
('raw_type', 'lncRNAseq', 'lncseq'),
('raw_type', 'miRNAseq', 'miseq'),
('raw_type', 'sRNAseq', 'srseq'),
('raw_type', 'epitRNAseq', 'epitseq'),
('raw_type', 'scRNAseq', 'scseq'),
('raw_type', 'LR-scRNAseq', 'LR_sc'),
('raw_type', '蛋白组', 'pro'),
('raw_type', '磷酸化组', 'pho'),
('raw_type', '泛素化组', 'ubi'),
('raw_type', '乙酰化组', 'acety'),
('raw_type', 'SUMO PTMome', 'sumo'),
('raw_type', '甲基化组', 'meth'),
('raw_type', '糖基化组', 'glyco'),
('raw_type', '棕榈酰化组', 'pal'),
('raw_type', '代谢组', 'metab'),
('raw_type', '脂质组学', 'lipo'),
('raw_type', '免疫组学', 'immuno'),
('raw_type', '空间多组学', 'spatial');
```

### 5.2 物种缩写 (raw_species)

```sql
INSERT INTO abbr_mapping (field_id, full_name, abbr_name) VALUES
('raw_species', 'Homo sapiens', 'Hs'),
('raw_species', 'Mus musculus', 'Mu'),
('raw_species', 'Rattus norvegicus', 'Ra'),
('raw_species', 'Others', 'Ot');
```

### 5.3 组织来源缩写 (raw_tissue)

```sql
INSERT INTO abbr_mapping (field_id, full_name, abbr_name) VALUES
('raw_tissue', 'Not Specific', 'Ns'),
('raw_tissue', 'Adipose tissue', 'At'),
('raw_tissue', 'Adrenal gland', 'Ag'),
('raw_tissue', 'Amygdala', 'Am'),
('raw_tissue', 'Basal ganglia', 'Bg'),
('raw_tissue', 'Blood vessel', 'Bv'),
('raw_tissue', 'Bone marrow', 'Bm'),
('raw_tissue', 'Breast', 'Br'),
('raw_tissue', 'Cerebellum', 'Ce'),
('raw_tissue', 'Cerebral cortex', 'Cc'),
('raw_tissue', 'Cervix', 'Cer'),
('raw_tissue', 'Choroid plexus', 'Cp'),
('raw_tissue', 'Colon', 'Co'),
('raw_tissue', 'Duodenum', 'Du'),
('raw_tissue', 'Endometrium', 'En'),
('raw_tissue', 'Epididymis', 'Ep'),
('raw_tissue', 'Esophagus', 'Es'),
('raw_tissue', 'Fallopian tube', 'Fa'),
('raw_tissue', 'Gallbladder', 'Ga'),
('raw_tissue', 'Heart muscle', 'Hm'),
('raw_tissue', 'Hippocampal formation', 'Hf'),
('raw_tissue', 'Hypothalamus', 'Hy'),
('raw_tissue', 'Kidney', 'Ki'),
('raw_tissue', 'Liver', 'Li'),
('raw_tissue', 'Lung', 'Lu'),
('raw_tissue', 'Lymph node', 'Ln'),
('raw_tissue', 'Midbrain', 'Mi'),
('raw_tissue', 'Ovary', 'Ov'),
('raw_tissue', 'Pancreas', 'Pa'),
('raw_tissue', 'Parathyroid gland', 'Pg'),
('raw_tissue', 'Pituitary gland', 'Pig'),
('raw_tissue', 'Placenta', 'Pl'),
('raw_tissue', 'Prostate', 'Pr'),
('raw_tissue', 'Rectum', 'Re'),
('raw_tissue', 'Retina', 'Ret'),
('raw_tissue', 'Salivary gland', 'Sg'),
('raw_tissue', 'Seminal vesicle', 'Sv'),
('raw_tissue', 'Skeletal muscle', 'Sm'),
('raw_tissue', 'Skin', 'Sk'),
('raw_tissue', 'Small intestine', 'Si'),
('raw_tissue', 'Smooth muscle', 'Sm'),
('raw_tissue', 'Spinal cord', 'Sc'),
('raw_tissue', 'Spleen', 'Sp'),
('raw_tissue', 'Stomach', 'St'),
('raw_tissue', 'Testis', 'Te'),
('raw_tissue', 'Thymus', 'Th'),
('raw_tissue', 'Thyroid gland', 'Tg'),
('raw_tissue', 'Tongue', 'To'),
('raw_tissue', 'Tonsil', 'Ton'),
('raw_tissue', 'Urinary bladder', 'Ub'),
('raw_tissue', 'Vagina', 'Va');

### 5.4 结果类型缩写 (results_type)

```sql
INSERT INTO abbr_mapping (field_id, full_name, abbr_name) VALUES
('results_type', 'DEA', 'DEA'),
('results_type', 'Marker', 'MKR'),
('results_type', 'Enrichment', 'ENR'),
('results_type', 'PPI', 'PPI'),
('results_type', 'Network', 'NET'),
('results_type', 'Clustering', 'CLU'),
('results_type', 'Dimension', 'DIM'),
('results_type', 'Trajectory', 'TRA');
```

**重要说明**：
- `results_type` 必须有对应的 `abbr_mapping` 数据
- 否则 `_build_result_project_path()` 和 `_build_file_property()` 无法正确生成路径
- 路径生成规则：`/bio/results/{分析类型缩写}/{项目ID}[/{关联项目ID}]`
- 示例：`/bio/results/DEA/RES_X1Y2Z3/RAW_A1RAW_B2/heatmap.png`

---

## 六、UUID 生成规则

```
格式: {TYPE}_{8位UUID}

UUID字符集: 0-9, A-Z, a-z (共62个字符)
示例: RAW_A1b2C3d4, RES_X9y8Z7w6
```

---

## 七、文件存储路径规则

### 7.1 原始数据文件路径

```
/bio/rawdata/{数据类型缩写}/{物种缩写}/{组织来源缩写}/{项目编号}/{文件名}

示例: /bio/rawdata/mRseq/Hs/Li/RAW_A1B2C3D4/sample1.fastq.gz
```

### 7.2 结果数据文件路径

```
/bio/results/{分析类型}/{项目编号}[/{关联项目编号}]/{文件名}

示例: /bio/results/DEA/RES_X1Y2Z3/sample.png
      /bio/results/DEA/RES_X1Y2Z3/RAW_A1RAW_B2/heatmap.png
```

---

**文档版本**: 2.6  
**创建时间**: 2026-01-16  
**最后更新**: 2026-01-24  
**数据库版本**: MySQL 8.x  

**主要更新 (v2.6)**:
- file_record 新增 file_project_ref_id 字段（关联结果文件与原始数据项目）
- 新增 file_project_ref_id 用途说明
- file_property 生成规则细化（区分 raw/result，有无 tissue/raw 的场景）
- file_path 计算规则细化（包含原始数据和结果数据的路径规则）
- 新增 `_parse_and_sort` 排序规则说明

**主要更新 (v2.5)**:
- field_type 枚举新增 `link` 和 `tags` 类型
- 新增字段渲染规则（基于 field_type 动态决定，完全移除硬编码）
- raw_project 新增 raw_DOI, raw_db_link 字段
- result_project 新增 results_DOI, results_db_link, results_raw, results_keywords 字段
- field_config 更新：raw_DOI/link, raw_db_link/link, raw_keywords/tags
- field_config 更新：results_DOI/link, results_db_link/link, results_raw/tags, results_keywords/tags
